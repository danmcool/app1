var email=require("mailer"),nodemailer=require("nodemailer"),ical=require("ical-generator"),Constants=require("../tools/constants.min.js"),Email={},transporter=nodemailer.createTransport({service:"Gmail",auth:{user:Constants.EmailUserName,pass:Constants.EmailPassword},logger:!0,debug:!0});Email.send2=function(e,a,t,s,o,n){var i={from:Constants.EmailUserName,to:e,subject:t,text:s,icalEvent:{method:"request",content:n}};console.log("Sending Mail"),transporter.sendMail(i,function(e,a){return e?(console.log("Error occurred"),void console.log(e.message)):(console.log("Message sent successfully!"),void console.log('Server responded with "%s"',a.response))})},Email.send=function(e,a,t,s,o){email.send({host:Constants.EmailHost,port:Constants.EmailPort,ssl:Constants.EmailSSL,domain:Constants.EmailDomain,to:e,cc:a,from:Constants.EmailUserName,subject:t,text:s,html:o,authentication:Constants.EmailAuthentication,username:Constants.EmailUserName,password:Constants.EmailPassword},function(e,a){})},Email.sendValidation=function(e,a,t,s){Email.send(e,"","Registration validation for App1","Automatic message from App1","<span><p>Dear customer, thank-you for registering with our website, your initial password is: "+s+'</p></span><br><span><p><b>Please validate your email by clicking on the following link</b></p></span><br><a href="http://'+Constants.WebAddress+"/authentication/validate?user="+a+"&code="+t+'"><p><b>Validate registration</b></p></a>')},Email.sendSAMLNewUser=function(e,a,t){Email.send(e,"","Registration validation for App1","Automatic message from App1","<span><p>Dear user, thank-you for registering with our website, your initial password is: "+Constants.InitialPassword+"</p></span>")},Email.sendShare=function(e,a,t,s){Email.send(e,a,"App1 - Shared form","Automatic message from App1",'<p>A form has been shared with you, to access it please click on the following link:</p><br><a href="http://'+Constants.WebAddress+"/client/open?form_id="+form_id+"&datamodel_id="+datamodel_id+"&data_id="+t+"&profile_id="+s+'">Open form</a><br><br><p>You are required to register on app1.cloud in order to access the form!</p><br><a href="http://app1.cloud">App1.Cloud</a>')},Email.sendSharePublic=function(e,a,t,s){Email.send(e,"","App1 - Shared workflow","Automatic message from App1","<span><p>Dear customer, please use the following link to share the "+t+" application`s workflow, using public profile "+s+' :</p></span><br><a href="http://'+Constants.WebAddress+"/authentication/open?pid="+a+'">http://'+Constants.WebAddress+"/authentication/open?pid="+a+"</a>")},Email.sendCalendar=function(e,a,t,s,o){cal=ical({domain:"app1.cloud",prodId:"//CloudApp1//calendar//EN",events:[{start:new Date(t),end:new Date(s),timestamp:new Date,summary:a,organizer:o+"<"+e+">"}]}),Email.send2(e,"",a,"Automatic message from App1","<html><body><p>Dear "+o+", this is the project invitation for "+a+" please add this to your calendar.</p></body></html>",new Buffer(cal.toString()).toString())},module.exports=Email;
