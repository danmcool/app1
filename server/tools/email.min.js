var email=require("mailer"),nodemailer=require("nodemailer"),ical=require("ical-generator"),Constants=require("../tools/constants.js"),Email={},transporter=nodemailer.createTransport({service:"Gmail",auth:{user:Constants.EmailUserName,pass:Constants.EmailPassword},logger:!0,debug:!0});Email.send2=function(e,t,s,o,r,a){var n={from:Constants.EmailUserName,to:e,subject:s,text:o,html:r,icalEvent:{method:"request",content:a}};transporter.sendMail(n,function(e,t){return e?void console.log("Error occurred"+e.message):void 0})},Email.send=function(e,t,s,o,r){email.send({host:Constants.EmailHost,port:Constants.EmailPort,ssl:Constants.EmailSSL,domain:Constants.EmailDomain,to:e,cc:t,from:Constants.EmailUserName,subject:s,text:o,html:r,authentication:Constants.EmailAuthentication,username:Constants.EmailUserName,password:Constants.EmailPassword},function(e,t){})},Email.sendValidation=function(e,t,s,o){Email.send(e,"","Registration validation for App1","Automatic message from App1","<span><p>Dear customer, thank-you for registering with our website, your initial password is: "+o+'</p></span><br><span><p><b>Please validate your email by clicking on the following link</b></p></span><br><a href="https://'+Constants.WebAddress+"/authentication/validate?user="+t+"&code="+s+'"><p><b>Validate registration</b></p></a>')},Email.sendSAMLNewUser=function(e,t,s){Email.send(e,"","Registration validation for App1","Automatic message from App1","<span><p>Dear user, thank-you for registering with our website, your initial password is: "+Constants.InitialPassword+"</p></span>")},Email.sendShare=function(e,t,s,o){Email.send(e,t,"App1 - Shared workflow","Automatic message from App1",o+'<br><a href="https://'+Constants.WebAddress+"/authentication/open?pid="+s+'">https://'+Constants.WebAddress+"/authentication/open?pid="+s+"</a>")},Email.sendSharePublic=function(e,t,s,o){Email.send(e,"","App1 - Shared workflow","Automatic message from App1","<span><p>Dear customer,</p><br><p>Please use the following link to share the "+s+" application`s workflow, using public profile "+o+' :</p></span><br><a href="https://'+Constants.WebAddress+"/authentication/open?pid="+t+'">https://'+Constants.WebAddress+"/authentication/open?pid="+t+"</a>")},Email.sendCalendar=function(e,t,s,o,r,a){try{cal=ical({domain:Constants.WebAddress,prodId:"//App1//calendar//EN",events:[{start:new Date(s),end:new Date(o),allDay:r,timestamp:new Date,summary:t,organizer:a+"<"+e+">"}]}),Email.send2(e,"",t,"Dear "+a+", this is the calendar invitation for "+t+", please add this to your calendar!","<html><body><p>Dear "+a+", this is the calendar invitation for "+t+", please add this to your calendar.</p></body></html>",new Buffer(cal.toString()).toString())}catch(n){console.log("Calendar error "+n)}},Email.prepareMessage=function(e,t){return e?e.replace(/@@user/g,(t.firstname?t.firstname:"")+" "+(t.lastname?t.lastname:"")).replace(/@@company/g,t.company.name?t.company.name:""):""},module.exports=Email;
