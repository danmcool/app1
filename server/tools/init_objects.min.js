var mongoose=require("mongoose"),fs=require("fs"),saml2=require("saml2-js"),Schema=mongoose.Schema,Metadata=require("../models/metadata.min.js"),SessionCache=require("../tools/session_cache.min.js"),DataModel=Metadata.DataModel;DataModel.find(function(e,o){if(e)return next(e);for(var a=0;a<o.length;a++){var s;try{var t=JSON.parse(o[a].datamodel?o[a].datamodel:"{}");t._updated_at="Date",t._company_code="String",t._user="String",t._files=[{type:Schema.Types.ObjectId,ref:"File"}],s=new Schema(t)}catch(i){console.log(i),s=new Schema({})}Metadata.Objects[o[a]._id]=mongoose.model("data"+o[a]._id,s)}});var sp_options={entity_id:"app1_saml_metadata.xml",private_key:fs.readFileSync("./server/ssl/app1-key.pem","utf8"),certificate:fs.readFileSync("./server/ssl/app1-cert.crt","utf8"),assert_endpoint:"https://app1.cloud/authentication/saml_callback",force_authn:!1,sign_get_request:!1,allow_unencrypted_assertion:!0};SessionCache.serviceProvider=new saml2.ServiceProvider(sp_options);
