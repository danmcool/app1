function allowedPath(e){return e.path.startsWith("/data")||e.path.startsWith("/api")||e.path.startsWith("/file")||e.path.startsWith("/client")?!1:!0}function nocache(e,a){}var express=require("express"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),mongoose=require("mongoose"),path=require("path");mongoose.Promise=global.Promise,mongoose.connect("mongodb://app1:123Apps@127.0.0.1:55055/apps",{useMongoClient:!0});var api=require("./routes/api.js"),data=require("./routes/data.js"),file=require("./routes/file.js"),client=require("./routes/client.js"),design=require("./routes/design.js"),authentication=require("./routes/authentication.js");require("./tools/init_objects.js");var app=express(),SessionCache=require("./tools/session_cache.js"),Constants=require("./tools/constants.js");app.use(express["static"](path.join(__dirname,"../client"))),app.use(logger("dev")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(function(e,a,r){allowedPath(e)?(nocache(e,a),r()):SessionCache.isActive(e,function(t){return t?(nocache(e,a),void r()):a.status(401).redirect("/")})}),app.use("/data",data),app.use("/file",file),app.use("/client",client),app.use("/authentication",authentication),app.use("/api",api),app.use("/client/design",design),app.use(express["static"](path.join(__dirname,"public"))),app.use(express["static"](path.join(__dirname,"../client"))),app.get("/",function(e,a){a.sendFile(path.join(__dirname,"../client","index.html"))}),app.get("/admin",function(e,a){a.sendFile(path.join(__dirname,"../client","index_admin.html"))}),app.use(function(e,a,r){var t=new Error("Not Found");t.status=404,r(t)}),app.use(function(e,a,r){r.status(e.status||500),r.end(JSON.stringify({message:e.message,error:{}}))}),module.exports=app;
