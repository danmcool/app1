function allowedPath(e){return e.path.startsWith("/data")||e.path.startsWith("/api")||e.path.startsWith("/file")||e.path.startsWith("/client")?!1:!0}function nocache(e,a){}var express=require("express"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),mongoose=require("mongoose"),path=require("path");mongoose.Promise=global.Promise,mongoose.connect("mongodb://app1:123Apps@127.0.0.1:55055/apps");var api=require("./routes/api.min.js"),data=require("./routes/data.min.js"),file=require("./routes/file.min.js"),client=require("./routes/client.min.js"),design=require("./routes/design.min.js"),authentication=require("./routes/authentication.min.js");require("./tools/init_objects.min.js");var app=express(),SessionCache=require("./tools/session_cache.min.js"),Constants=require("./tools/constants.min.js");app.use(express["static"](path.join(__dirname,"../client"))),app.use(logger("dev")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(function(e,a,s){allowedPath(e)?(nocache(e,a),s()):SessionCache.isActive(e,function(i){return i?(nocache(e,a),void s()):a.status(401).redirect("/")})}),app.use("/data",data),app.use("/file",file),app.use("/client",client),app.use("/authentication",authentication),app.use("/api",api),app.use("/client/design",design),app.use(express["static"](path.join(__dirname,"public"))),app.use(express["static"](path.join(__dirname,"../client"))),app.get("/",function(e,a){a.sendFile(path.join(__dirname,"../client","index.html"))}),app.get("/admin",function(e,a){a.sendFile(path.join(__dirname,"../client","index_admin.html"))}),app.use(function(e,a,s){var i=new Error("Not Found");i.status=404,s(i)}),app.use(function(e,a,s){s.status(e.status||500),s.end(JSON.stringify({message:e.message,error:{}}))}),module.exports=app;
