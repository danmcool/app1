var app1=angular.module("app1",["ngRoute","ngResource","ngMaterial","ngMessages","materialCalendar","infinite-scroll","materialCarousel","materialCalendar"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("amber"),e.theme("user1").primaryPalette("purple").accentPalette("green"),e.theme("user2").primaryPalette("pink").accentPalette("orange"),e.theme("user3").primaryPalette("blue").accentPalette("light-blue"),e.alwaysWatchTheme(!0),e.generateThemesOnDemand(!1)}]).factory("Applications",["$resource",function(e){return e("/client/application/:id",null,{update:{method:"PUT"}})}]).factory("User",["$resource",function(e){return e("/client/user/:id",null,{update:{method:"PUT"}})}]).factory("Password",["$resource",function(e){return e("/authentication/password",null,{update:{method:"PUT"}})}]).factory("Company",["$resource",function(e){return e("/client/company/:id",null,{update:{method:"PUT"}})}]).factory("Login",["$resource",function(e){return e("/authentication/login",null,{update:{method:"PUT"}})}]).factory("UserStatus",["$resource",function(e){return e("/authentication/status",null,{update:{method:"PUT"}})}]).factory("Logout",["$resource",function(e){return e("/authentication/logout",null,{update:{method:"PUT"}})}]).factory("Register",["$resource",function(e){return e("/authentication/register",null,{update:{method:"PUT"}})}]).factory("Notify",["$resource",function(e){return e("/client/notify/:user_id",null,{update:{method:"PUT"}})}]).factory("Forms",["$resource",function(e){return e("/client/form/:id",null,{update:{method:"PUT"}})}]).factory("Value",["$resource",function(e){return e("/client/value/:id",null,{update:{method:"PUT"}})}]).factory("Share",["$resource",function(e){return e("/client/share",null,{update:{method:"PUT"}})}]).factory("Calendar",["$resource",function(e){return e("/client/calendar",null,{update:{method:"PUT"}})}]).factory("Event",["$resource",function(e){return e("/client/event/:id",null,{update:{method:"PUT"}})}]).factory("Files",["$resource",function(e){return e("/file/:id",null,{update:{method:"PUT"}})}]).factory("FileUrl",["$resource",function(e){return e("/file/url/:id",null,{update:{method:"PUT"}})}]).factory("Datas",["$resource",function(e){return e("/data/:datamodel_id/:entry_id",{datamodel_id:"@datamodel_id",entry_id:"@entry_id"},{update:{method:"PUT"}})}]).factory("SessionService",["AppTranslationService","$location","$resource","$window","Login","Logout","UserStatus","Applications","User",function(e,r,t,a,n,o,i,s,l){var d={userData:{properties:{theme:"default",uiLanguage:"auto"}},applicationName:"App1",appData:{}},u=function(e){if(!e)return"xxxxx";var r=e[d.userData.properties.correctedLanguage];return r?r:e.en},p=function(e,r){if(!e)return"xxxxx";var t=e[r];return t?t:e.en},c=function(e){if(e.applications)for(var r=0;r<e.applications.length;r++)e.applications[r].translated_name=p(e.applications[r].name,e.userData.properties.correctedLanguage),e.applications[r].translated_description=p(e.applications[r].description,e.userData.properties.correctedLanguage);d=e},f=function(){return d},m=function(t,n){if(d={},d.token=t.token,d.userData=t.user,d.userData.properties.uiLanguage&&"auto"==d.userData.properties.uiLanguage){var o=a.navigator.userLanguage||a.navigator.language;o?d.userData.properties.correctedLanguage=o.startsWith("en")?"en":o.startsWith("fr")?"fr":"en":d.userData.properties.correctedLanguage="en"}else d.userData.properties.correctedLanguage=d.userData.properties.uiLanguage;d.userData.title=(t.user.firstname?t.user.firstname:"")+" "+(t.user.lastname?t.user.lastname:"")+(t.user.company.name?" @ "+t.user.company.name:""),d.userData.name=(t.user.firstname?t.user.firstname:"")+" "+(t.user.lastname?t.user.lastname:""),d.appData=e.translate(d.userData.properties.correctedLanguage),s.query(function(e){d.applications=e;var t=d.applications,a=!1;d.userData.properties.app_score||(d.userData.properties.app_score={},a=!0);for(var o=0;o<t.length;o++)t[o].translated_name=u(t[o].name),t[o].translated_description=u(t[o].description),d.userData.properties.app_score[t[o]._id]||(d.userData.properties.app_score[t[o]._id]=75,a=!0);t.sort(function(e,r){return d.userData.properties.app_score[r._id]-d.userData.properties.app_score[e._id]}),a&&l.update({id:d.userData._id},{properties:d.userData.properties}),n?(d.applicationName=d.appData.home,y("/applications")):"/"==r.path()&&y("/applications")},function(e){})},_=function(){if(d.userData.properties.uiLanguage&&"auto"==d.userData.properties.uiLanguage){var t=a.navigator.userLanguage||a.navigator.language;t?d.userData.properties.correctedLanguage=t.startsWith("en")?"en":t.startsWith("fr")?"fr":"en":d.userData.properties.correctedLanguage="en"}else d.userData.properties.correctedLanguage=d.userData.properties.uiLanguage;i.get(function(e){m(e,!1)},function(t){d.appData=e.translate(d.userData.properties.correctedLanguage),"/login"!=r.path()&&"/register"!=r.path()&&y("/")})},g=function(e){if("public"!=d.userData.profile.type){for(var r=0;r<d.applications.length;r++)d.userData.properties.app_score[d.applications[r]._id]*=.99;d.userData.properties.app_score[e]=Math.min(100,1.02*d.userData.properties.app_score[e]),d.applications.sort(function(e,r){return d.userData.properties.app_score[r._id]-d.userData.properties.app_score[e._id]}),l.update({id:d.userData._id},{properties:d.userData.properties})}},v=function(r,t){var a=new n({user:r,password:t});a.$save(function(e){m(e,!0)},function(r){d.appData=e.translate(d.userData.properties.correctedLanguage),y("/")})},h=function(){if(o.get(),d={userData:{properties:{theme:"default",uiLanguage:"auto"}},applicationName:"App1"},d.userData.properties.uiLanguage&&"auto"==d.userData.properties.uiLanguage){var r=a.navigator.userLanguage||a.navigator.language;r?d.userData.properties.correctedLanguage=r.startsWith("en")?"en":r.startsWith("fr")?"fr":"en":d.userData.properties.correctedLanguage="en"}else d.userData.properties.correctedLanguage=d.userData.properties.uiLanguage;d.appData=e.translate(d.userData.properties.correctedLanguage),y("/")},y=function(e,t){r.url(e),t||a.scrollTo(0,0)};return{setSessionData:c,getSessionData:f,translate:u,init:_,openApp:g,login:v,logout:h,location:y}}]).factory("MapService",function(){var e=[],r=function(r){e[r]=new google.maps.Map(document.getElementById(r),{zoom:2,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,draggable:!1,mapTypeId:google.maps.MapTypeId.ROADMAP})},t=function(r,t){var a=new google.maps.Geocoder;a.geocode({address:t},function(t,a){"OK"===a&&(e[r].setCenter(t[0].geometry.location),e[r].setZoom(14))})};return{geocodeAddress:t,initMap:r}}).controller("AppCtrl",["$scope","$timeout","$mdSidenav","SessionService",function(e,r,t,a){function n(t,a,n){var o;return function(){var n=e,i=Array.prototype.slice.call(arguments);r.cancel(o),o=r(function(){o=void 0,t.apply(n,i)},a||10)}}function o(e){return n(function(){t(e).toggle()},200)}a.init(),e.sessionData=a.getSessionData(),e.$watch(function(){return a.getSessionData()},function(r,t){r!=t&&(e.sessionData=r)}),e.closeLeft=function(){t("left").close()},e.closeRight=function(){t("right").close()},e.logout=function(){t("right").close(),a.logout()},e.open=function(r){a.openApp(r._id),"url"==r.type?a.location("/url/"+r._id+"?iframe_url="+r.url):"file"==r.type?a.location("/file/"+r._id+"?iframe_file="+r.file):a.location("/workflows/"+r._id),e.closeLeft()},e.toggleLeft=o("left"),e.toggleRight=o("right")}]).config(["$routeProvider",function(e){e.when("/form/:id/:entry_id",{templateUrl:"core/forms.html",controller:"FormDetailsCtrl"}).when("/workflows/:application_id",{templateUrl:"core/workflows.html",controller:"WorkflowsCtrl"}).when("/url/:application_id",{templateUrl:"core/url.html",controller:"UrlCtrl"}).when("/file/:application_id",{templateUrl:"core/file.html",controller:"FileCtrl"}).when("/welcome",{templateUrl:"core/welcome.html",controller:"WelcomeCtrl"}).when("/register",{templateUrl:"core/register.html",controller:"RegisterCtrl"}).when("/login",{templateUrl:"core/login.html",controller:"LoginCtrl"}).when("/user",{templateUrl:"core/user.html",controller:"UserCtrl"}).when("/company",{templateUrl:"core/company.html",controller:"CompanyCtrl"}).when("/applications",{templateUrl:"core/applications.html",controller:"ApplicationsCtrl"}).when("/designer",{templateUrl:"designer/designer.html",controller:"DesignerCtrl"}).when("/application_edit/:id",{templateUrl:"designer/application.html",controller:"ApplicationEditCtrl"}).when("/application_security/:id",{templateUrl:"designer/applicationsecurity.html",controller:"ApplicationSecurityCtrl"}).when("/application_users/:id",{templateUrl:"designer/applicationusers.html",controller:"ApplicationUsersCtrl"}).when("/application_share/:id",{templateUrl:"designer/share.html",controller:"ApplicationShareCtrl"}).when("/workflow_edit/:id",{templateUrl:"designer/workflow.html",controller:"WorkflowEditCtrl"}).when("/form_edit/:id",{templateUrl:"designer/form.html",controller:"FormEditCtrl"}).when("/form_display_edit/:id",{templateUrl:"designer/display.html",controller:"FormDisplayEditCtrl"}).when("/form_action_edit/:id",{templateUrl:"designer/action.html",controller:"FormActionEditCtrl"}).when("/form_value_edit/:id",{templateUrl:"designer/value.html",controller:"FormValueEditCtrl"}).when("/datamodel",{templateUrl:"datamodel/datamodel.html",controller:"DatamodelCtrl"}).when("/datamodel/:id",{templateUrl:"datamodel/datamodeledit.html",controller:"DatamodelEditCtrl"}).otherwise({redirectTo:"/",templateUrl:"core/welcome.html",controller:"WelcomeCtrl"})}]);
