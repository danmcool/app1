var app1=angular.module("app1",["ngRoute","ngResource","ngMaterial","ngMessages","infinite-scroll","moment-picker","materialCarousel"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("amber"),e.theme("user1").primaryPalette("purple").accentPalette("green"),e.theme("user2").primaryPalette("pink").accentPalette("orange"),e.theme("user3").primaryPalette("blue").accentPalette("light-blue"),e.alwaysWatchTheme(!0),e.generateThemesOnDemand(!1)}]).factory("Applications",["$resource",function(e){return e("/client/application/:id",null,{update:{method:"PUT"}})}]).factory("User",["$resource",function(e){return e("/client/user/:id",null,{update:{method:"PUT"}})}]).factory("Password",["$resource",function(e){return e("/authentication/password",null,{update:{method:"PUT"}})}]).factory("Company",["$resource",function(e){return e("/client/company/:id",null,{update:{method:"PUT"}})}]).factory("Login",["$resource",function(e){return e("/authentication/login",null,{update:{method:"PUT"}})}]).factory("UserStatus",["$resource",function(e){return e("/authentication/status",null,{update:{method:"PUT"}})}]).factory("Logout",["$resource",function(e){return e("/authentication/logout",null,{update:{method:"PUT"}})}]).factory("Register",["$resource",function(e){return e("/authentication/register",null,{update:{method:"PUT"}})}]).factory("Notify",["$resource",function(e){return e("/client/notify/:user_id",null,{update:{method:"PUT"}})}]).factory("Forms",["$resource",function(e){return e("/client/form/:id",null,{update:{method:"PUT"}})}]).factory("Value",["$resource",function(e){return e("/client/value/:id",null,{update:{method:"PUT"}})}]).factory("Share",["$resource",function(e){return e("/client/share",null,{update:{method:"PUT"}})}]).factory("Calendar",["$resource",function(e){return e("/client/calendar",null,{update:{method:"PUT"}})}]).factory("Files",["$resource",function(e){return e("/file/:id",null,{update:{method:"PUT"}})}]).factory("FileUrl",["$resource",function(e){return e("/file/url/:id",null,{update:{method:"PUT"}})}]).factory("Datas",["$resource",function(e){return e("/data/:datamodel_id/:entry_id",{datamodel_id:"@datamodel_id",entry_id:"@entry_id"},{update:{method:"PUT"}})}]).factory("SessionService",["AppTranslationService","$location","$resource","$window","Login","Logout","UserStatus","Applications","User",function(e,a,t,o,s,i,r,n,l){var c={userData:{properties:{theme:"default",language:"en"}},applicationName:"App1",appData:{}},d=function(e){if(!e)return"xxxxx";var a=e[c.userData.properties.language];return a?a:e.en},p=function(e,a){if(!e)return"xxxxx";var t=e[a];return t?t:e.en},m=function(e){if(e.applications)for(var a=0;a<e.applications.length;a++)e.applications[a].translated_name=p(e.applications[a].name,e.userData.properties.language),e.applications[a].translated_description=p(e.applications[a].description,e.userData.properties.language);c=e},f=function(){return c},u=function(t,s){o.navigator.userLanguage||o.navigator.language;c={},c.token=t.token,c.userData=t.user,c.userData.title=(t.user.firstname?t.user.firstname:"")+" "+(t.user.lastname?t.user.lastname:"")+" @ "+(t.user.company.name?t.user.company.name:""),c.userData.name=(t.user.firstname?t.user.firstname:"")+" "+(t.user.lastname?t.user.lastname:""),c.appData=e.translate(c.userData.properties.language),n.query().$promise.then(function(e){c.applications=e;var t=c.applications,o=!1;c.userData.properties.app_score||(c.userData.properties.app_score={},o=!0);for(var i=0;i<t.length;i++)t[i].translated_name=d(t[i].name),t[i].translated_description=d(t[i].description),c.userData.properties.app_score[t[i]._id]||(c.userData.properties.app_score[t[i]._id]=75,o=!0);t.sort(function(e,a){return c.userData.properties.app_score[a._id]-c.userData.properties.app_score[e._id]}),o&&l.update({id:$scope.sessionData.userData._id},{properties:$scope.sessionData.userData.properties}),s?(c.applicationName=c.appData.home,g("/applications")):"/"==a.path()&&g("/applications")})["catch"](function(e){})},$=function(){r.get().$promise.then(function(e){u(e,!1)})["catch"](function(a){c.appData=e.translate(c.userData.properties.language),g("/")})},_=function(e){for(var a=0;a<c.applications.length;a++)c.userData.properties.app_score[c.applications[a]._id]*=.99;c.userData.properties.app_score[e]=Math.min(100,1.02*c.userData.properties.app_score[e]),c.applications.sort(function(e,a){return c.userData.properties.app_score[a._id]-c.userData.properties.app_score[e._id]}),l.update({id:c.userData._id},{properties:c.userData.properties})},v=function(a,t){var o=new s({user:a,password:t});o.$save(function(e){u(e,!0)})["catch"](function(a){c.appData=e.translate(c.userData.properties.language),g("/")})},h=function(){i.get(),c={userData:{properties:{theme:"default",language:"en"}},applicationName:"App1"},c.appData=e.translate(c.userData.properties.language),g("/")},g=function(e,t){a.url(e),t||o.scrollTo(0,0)};return{setSessionData:m,getSessionData:f,translate:d,init:$,openApp:_,login:v,logout:h,location:g}}]).factory("MapService",function(){var e={},a=function(a){e[a]=new google.maps.Map(document.getElementById(a),{zoom:2,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,draggable:!1,mapTypeId:google.maps.MapTypeId.ROADMAP})},t=function(a,t){var o=new google.maps.Geocoder;o.geocode({address:t},function(t,o){if("OK"===o){e[a].setCenter(t[0].geometry.location),e[a].setZoom(14);new google.maps.Marker({map:e[a],position:t[0].geometry.location})}})};return{geocodeAddress:t,initMap:a}}).controller("AppCtrl",["$scope","$timeout","$mdSidenav","SessionService",function(e,a,t,o){function s(t,o,s){var i;return function(){var s=e,r=Array.prototype.slice.call(arguments);a.cancel(i),i=a(function(){i=void 0,t.apply(s,r)},o||10)}}function i(e){return s(function(){t(e).toggle()},200)}o.init(),e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),e.closeLeft=function(){t("left").close()},e.closeRight=function(){t("right").close()},e.logout=function(){t("right").close(),o.logout()},e.open=function(a){o.openApp(a._id),"url"==a.type?o.location("/url/"+a._id+"?iframe_url="+a.url):"file"==a.type?o.location("/file/"+a._id+"?iframe_file="+a.file):o.location("/workflows/"+a._id),e.closeLeft()},e.toggleLeft=i("left"),e.toggleRight=i("right")}]).config(["$routeProvider",function(e){e.when("/form/:id/:entry_id",{templateUrl:"core/forms.html",controller:"FormDetailsCtrl"}).when("/workflows/:application_id",{templateUrl:"core/workflows.html",controller:"WorkflowsCtrl"}).when("/url/:application_id",{templateUrl:"core/url.html",controller:"UrlCtrl"}).when("/file/:application_id",{templateUrl:"core/file.html",controller:"FileCtrl"}).when("/welcome",{templateUrl:"core/welcome.html",controller:"WelcomeCtrl"}).when("/register",{templateUrl:"core/register.html",controller:"RegisterCtrl"}).when("/login",{templateUrl:"core/login.html",controller:"LoginCtrl"}).when("/user",{templateUrl:"core/user.html",controller:"UserCtrl"}).when("/company",{templateUrl:"core/company.html",controller:"CompanyCtrl"}).when("/applications",{templateUrl:"core/applications.html",controller:"ApplicationsCtrl"}).when("/designer",{templateUrl:"designer/designer.html",controller:"DesignerCtrl"}).when("/application_edit/:id",{templateUrl:"designer/application.html",controller:"ApplicationEditCtrl"}).when("/application_share/:id",{templateUrl:"designer/share.html",controller:"ApplicationShareCtrl"}).when("/workflow_edit/:id",{templateUrl:"designer/workflow.html",controller:"WorkflowEditCtrl"}).when("/form_edit/:id",{templateUrl:"designer/form.html",controller:"FormEditCtrl"}).when("/form_display_edit/:id",{templateUrl:"designer/display.html",controller:"FormDisplayEditCtrl"}).when("/form_action_edit/:id",{templateUrl:"designer/action.html",controller:"FormActionEditCtrl"}).when("/form_value_edit/:id",{templateUrl:"designer/value.html",controller:"FormValueEditCtrl"}).when("/datamodel",{templateUrl:"datamodel/datamodel.html",controller:"DatamodelCtrl"}).when("/datamodel/:id",{templateUrl:"datamodel/datamodeledit.html",controller:"DatamodelEditCtrl"}).otherwise({redirectTo:"/",templateUrl:"core/welcome.html",controller:"WelcomeCtrl"})}]);
