<md-content ng-show="form.type == 'list'" layout-padding>
    <md-toolbar layout="row" class="md-hue-1">
        <div class="md-toolbar-tools">
            <span>{{form.name}}</span>
        </div>
    </md-toolbar>
    <md-list flex>
        <div infinite-scroll="getNextData()" infinite-scroll-distance="10">
            <md-list-item class="md-3-line" ng-repeat="data in datas">
                <div class="md-list-item-text" layout="column">
                    <h3>{{data[form.display.title]}}</h3>
                    <h4>{{data[form.display.subtitle]}}</h4>
                    <p>{{data[form.display.date]|date:form.date_format}}</p>
                </div>
                <div ng-repeat="action in form.item_actions" class="md-secondary" layout="row">
                    <div ng-switch="action.action">
                        <div ng-switch-when="delete">
                            <md-button flex-gt-xs ng-click="delete(action.formula, action.next_form_id, data)">{{action.name}}</md-button>
                        </div>
                        <div ng-switch-when="link">
                            <md-button flex-gt-xs ng-click="link(action.formula, action.next_form_id, data)">{{action.name}}</md-button>
                        </div>
                    </div>
                </div>
            </md-list-item>
        </div>
    </md-list flex>
    <div layout="row" layout-align="end" flex>
        <div ng-repeat="action in form.actions">
            <div ng-switch="action.action">
                <div ng-switch-when="create">
                    <md-button flex-gt-xs ng-click="create(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                </div>
                <div ng-switch-when="modify">
                    <md-button flex-gt-xs ng-click="modify(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                </div>
                <div ng-switch-when="delete">
                    <md-button flex-gt-xs ng-click="delete(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                </div>
                <div ng-switch-when="link">
                    <md-button flex-gt-xs ng-click="link(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                </div>
            </div>
        </div>
    </div>
</md-content>
<md-content ng-show="form.type == 'form'" class="md-inline-form" layout-padding>
    <md-toolbar layout="row" class="md-hue-1">
        <div class="md-toolbar-tools">
            <span>{{form.name}}</span>
        </div>
    </md-toolbar>
    <form name="dynamicForm">
        <div ng-repeat="field in form.display">
            <div ng-switch="field.display">

                <div ng-switch-when="list">
                    <md-list flex>
                        <div infinite-scroll="getNextData()" infinite-scroll-distance="10">
                            <md-list-item class="md-3-line" ng-repeat="data in datas">
                                <div class="md-list-item-text" layout="column">
                                    <h3>{{data[form.display.title]}}</h3>
                                    <h4>{{data[form.display.subtitle]}}</h4>
                                    <p>{{data[form.display.date]|date:form.date_format}}</p>
                                </div>
                                <div ng-repeat="action in form.item_actions" class="md-secondary" layout="row">
                                    <div ng-switch="action.action">
                                        <div ng-switch-when="delete">
                                            <md-button flex-gt-xs ng-click="delete(action.formula, action.next_form_id, data)">{{action.name}}</md-button>
                                        </div>
                                        <div ng-switch-when="link">
                                            <md-button flex-gt-xs ng-click="link(action.formula, action.next_form_id, data)">{{action.name}}</md-button>
                                        </div>
                                    </div>
                                </div>
                            </md-list-item>
                        </div>
                    </md-list flex>
                </div>
                <div ng-switch-when="shorttext">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.name}}</p>
                                <p class="md-body-1">{{data[field.name]}}</p>
                            </md-input-container>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.name}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.name}}" ng-model="data[field.name]" md-minlength="field.validation.min_size" ng-minlength="field.validation.min_size" md-maxlength="field.validation.max_size" ng-maxlength="field.validation.max_size">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength', 'pattern']">
                                        Your input must be between {{field.validation.min_size}} and {{field.validation.max_size}} characters long.
                                    </div>
                                </div>
                            </md-input-container>
                        </div>
                    </div>
                </div>

                <div ng-switch-when="editor">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.name}}</p>
                                <p class="md-body-1">{{data[field.name]}}</p>
                            </md-input-container>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.name}}</label>
                                <textarea ng-disabled="field.disabled" ng-required="field.required" name="{{field.name}}" ng-model="data[field.name]" md-minlength="field.validation.min_size" ng-minlength="field.validation.min_size" md-maxlength="field.validation.max_size" ng-maxlength="field.validation.max_size" rows="8"></textarea>
                            </md-input-container>
                        </div>
                    </div>
                </div>

                <div ng-switch-when="feed">
                    <p class="subtitle">{{field.previous}}</p>
                    <div ng-repeat="existing_feed in data[field.name]">
                        <p class="md-body-2">{{existing_feed.from}} {{existing_feed.date|date:field.date_format}}</p>
                        <p class="md-body-1">{{existing_feed.text}}</p>
                    </div>
                    <md-input-container class="md-block" flex-gt-xs ng-if="!field.disabled">
                        <label>{{field.name}}</label>
                        <textarea ng-disabled="field.disabled" ng-required="field.required" name="{{field.name}}" ng-model="form.newvalues[field.name]" md-minlength="field.validation.min_size" ng-minlength="field.validation.min_size" md-maxlength="field.validation.max_size" ng-maxlength="field.validation.max_size" rows="4"></textarea>
                    </md-input-container>
                </div>

                <div ng-switch-when="address">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <div id="map"></div>
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.address_line1}}</p>
                                <p class="md-body-1">{{data[field.address_line1]}}</p>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.address_line2}}</p>
                                <p class="md-body-1">{{data[field.address_line2]}}</p>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.address_city}}</p>
                                <p class="md-body-1">{{data[field.address_city]}}</p>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.address_state}}</p>
                                <p class="md-body-1">{{data[field.address_state]}}</p>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.address_postal_code}}</p>
                                <p class="md-body-1">{{data[field.address_postal_code]}}</p>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.address_country}}</p>
                                <p class="md-body-1">{{data[field.address_country]}}</p>
                            </md-input-container>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_line1}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_line1}}" ng-model="data[field.address_line1]" md-minlength="field.validation.address_line1.min_size" ng-minlength="field.validation.min_size" md-maxlength="field.validation.min_size" ng-maxlength="field.validation.min_size">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 1 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_line2}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_line2}}" ng-model="data[field.address_line2]" md-minlength="0" ng-minlength="0" md-maxlength="200" ng-maxlength="200">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 0 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_city}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_city}}" ng-model="data[field.address_city]" md-minlength="1" ng-minlength="1" md-maxlength="200" ng-maxlength="200">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 1 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_state}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_state}}" ng-model="data[field.address_state]" md-minlength="0" ng-minlength="0" md-maxlength="200" ng-maxlength="200">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 0 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_postal_code}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_postal_code}}" ng-model="data[field.address_postal_code]" md-minlength="0" ng-minlength="0" md-maxlength="200" ng-maxlength="200">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 0 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_country}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_country}}" ng-model="data[field.address_country]" md-minlength="0" ng-minlength="0" md-maxlength="200" ng-maxlength="200">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 0 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.address_line2}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" name="{{field.address_line2}}" ng-model="data[field.address_line2]" md-minlength="0" ng-minlength="0" md-maxlength="200" ng-maxlength="200">
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength']">
                                        Your input must be between 0 and 200 characters long.
                                    </div>
                                </div>
                            </md-input-container>
                        </div>
                    </div>

                    <p class="subtitle">{{field.previous}}</p>
                    <div ng-repeat="existing_feed in data[field.name]">
                        <p class="md-body-2">{{existing_feed.from}} {{existing_feed.date|date:field.date_format}}</p>
                        <p class="md-body-1">{{existing_feed.text}}</p>
                    </div>
                    <md-input-container class="md-block" flex-gt-xs ng-if="!field.disabled">
                        <label>{{field.name}}</label>
                        <textarea ng-disabled="field.disabled" ng-required="field.required" name="{{field.name}}" ng-model="form.newvalues[field.name]" md-minlength="field.validation.min_size" ng-minlength="field.validation.min_size" md-maxlength="field.validation.max_size" ng-maxlength="field.validation.max_size" rows="4"></textarea>
                    </md-input-container>
                </div>

                <div ng-switch-when="file">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <p class="subtitle">{{field.previous}}</p>
                            <div ng-repeat="existing_file in data[field.name]">
                                <a class="md-body-2" href="/file/{{existing_file.id}}">
                                    <p class="md-body-2">{{existing_file.name}}</p>
                                </a>
                            </div>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs ng-if="!field.disabled">
                                <input multiple accept="image/*" type="file" ng-disabled="field.disabled" ng-required="field.required" aria-label="{{field.name}}" name="{{field.name}}" ng-model="form.newvalues[field.name]" onchange="angular.element(this).scope().changeFiles(this)">
                            </md-input-container>
                        </div>
                    </div>
                </div>
                <div ng-switch-when="selection">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.name}}</p>
                                <p class="md-body-1">{{data[field.name]}}</p>
                            </md-input-container>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.name}}</label>
                                <md-select name="{{field.name}}" ng-model="data[field.name]" ng-disabled="field.disabled" ng-required="field.required">
                                    <md-option ng-repeat="value in field.values" value="{{value}}">{{value}}</md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                    </div>
                </div>
                <div ng-switch-when="check">
                    <md-input-container class="md-block" flex-gt-xs>
                        <md-checkbox ng-disabled="field.disabled" name="{{field.name}}" ng-model="data[field.name]">{{field.name}}</md-checkbox>
                    </md-input-container>
                </div>
                <div ng-switch-when="calendar">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.name}}</p>
                                <p class="md-body-1">{{data[field.name]|date:"yyyy-MM-dd"}}</p>
                            </md-input-container>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.name}}</label>
                                <md-datepicker ng-disabled="field.disabled" md-hide-icons="triangle" ng-required="field.required" name="{{field.name}}" ng-model="data[field.name]"></md-datepicker>
                            </md-input-container>
                        </div>
                    </div>
                </div>
                <div ng-switch-when="email">
                    <div ng-switch="field.disabled">
                        <div ng-switch-when="true">
                            <md-input-container class="md-block" flex-gt-xs>
                                <p class="subtitle">{{field.name}}</p>
                                <p class="md-body-1">{{data[field.name]}}</p>
                            </md-input-container>
                        </div>
                        <div ng-switch-when="false">
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>{{field.name}}</label>
                                <input ng-disabled="field.disabled" ng-required="field.required" type="email" name="{{field.name}}" ng-model="data[field.name]" md-minlength="field.validation.min_size" ng-minlength="field.validation.min_size" md-maxlength="field.validation.max_size" ng-maxlength="field.validation.max_size" ng-pattern="/^.+@.+\..+$/" />
                                <div ng-messages="dynamicForm.$field.name.$error" role="alert">
                                    <div ng-message-exp="['required', 'minlength', 'maxlength', 'pattern']">
                                        Your input must be between {{field.validation.min_size}} and {{field.validation.max_size}} characters long and look like an e-mail address.
                                    </div>
                                </div>
                            </md-input-container>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div layout="row" layout-align="end" flex>
            <div ng-repeat="action in form.actions">
                <div ng-switch="action.action">
                    <div ng-switch-when="create">
                        <md-button flex-gt-xs ng-disabled="dynamicForm.$invalid" ng-click="create(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                    </div>
                    <div ng-switch-when="modify">
                        <md-button flex-gt-xs ng-disabled="dynamicForm.$invalid" ng-click="modify(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                    </div>
                    <div ng-switch-when="delete">
                        <md-button flex-gt-xs ng-click="delete(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                    </div>
                    <div ng-switch-when="link">
                        <md-button flex-gt-xs ng-click="link(action.formula, action.next_form_id, data)" class="md-primary">{{action.name}}</md-button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</md-content>
