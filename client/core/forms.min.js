app1.controller("FormDetailsCtrl",["$scope","$routeParams","$location","$route","$resource","$mdDialog","SessionService","MapService","Forms","Value","Files","Datas","Share","Calendar","Notify","Event",function($scope,$routeParams,$location,$route,$resource,$mdDialog,SessionService,MapService,Forms,Value,Files,Datas,Share,Calendar,Notify,Event){$scope.sessionData=SessionService.getSessionData(),$scope.$watch(function(){return SessionService.getSessionData()},function(e,t){e!=t&&($scope.sessionData=e,updateAppName())}),$scope.calculation=function(object,calculation){var data=object;return eval(calculation)},$scope.resolvePath=function(e,t){return t?t.split(".").reduce(function(e,t){return e?e[t]:void 0},e):void 0},$scope.resolvePathUpdate=function(e,t,o){return t?void t.split(".").reduce(function(e,t,a,r){return a<r.length-1?(e[t]||(e[t]={}),e[t]):void(e[t]=o)},e):void 0};var toString=function(e){return e?e+"":""},updateAppName=function(){var e=$scope.sessionData.applications;if(e)for(var t=0;t<e.length;t++)if(e[t]._id==$routeParams.application_id){$scope.sessionData.applicationName=SessionService.translate(e[t].name),$scope.sessionData.application_id=$routeParams.application_id,SessionService.setSessionData($scope.sessionData);break}};$scope.data={},$scope.dataLoaded=!1,$scope.localdata={},$scope.form={},$scope.skip=0,$scope.limit=10,$scope.datas=[],$scope.stopScroll=!1,$scope.tempStopScroll=!1,$scope.files={},$scope.currentFile={},$scope.filesCount={},$scope.search_criteria="",$scope.show_search=!1,$scope.search_text="",$scope.formLoaded=!1,$scope.slides=[],$scope.appointments=[],$scope.selectedDate=void 0,$scope.today=new Date,$scope.today_plus_1_year=new Date($scope.today.getTime()+31536e6),$scope.hours=[],$scope.minutes=[],$scope.full_hours=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],$scope.full_minutes=["00","15","30","45"],$scope.days=[{value:0,name:{en:"Sunday",fr:"Dimanche"}},{value:1,name:{en:"Monday",fr:"Lundi"}},{value:2,name:{en:"Tuesday",fr:"Mardi"}},{value:3,name:{en:"Wednesday",fr:"Mercredi"}},{value:4,name:{en:"Thursday",fr:"Jeudi"}},{value:5,name:{en:"Friday",fr:"Vendredi"}},{value:6,name:{en:"Saturday",fr:"Samedi"}}],$scope.getNextData=function(){if($scope.formLoaded&&!$scope.stopScroll&&!$scope.tempStopScroll&&$scope.form.datamodel){var e=$scope.limit,t=$scope.skip;$scope.skip+=$scope.limit,$scope.tempStopScroll=!0,Datas.query({datamodel_id:$scope.form.datamodel._id,search_criteria:$scope.search_criteria,search_text:$scope.search_text,skip:t,limit:e,sort_by:$scope.form.sort_by}).$promise.then(function(e){e.length<$scope.limit&&($scope.stopScroll=!0);for(var t=0;t<e.length;t++)$scope.datas.push(e[t]);$scope.tempStopScroll=!1})}};var initText=function(){for(var e=0;e<$scope.days.length;e++)$scope.days[e].translated_name=SessionService.translate($scope.days[e].name);if($scope.form.title=SessionService.translate($scope.form.name),$scope.form.actions)for(var e=0;e<$scope.form.actions.length;e++)$scope.form.actions[e].translated_name=SessionService.translate($scope.form.actions[e].name);if($scope.form.fields)for(var t=$scope.form.fields,e=0;e<t.length;e++){if("address"==t[e].display)for(var o=Object.keys($scope.form.datamodel.projection),a=0;a<o.length;a++){var r=$scope.form.datamodel.projection[o[a]];r.path==t[e].full_path&&("address_line1"==r.technical_name?t[e].address_line1_translated_name=SessionService.translate(r.name):"address_line2"==r.technical_name?t[e].address_line2_translated_name=SessionService.translate(r.name):"address_city"==r.technical_name?t[e].address_city_translated_name=SessionService.translate(r.name):"address_state"==r.technical_name?t[e].address_state_translated_name=SessionService.translate(r.name):"address_postal_code"==r.technical_name?t[e].address_postal_code_translated_name=SessionService.translate(r.name):"address_country"==r.technical_name&&(t[e].address_country_translated_name=SessionService.translate(r.name)))}else if(("list"==t[e].display||"item"==t[e].display)&&t[e].item_actions)for(var a=0;a<t[e].item_actions.length;a++)t[e].item_actions[a].translated_name=SessionService.translate(t[e].item_actions[a].name);t[e].text&&""!=t[e].text.en?t[e].translated_name=SessionService.translate(t[e].text):"list"!=t[e].display&&"item"!=t[e].display&&(t[e].translated_name=SessionService.translate($scope.form.datamodel.projection[t[e].projectionid].name)),t[e].previous&&(t[e].translated_previous=SessionService.translate(t[e].previous))}},updateValuesForm=function(e,t){var o=$scope.form.fields[e];for(o.values=[],o.values_key={},k=0;k<t.length;k++)o.values.push({_id:t[k]._id,name:SessionService.translate(t[k].name)}),o.values_key[t[k]._id]=SessionService.translate(t[k])},updateValuesTitle=function(e,t){var o=$scope.form.fields[e];for(o.title_values={},k=0;k<t.length;k++)o.title_values[t[k]._id]=SessionService.translate(t[k].name)},updateValuesSubTitle=function(e,t){var o=$scope.form.fields[e];for(o.subtitle_values={},k=0;k<t.length;k++)o.subtitle_values[t[k]._id]=SessionService.translate(t[k].name)},updateValuesItems=function(e,t){var o=$scope.form.fields[e],a=o.items+"_values";o[a]=t,$scope.data[o.items]=t},initComponents=function(){for(var formFields=$scope.form.fields,formValues=$scope.form.values,i=0;i<formFields.length;i++)if("address"==formFields[i].display){if($scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path),formFields[i].disabled){MapService.initMap("map"+field_id);var address=$scope.localdata[formFields[i].id];MapService.geocodeAddress("map"+formFields[i].full_path,(address.address_line1?address.address_line1+",":"")+(address.address_line2?address.address_line2+",":"")+(address.address_city?address.address_city+",":"")+(address.address_postal_code?address.address_postal_code+",":"")+(address.address_country?address.address_country+",":""))}}else if("selection"==formFields[i].display||"currency"==formFields[i].display){$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path);for(var j=0;j<formValues.length;j++)if(formFields[i].listofvalues==formValues[j]._id){if("list"==formValues[j].type)updateValuesForm(i,formValues[j].values);else{var itemValues=formValues[j].values;itemValues.index=i,Value.update({id:formValues[j]._id,type:formValues[j].type},itemValues).$promise.then(function(e){updateValuesForm(e.index,e.values)})}break}}else if("calendar"==formFields[i].display)$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path),$scope.localdata[formFields[i].id]&&($scope.localdata[formFields[i].id]=new Date($scope.localdata[formFields[i].id]));else if("calculation"==formFields[i].display){var data=$scope.data;$scope.localdata[formFields[i].id]=eval(formFields[i].calculation)}else if("list"==formFields[i].display){$scope.show_search=!0;for(var j=0;j<formValues.length;j++)if(formFields[i].title_listofvalues==formValues[j]._id)if("list"==formValues[j].type)updateValuesTitle(i,formValues[j].values);else{var itemValues=formValues[j].values;itemValues.index=i,Value.update({id:formValues[j]._id,type:formValues[j].type},itemValues).$promise.then(function(e){updateValuesTitle(e.index,e.values)})}else if(formFields[i].subtitle_listofvalues==formValues[j]._id)if("list"==formValues[j].type)updateValuesSubTitle(i,formValues[j].values);else{var itemValues=formValues[j].values;itemValues.index=i,Value.update({id:formValues[j]._id,type:formValues[j].type},itemValues).$promise.then(function(e){updateValuesSubTitle(e.index,e.values)})}$scope.form.search_criteria&&($scope.search_criteria=$scope.form.search_criteria),$scope.search_criteria=$scope.search_criteria.replace(/@_user_id/g,$scope.sessionData.userData._id);var keysOfParameters=Object.keys($routeParams);for(k=0,l=keysOfParameters.length;k<l;k++)$scope.search_criteria=$scope.search_criteria.replace("@"+keysOfParameters[k],$routeParams[keysOfParameters[k]]);$scope.formLoaded=!0,$scope.getNextData()}else if("item"==formFields[i].display){for(var j=0;j<formValues.length;j++)if(formFields[i].listofvalues==formValues[j]._id)if("list"==formValues[j].type)updateValuesItems(i,formValues[j].values);else{var itemValues={index:i};itemValues.relation=formValues[j].values.relation,itemValues.id_list=$scope.data[formFields[i].items],Value.update({id:formValues[j]._id,type:formValues[j].type},itemValues).$promise.then(function(e){updateValuesItems(e.index,e.values)})}}else if("file"==formFields[i].display)$scope.currentFile[formFields[i].id]=0,$scope.filesCount[formFields[i].id]=0,$scope.files[formFields[i].id]=[],$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path);else if("appointment_properties"==formFields[i].display)$scope.data._appointment_properties&&$scope.data._appointment_properties.non_stop||($scope.data._appointment_properties={non_stop:{enabled:!0}},$scope.updateWholeWeek($scope.data._appointment_properties));else if("image"==formFields[i].display){if($scope.currentFile[formFields[i].id]=0,$scope.filesCount[formFields[i].id]=0,$scope.files[formFields[i].id]=[],$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path),$scope.localdata[formFields[i].id])for(var j=0;j<$scope.localdata[formFields[i].id].length;j++)$scope.slides.push({url:"/file/"+$scope.localdata[formFields[i].id][j]._id,caption:""})}else $scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path)};Forms.get({id:$routeParams.id},function(e){$scope.form=e;var t=$scope.form.display;$scope.form.fields=[];var o="";if(t)for(var a=0;a<t.length;a++)for(var r=0;r<t[a].blocks.length;r++)for(var s=0;s<t[a].blocks[r].fields.length;s++){var n=t[a].blocks[r].fields[s];$scope.form.fields.push(n),"list"==n.display||"item"==n.display||!n.projectionid||"item"!=$scope.form.datamodel.projection[n.projectionid].type&&"reference"!=$scope.form.datamodel.projection[n.projectionid].type||(o=o+$scope.form.datamodel.projection[n.projectionid].full_path+" ")}updateAppName(),initText(),$scope.form.datamodel&&("0"==$routeParams.entry_id?($scope.data=new Datas({datamodel_id:$scope.form.datamodel._id}),$scope.dataLoaded=!0,initComponents()):Datas.get({datamodel_id:$scope.form.datamodel._id,entry_id:$routeParams.entry_id,populate:o.trim()},function(e){$scope.data=e,$scope.dataLoaded=!0,initComponents()}))});var rand=function(){return Math.random().toString(16).substr(2)},gotoNextForm=function(e,t,o){if("home"==t)SessionService.location("/workflows/"+$scope.sessionData.application_id);else{var a="/form/"+t+"/";if(o&&o._id){if(a=a+o._id+"?application_id="+$routeParams.application_id,e)for(keys=Object.keys(e),i=0;i<keys.length;i++)a=a+"&"+e[keys[i]]+"="+o[e[keys[i]]]}else a=a+"0?application_id="+$routeParams.application_id;a!=$location.path()?SessionService.location(a):$route.reload()}};$scope.uploadFile=function(e,t,o,a){const r=new XMLHttpRequest;r.open("PUT",t),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?($scope.currentFile[a]++,$scope.currentFile[a]>$scope.filesCount[a]?(document.getElementById("file_upload_"+a).textContent=$scope.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload_"+a).textContent=""},4e3)):document.getElementById("file_upload_"+a).textContent=$scope.sessionData.appData.uploading_in_progress+" "+$scope.currentFile[a]+"/"+$scope.filesCount[a]):alert("Could not upload file."))},r.send(e)},changeFilesInFormsJS=function(e,t){if(0!=e.length)for($scope.localdata[t]||($scope.localdata[t]=[]),$scope.filesCount[t]=e.length,$scope.currentFile[t]=1,document.getElementById("file_upload_"+t).textContent=$scope.sessionData.appData.uploading_in_progress+" "+$scope.currentFile[t]+"/"+$scope.filesCount[t],i=0;i<$scope.filesCount[t];i++){var o=new Files({name:e[i].name,type:e[i].type});$scope.files[t].push(e[i]),o.$save().then(function(e){for(var o=0;o<$scope.files[t].length;o++)$scope.files[t][o].name==e.file.name&&($scope.localdata[t].push({_id:e.file._id,name:e.file.name,type:e.file.type}),$scope.files[t][o]._id=e.file._id,$scope.uploadFile($scope.files[t][o],e.signedRequest,e.url,t))})}},$scope.removeFile=function(e,t){for(var o=$scope.localdata[t],a=0;a<o.length;a++)if(o[a]._id==e){o.splice(a,1),Files.remove({id:e}).$promise.then(function(o){for(var a=0;a<$scope.files[t].length;a++)if($scope.files[t][a]._id==e){$scope.files[t].splice(a,1);break}})["catch"](function(e){});break}};var computeDateKey=function(e){return[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-")};$scope.updateWholeWeek=function(e){if(e.days||(e.days=[]),e.non_stop.enabled)for(var t=0;7>t;t++)e.days[t]={whole_day:!0,enabled:!0},$scope.updateWholeDay(e.days[t]);else for(var t=0;7>t;t++)e.days[t]={whole_day:!1,enabled:!1},$scope.updateWholeDay(e.days[t])},$scope.updateWholeDay=function(e){e.whole_day?(e.start_time={hours:"00",minutes:"00"},e.end_time={hours:"24",minutes:"00"}):(e.start_time={hours:"08",minutes:"00"},e.end_time={hours:"19",minutes:"00"})},$scope.updateDate=function(e,t,o){if(o.date){var a=o.date;if($scope.hours=[],$scope.data._appointment_properties&&$scope.data._appointment_properties.days&&$scope.data._appointment_properties.days[a.getDay()])for(var r=$scope.data._appointment_properties.days[a.getDay()],s=0;s<$scope.full_hours.length;s++)$scope.full_hours[s].localeCompare(r.start_time.hours)>=0&&$scope.full_hours[s].localeCompare(r.end_time.hours)<=0&&$scope.hours.push($scope.full_hours[s]);$scope.hours.length>0?$scope.minutes=["00","15","30","45"]:$scope.minutes=[],a.setHours(parseInt(o.hours?o.hours:"0")),a.setMinutes(parseInt(o.minutes?o.minutes:"0")),a.setSeconds(0),a.setMilliseconds(0),$scope.localdata[e]||($scope.localdata[e]={}),$scope.localdata[e][t]=a}},$scope.dayAvailable=function(e){var t=new Date;if(t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t>e)return!1;computeDateKey(e);return $scope.data._appointment_properties&&$scope.data._appointment_properties.days&&$scope.data._appointment_properties.days[e.getDay()]&&$scope.data._appointment_properties.days[e.getDay()].enabled?!0:!1},$scope.dayContent=function(e){var t=new Date;if(t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t>e)return"";var o=computeDateKey(e);return $scope.data._appointments&&$scope.data._appointments[o]&&$scope.data._appointments[o].length>0?""+$scope.data._appointments[o].length:""},$scope.dayClick=function(e){$scope.selectedDate=e;var t=computeDateKey(e);$scope.data._appointments&&$scope.data._appointments[t]&&$scope.data._appointments[t].length>0?$scope.appointments=$scope.data._appointments[t].sort(function(e,t){return 60*e.start_time.hours+1*e.start_time.minutes-(60*t.start_time.hours+1*t.start_time.minutes)}):$scope.appointments=[]};var updateComponents=function(e,t,o){o._user=$scope.sessionData.userData._id;for(var a=$scope.form.fields,r=0;r<a.length;r++)"feed"==a[r].display?e.newvalues&&e.newvalues[a[r].id]&&e.newvalues[a[r].id].length>0&&($scope.localdata[a[r].id]||($scope.localdata[a[r].id]=[]),$scope.localdata[a[r].id].push({text:e.newvalues[a[r].id],from:$scope.sessionData.userData.name,user:$scope.sessionData.userData.user,date:Date.now()})):"list"!=a[r].display&&"item"!=a[r].display&&$scope.resolvePathUpdate(o,a[r].full_path,$scope.localdata[a[r].id]);t&&$scope.resolvePathUpdate(o,t.full_path,t.value)},updateErrorAlert=function(){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.new_document_version).textContent($scope.sessionData.appData.already_modified_document).ok($scope.sessionData.appData.ok))},errorAlert=function(e){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.error).textContent(e).ok($scope.sessionData.appData.ok))},notify=function(e,t,o,a){if(e){var r;if("current"==e)r=$scope.sessionData.userData._id;else if("owner"==e)r=$scope.data._user;else{if("item"!=e)return;r=itemId}if(r&&t&&o){for(var s=SessionService.translate(o),n=s.match(/@\w*@/g),i=0;i<n.length;i++)"@@"!=n[i]&&(s=s.replace(new RegExp(n[i],"g"),$scope.data[n[i].replace(/@/g,"")]));Notify.update({user_id:r},{email_title:SessionService.translate(t),email_html:s})}}};$scope.create=function(e,t,o,a,r,s,n){updateComponents($scope.form,o,$scope.data),$scope.data.$save().then(function(o){notify(r,s,n),gotoNextForm(e,t,a?o:null)})["catch"](function(e){$scope.data=e.data})},$scope.modify=function(e,t,o,a,r,s,n){updateComponents($scope.form,o,$scope.data),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data).$promise.then(function(o){notify(r,s,n),gotoNextForm(e,t,a?o:null)})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope["delete"]=function(e,t,o,a,r){$mdDialog.show($mdDialog.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.confirmation).textContent($scope.sessionData.appData.removal_confirmation).ok($scope.sessionData.appData.ok).cancel($scope.sessionData.appData.cancel)).then(function(){Datas.remove({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id}).$promise.then(function(s){notify(o,a,r),gotoNextForm(e,t,null)})["catch"](function(e){})})},$scope.link=function(e,t,o,a,r,s){notify(a,r,s),gotoNextForm(e,t,o?$scope.data:null)},$scope.subscribe=function(e,t,o,a,r,s,n,i){updateComponents($scope.form,o,$scope.data),$scope.resolvePath($scope.data,actionItem).push($scope.sessionData.userData._id),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:data._id},$scope.data).$promise.then(function(o){notify(s,n,i),gotoNextForm(e,t,a?$scope.data:null)})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope.unsubscribe=function(e,t,o,a,r,s,n,i){updateComponents($scope.form,o,$scope.data);for(var d=$scope.resolvePath($scope.data,r),c=d.length-1;c>=0;c--)(d[c]==$scope.sessionData.userData._id||d[c]._id==$scope.sessionData.userData._id)&&d.splice(c,1);Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data).$promise.then(function(o){notify(s,n,i),gotoNextForm(e,t,a?$scope.data:null)})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope.deleteItem=function(e,t,o,a,r,s,n,i){$mdDialog.show($mdDialog.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.confirmation).textContent($scope.sessionData.appData.removal_confirmation).ok($scope.sessionData.appData.ok).cancel($scope.sessionData.appData.cancel)).then(function(){updateComponents($scope.form,o,$scope.data);for(var d=$scope.resolvePath($scope.data,a),c=d.length-1;c>=0;c--)(d[c]==r||d[c]._id==r)&&d.splice(c,1);Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data).$promise.then(function(o){notify(s,n,i,r),gotoNextForm(e,t,$scope.data)})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})})},$scope.moveItem=function(e,t,o,a,r,s,n,i,d){updateComponents($scope.form,o,$scope.data);for(var c=$scope.resolvePath($scope.data,a),l=c.length-1;l>=0;l--)(c[l]==r||c[l]._id==r)&&c.splice(l,1);$scope.resolvePath($scope.data,s).push(r),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data).$promise.then(function(o){notify(n,i,d,r),gotoNextForm(e,t,$scope.data)})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope.modifyList=function(e,t,o,a,r,s,n){updateComponents($scope.form,o,a),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:a._id},a).$promise.then(function(o){notify(r,s,n),gotoNextForm(e,t,o)})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope.deleteList=function(e,t,o,a,r,s){$mdDialog.show($mdDialog.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.confirmation).textContent($scope.sessionData.appData.removal_confirmation).ok($scope.sessionData.appData.ok).cancel($scope.sessionData.appData.cancel)).then(function(){Datas.remove({datamodel_id:$scope.form.datamodel._id,entry_id:o._id}).$promise.then(function(o){notify(a,r,s),gotoNextForm(e,t,null)})["catch"](function(e){})})},$scope.linkList=function(e,t,o,a,r,s){notify(a,r,s),gotoNextForm(e,t,o)},$scope.download=function(e,t,o){for(var a="sep=,\n",r=0;r<t.attributes.length;r++)a+='"'+t.attributes[r]+'","'+toString($scope.resolvePath(e,t.attributes[r])).replace(/\"/g,'""')+'"\n';for(var r=0;r<t.items.length;r++)if(a+='"'+t.items[r].name+'","'+e[t.items[r].name].length+'"\n',e[t.items[r].name].length>0){for(var s=0;s<t.items[r].attributes.length;s++)a+='"'+t.items[r].attributes[s]+'",';a+="\n";for(var n=$scope.resolvePath(e,t.items[r].name),i=0;i<n.length;i++){for(var s=0;s<t.items[r].attributes.length;s++)a+='"'+toString($scope.resolvePath(n[i],t.items[r].attributes[s])).replace(/\"/g,'""')+'",';a+="\n"}}var d=document.createElement("a");if(d.setAttribute("target","_blank"),void 0!==Blob){var c=new Blob([a],{type:"text/csv"});d.setAttribute("href",URL.createObjectURL(c)),navigator.msSaveBlob?navigator.msSaveBlob(c,e[o]+".csv"):(d.setAttribute("download",e[o]+".csv"),d.click())}else d.setAttribute("href","data:text/csv,"+encodeURIComponent(a)),d.setAttribute("download",e[o]+".csv"),document.body.appendChild(d),d.click(),document.body.removeChild(d)},$scope.share=function(e,t,o,a,r,s,n){updateComponents($scope.form,o,n),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:n._id},n).$promise.then(function(o){Share.update({form_id:s,datamodel_id:$scope.form.datamodel._id,data_id:n._id,email:n[r],key:a.key,value:a.value}).$promise.then(function(o){gotoNextForm(e,t,n)})})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope.calendar=function(e,t,o,a,r,s,n){updateComponents($scope.form,o,n),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:n._id},n).$promise.then(function(o){Calendar.get({project_name:n[a],start_date:n[r],end_date:n[s],user_id:n._user}).$promise.then(function(o){gotoNextForm(e,t,n)})})["catch"](function(e){$scope.data=e.data,updateErrorAlert()})},$scope.addEvent=function(e,t,o,a,r){updateComponents($scope.form,o,$scope.data),Event.update({id:$scope.data._id},{datamodel_id:$scope.form.datamodel._id,object_name:$scope.resolvePath($scope.data,a),start_time:$scope.resolvePath($scope.data,r).start_time,end_time:$scope.resolvePath($scope.data,r).end_time,_user:$scope.data._user,_updated_at:$scope.data._updated_at}).$promise.then(function(o){gotoNextForm(e,t,$scope.data)})["catch"](function(e){e.data&&($scope.data=e.data,initComponents()),errorAlert($scope.sessionData.appData.error_creating_appointment)})},$scope.search=function(e){e||(e=""),$scope.search_text=e,$scope.skip=0,$scope.limit=10,$scope.stopScroll=!1,$scope.tempStopScroll=!1,$scope.datas=[],$scope.getNextData()}}]);
