app1.controller("FormDetailsCtrl",["$scope","$routeParams","$location","$route","$resource","$mdDialog","SessionService","MapService","Forms","Value","Files","Datas","Share","Calendar","Notify","Event",function($scope,$routeParams,$location,$route,$resource,$mdDialog,SessionService,MapService,Forms,Value,Files,Datas,Share,Calendar,Notify,Event){$scope.sessionData=SessionService.getSessionData(),$scope.$watch(function(){return SessionService.getSessionData()},function(e,a){e!=a&&($scope.sessionData=e,updateAppName())}),$scope.calculation=function(object,calculation){var data=object;return eval(calculation)},$scope.resolvePath=function(e,a){return a?a.split(".").reduce(function(e,a){return e?e[a]:void 0},e):void 0},$scope.resolvePathUpdate=function(e,a,t){return a?void a.split(".").reduce(function(e,a,s,o){return s<o.length-1?(e[a]||(e[a]={}),e[a]):void(e[a]=t)},e):void 0};var toString=function(e){return e?e+"":""},updateAppName=function(){var e=$scope.sessionData.applications;if(e)for(var a=0;a<e.length;a++)if(e[a]._id==$routeParams.application_id)for(var t=0;t<e[a].workflows.length;t++)if(e[a].workflows[t]._id==$routeParams.workflow_id){$scope.sessionData.applicationName=SessionService.translate(e[a].name)+" - "+SessionService.translate(e[a].workflows[t].name),$scope.sessionData.application_id=$routeParams.application_id,SessionService.setSessionData($scope.sessionData);break}};$scope.data={},$scope.dataLoaded=!1,$scope.localdata={},$scope.form={},$scope.skip=0,$scope.limit=10,$scope.datas=[],$scope.stopScroll=!1,$scope.tempStopScroll=!1,$scope.files={},$scope.currentFile={},$scope.filesCount={},$scope.search_criteria="",$scope.show_search=!1,$scope.search_text="",$scope.formLoaded=!1,$scope.slides=[],$scope.appointments=[],$scope.selectedDate=void 0,$scope.today=new Date,$scope.today_plus_1_year=new Date($scope.today.getTime()+31536e6),$scope.hours=[],$scope.minutes=[],$scope.full_hours=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],$scope.full_minutes=["00","15","30","45"],$scope.days=[{value:0,name:{en:"Sunday",fr:"Dimanche"}},{value:1,name:{en:"Monday",fr:"Lundi"}},{value:2,name:{en:"Tuesday",fr:"Mardi"}},{value:3,name:{en:"Wednesday",fr:"Mercredi"}},{value:4,name:{en:"Thursday",fr:"Jeudi"}},{value:5,name:{en:"Friday",fr:"Vendredi"}},{value:6,name:{en:"Saturday",fr:"Samedi"}}],$scope.getNextData=function(){if($scope.formLoaded&&!$scope.stopScroll&&!$scope.tempStopScroll&&$scope.form.datamodel){var e=$scope.limit,a=$scope.skip;$scope.skip+=$scope.limit,$scope.tempStopScroll=!0,Datas.query({datamodel_id:$scope.form.datamodel._id,search_criteria:$scope.search_criteria,search_text:$scope.search_text,skip:a,limit:e,sort_by:$scope.form.sort_by},function(e){e.length<$scope.limit&&($scope.stopScroll=!0);for(var a=$scope.form.values,t=0;t<a.length;t++){if($scope.form_field_list.title_listofvalues==a[t]._id&&"list"!=a[t].type){var s={};s.relation=a[t].values.relation,s.id_list=[];for(var o=0;o<e.length;o++)s.id_list.push($scope.resolvePath(e[o],$scope.form.datamodel.projection[$scope.form_field_list.title].full_path));s.id_list=$scope.resolvePath($scope.data,$scope.form.datamodel.projection[$scope.form_field_list.title].full_path),queryValues(a[t]._id,a[t].type,s,$scope.form_field_list,"title",$scope.form_field_list)}if($scope.form_field_list.subtitle_listofvalues==a[t]._id&&"list"!=a[t].type){var s={};s.relation=a[t].values.relation,s.id_list=[];for(var o=0;o<e.length;o++)s.id_list.push($scope.resolvePath(e[o],$scope.form.datamodel.projection[$scope.form_field_list.subtitle].full_path));queryValues(a[t]._id,a[t].type,s,$scope.form_field_list,"subtitle",$scope.form_field_list)}}for(var o=0;o<e.length;o++)$scope.datas.push(e[o]);$scope.tempStopScroll=!1})}};var initText=function(){for(var e=0;e<$scope.days.length;e++)$scope.days[e].translated_name=SessionService.translate($scope.days[e].name);if($scope.form.title=SessionService.translate($scope.form.name),$scope.form.actions)for(var e=0;e<$scope.form.actions.length;e++)$scope.form.actions[e].translated_name=SessionService.translate($scope.form.actions[e].name);if($scope.form.fields)for(var a=$scope.form.fields,e=0;e<a.length;e++){if("address"==a[e].display)for(var t=Object.keys($scope.form.datamodel.projection),s=0;s<t.length;s++){var o=$scope.form.datamodel.projection[t[s]];o.path==a[e].full_path&&("address_line1"==o.technical_name?a[e].address_line1_translated_name=SessionService.translate(o.name):"address_line2"==o.technical_name?a[e].address_line2_translated_name=SessionService.translate(o.name):"address_city"==o.technical_name?a[e].address_city_translated_name=SessionService.translate(o.name):"address_state"==o.technical_name?a[e].address_state_translated_name=SessionService.translate(o.name):"address_postal_code"==o.technical_name?a[e].address_postal_code_translated_name=SessionService.translate(o.name):"address_country"==o.technical_name&&(a[e].address_country_translated_name=SessionService.translate(o.name)))}else if(("list"==a[e].display||"item"==a[e].display)&&a[e].item_actions)for(var s=0;s<a[e].item_actions.length;s++)a[e].item_actions[s].translated_name=SessionService.translate(a[e].item_actions[s].name);a[e].translated_name="",a[e].text&&(a[e].translated_name=SessionService.translate(a[e].text)),a[e].translated_name&&""!=a[e].translated_name||"list"==a[e].display||"item"==a[e].display||(a[e].translated_name=SessionService.translate($scope.form.datamodel.projection[a[e].projectionid].name))}},matchField=function(e){if(!e)return"";var a=e.match(/data.([a-z_])+/g);if(!a)return"";for(var t="",s=0;s<a.length;s++)t+=a[s].substr(5)+" ";return t},computeFields=function(e,a){var t="";if(e){var s=e.indexOf(".");t+=s>0?e.substring(0,s+1)+" ":e+" "}return t+=matchField(a),t=t.trim()},queryValues=function(e,a,t,s,o,i){Value.update({id:e,type:a},t,function(e){"title"==o?updateValuesTitle(s,e.values,i):"subtitle"==o?updateValuesSubTitle(s,e.values,i):"items"==o?updateValuesItems(s,e.values):"form"==o&&updateValuesForm(s,e.values,i)})},updateValuesForm=function(e,a,t){e.values=[],e.values_key={};var s;if(t){if("property"==t.selection_display)for(s=0;s<a.length;s++)e.values.push({_id:a[s]._id,name:$scope.resolvePath(a[s],t.selection_full_path)}),e.values_key[a[s]._id]=$scope.resolvePath(a[s],t.selection_full_path);else if("calculation"==t.selection_display)for(s=0;s<a.length;s++)e.values.push({_id:a[s]._id,name:$scope.calculation(a[s],t.selection_calculation)}),e.values_key[a[s]._id]=$scope.calculation(a[s],t.selection_calculation)}else for(s=0;s<a.length;s++)e.values.push({_id:a[s]._id,name:SessionService.translate(a[s].name)}),e.values_key[a[s]._id]=SessionService.translate(a[s].name)},updateValuesTitle=function(e,a,t){e.title_values={};var s;if(t){if("property"==t.title_display_text)for(s=0;s<a.length;s++)e.title_values[a[s]._id]=$scope.resolvePath(a[s],t.title_full_path);else if("calculation"==t.title_display_text)for(s=0;s<a.length;s++)e.title_values[a[s]._id]=$scope.calculation(a[s],t.title_calculation)}else for(s=0;s<a.length;s++)e.title_values[a[s]._id]=SessionService.translate(a[s].name)},updateValuesSubTitle=function(e,a,t){e.subtitle_values={};var s;if(t){if("property"==t.subtitle_display_text)for(s=0;s<a.length;s++)e.subtitle_values[a[s]._id]=$scope.resolvePath(a[s],t.subtitle_full_path);else if("calculation"==t.subtitle_display_text)for(s=0;s<a.length;s++)e.subtitle_values[a[s]._id]=$scope.calculation(a[s],t.subtitle_calculation)}else for(s=0;s<a.length;s++)e.subtitle_values[a[s]._id]=SessionService.translate(a[s].name)},updateValuesItems=function(e,a){var t=e.projectionid+"_values";e[t]=a,$scope.data[e.projectionid]=a},initComponents=function(){for(var formFields=$scope.form.fields,formValues=$scope.form.values,i=0;i<formFields.length;i++)if("address"==formFields[i].display){if($scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path),formFields[i].disabled){MapService.initMap("map"+formFields[i].id);var address=$scope.localdata[formFields[i].id];MapService.geocodeAddress("map"+formFields[i].id,(address.address_line1?address.address_line1+",":"")+(address.address_line2?address.address_line2+",":"")+(address.address_city?address.address_city+",":"")+(address.address_postal_code?address.address_postal_code+",":"")+(address.address_country?address.address_country+",":""))}}else if("currency"==formFields[i].display){$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path);for(var j=0;j<formValues.length;j++)if(formFields[i].listofvalues==formValues[j]._id){"list"==formValues[j].type?updateValuesForm(formFields[i],formValues[j].values):queryValues(formValues[j]._id,formValues[j].type,formValues[j].values,formFields[i],"form",formFields[i]);break}}else if("selection"==formFields[i].display){$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path);for(var j=0;j<formValues.length;j++)if(formFields[i].listofvalues==formValues[j]._id){if("list"==formValues[j].type)updateValuesForm(formFields[i],formValues[j].values);else{var itemValues={};itemValues.relation=formValues[j].values.relation,itemValues.user_fields=computeFields(formFields[i].selection_full_path,formFields[i].selection_calculation),itemValues.id_list=[],formFields[i].disabled&&itemValues.id_list.push($scope.resolvePath($scope.data,$scope.form.datamodel.projection[formFields[i].projectionid].full_path)),queryValues(formValues[j]._id,formValues[j].type,itemValues,formFields[i],"form",formFields[i])}break}}else if("calendar"==formFields[i].display)$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path),$scope.localdata[formFields[i].id]&&($scope.localdata[formFields[i].id]=new Date($scope.localdata[formFields[i].id]));else if("calculation"==formFields[i].display){var data=$scope.data;$scope.localdata[formFields[i].id]=eval(formFields[i].calculation)}else if("list"==formFields[i].display){$scope.show_search=!0,$scope.form_field_list=formFields[i],$scope.form_field_list_title_user_fields="",$scope.form_field_list_subtitle_user_fields="";for(var j=0;j<formValues.length;j++)formFields[i].title_listofvalues==formValues[j]._id?"list"==formValues[j].type?updateValuesTitle(formFields[i],formValues[j].values):$scope.form_field_list_title_user_fields=computeFields(formFields[i].title_full_path,formFields[i].title_calculation):formFields[i].subtitle_listofvalues==formValues[j]._id&&("list"==formValues[j].type?updateValuesSubTitle(formFields[i],formValues[j].values):$scope.form_field_list_subtitle_user_fields=computeFields(formFields[i].subtitle_full_path,formFields[i].subtitle_calculation));$scope.formLoaded=!0,$scope.getNextData()}else if("item"==formFields[i].display){for(var j=0;j<formValues.length;j++)if(formFields[i].listofvalues==formValues[j]._id)if("list"==formValues[j].type)updateValuesItems(i,formValues[j].values);else{var itemValues={};itemValues.relation=formValues[j].values.relation,itemValues.id_list=$scope.resolvePath($scope.data,$scope.form.datamodel.projection[formFields[i].projectionid].full_path),itemValues.user_fields=computeFields(formFields[i].title_full_path,formFields[i].title_calculation)+" ",itemValues.user_fields+=computeFields(formFields[i].subtitle_full_path,formFields[i].subtitle_calculation),itemValues.user_fields=itemValues.user_fields.trim(),queryValues(formValues[j]._id,formValues[j].type,itemValues,formFields[i],"items")}}else if("file"==formFields[i].display||"image"==formFields[i].display){$scope.currentFile[formFields[i].id]=0,$scope.filesCount[formFields[i].id]=0,$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path),$scope.localdata[formFields[i].id]||($scope.localdata[formFields[i].id]=[]),$scope.files[formFields[i].id]=[];for(var f=0;f<$scope.localdata[formFields[i].id].length;f++)$scope.files[formFields[i].id].push({_id:$scope.localdata[formFields[i].id][f]._id,name:$scope.localdata[formFields[i].id][f].name,type:$scope.localdata[formFields[i].id][f].type});if($scope.localdata[formFields[i].id])for(var j=0;j<$scope.localdata[formFields[i].id].length;j++)$scope.slides.push({url:"/file/"+$scope.localdata[formFields[i].id][j]._id,caption:""})}else"appointment_properties"==formFields[i].display?$scope.data._appointment_properties&&$scope.data._appointment_properties.non_stop||($scope.data._appointment_properties={non_stop:{enabled:!0}},$scope.updateWholeWeek($scope.data._appointment_properties)):$scope.localdata[formFields[i].id]=$scope.resolvePath($scope.data,formFields[i].full_path)};Forms.get({id:$routeParams.id},function(e){$scope.form=e;var a=$scope.form.display;$scope.form.fields=[];var t="";if(a)for(var s=0;s<a.length;s++)for(var o=0;o<a[s].blocks.length;o++)for(var i=0;i<a[s].blocks[o].fields.length;i++){var r=a[s].blocks[o].fields[i];$scope.form.fields.push(r),("file"==r.display||"image"==r.display)&&r.projectionid&&"reference"==$scope.form.datamodel.projection[r.projectionid].type&&(t=t+$scope.form.datamodel.projection[r.projectionid].full_path+" ")}updateAppName(),initText(),$scope.form.search_criteria&&($scope.search_criteria=$scope.form.search_criteria),$scope.search_criteria=$scope.search_criteria.replace(/@_user_id/g,$scope.sessionData.userData._id),$scope.search_criteria=$scope.search_criteria.replace(/@@today/g,new Date);var d=Object.keys($routeParams);for(i=0,l=d.length;i<l;i++)$scope.search_criteria=$scope.search_criteria.replace("@"+d[i],$routeParams[d[i]]);$scope.form.datamodel&&("0"==$routeParams.entry_id?($scope.data=new Datas({datamodel_id:$scope.form.datamodel._id}),$scope.data._user=$scope.sessionData.userData._id,$scope.dataLoaded=!0,initComponents()):Datas.get({datamodel_id:$scope.form.datamodel._id,entry_id:$routeParams.entry_id,search_criteria:$scope.search_criteria,populate:t.trim()},function(e){$scope.data=e,$scope.dataLoaded=!0,initComponents()}))});var rand=function(){return Math.random().toString(16).substr(2)},gotoNextForm=function(e,a,t){if("home"==a)SessionService.location("/workflows/"+$scope.sessionData.application_id);else{var s="/form/"+a+"/";if(t&&t._id){if(s=s+t._id+"?application_id="+$routeParams.application_id+"&workflow_id="+$routeParams.workflow_id,e)for(keys=Object.keys(e),i=0;i<keys.length;i++)s=s+"&"+e[keys[i]]+"="+t[e[keys[i]]]}else s=s+"0?application_id="+$routeParams.application_id+"&workflow_id="+$routeParams.workflow_id;s!=$location.url()?SessionService.location(s):$route.reload()}};$scope.uploadFile=function(e,a,t,s){const o=new XMLHttpRequest;o.open("PUT",a),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?($scope.currentFile[s]++,$scope.currentFile[s]>$scope.filesCount[s]?(document.getElementById("file_upload_"+s).textContent=$scope.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload_"+s).textContent=""},4e3)):document.getElementById("file_upload_"+s).textContent=$scope.sessionData.appData.uploading_in_progress+" "+$scope.currentFile[s]+"/"+$scope.filesCount[s]):alert("Could not upload file."))},o.send(e)},changeFilesInFormsJS=function(e,a){if(0!=e.length){for($scope.localdata[a]||($scope.localdata[a]=[]),k=e.length-1;k>=0;k--)e[k].size/1048576>35&&e.splice(k,1);for($scope.filesCount[a]=e.length,$scope.currentFile[a]=1,document.getElementById("file_upload_"+a).textContent=$scope.sessionData.appData.uploading_in_progress+" "+$scope.currentFile[a]+"/"+$scope.filesCount[a],i=0;i<$scope.filesCount[a];i++){var t=new Files({name:e[i].name,type:e[i].type});$scope.files[a].push(e[i]),t.$save(function(e){for(var t=0;t<$scope.files[a].length;t++)$scope.files[a][t].name==e.file.name&&($scope.localdata[a].push({_id:e.file._id,name:e.file.name,type:e.file.type}),$scope.files[a][t]._id=e.file._id,$scope.uploadFile($scope.files[a][t],e.signedRequest,e.url,a))})}}},$scope.removeFile=function(e,a){for(var t=$scope.localdata[a],s=0;s<t.length;s++)if(t[s]._id==e){t.splice(s,1),Files.remove({id:e},function(t){for(var s=0;s<$scope.files[a].length;s++)if($scope.files[a][s]._id==e){$scope.files[a].splice(s,1);break}},function(e){});break}};var computeDateKey=function(e){return[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-")};$scope.updateWholeWeek=function(e){if(e.days||(e.days=[]),e.non_stop.enabled)for(var a=0;7>a;a++)e.days[a]={whole_day:!0,enabled:!0},$scope.updateWholeDay(e.days[a]);else for(var a=0;7>a;a++)e.days[a]={whole_day:!1,enabled:!1},$scope.updateWholeDay(e.days[a])},$scope.updateWholeDay=function(e){e.whole_day?(e.start_time={hours:"00",minutes:"00"},e.end_time={hours:"24",minutes:"00"}):(e.start_time={hours:"08",minutes:"00"},e.end_time={hours:"19",minutes:"00"})},$scope.updateDate=function(e,a,t){if(t.date){var s=t.date;if($scope.hours=[],$scope.data._appointment_properties&&$scope.data._appointment_properties.days&&$scope.data._appointment_properties.days[s.getDay()])for(var o=$scope.data._appointment_properties.days[s.getDay()],i=0;i<$scope.full_hours.length;i++)$scope.full_hours[i].localeCompare(o.start_time.hours)>=0&&$scope.full_hours[i].localeCompare(o.end_time.hours)<=0&&$scope.hours.push($scope.full_hours[i]);$scope.hours.length>0?$scope.minutes=["00","15","30","45"]:$scope.minutes=[],s.setHours(parseInt(t.hours?t.hours:"0")),s.setMinutes(parseInt(t.minutes?t.minutes:"0")),s.setSeconds(0),s.setMilliseconds(0),$scope.localdata[e]||($scope.localdata[e]={}),$scope.localdata[e][a]=s}},$scope.dayAvailable=function(e){var a=new Date;if(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a>e)return!1;computeDateKey(e);return $scope.data._appointment_properties&&$scope.data._appointment_properties.days&&$scope.data._appointment_properties.days[e.getDay()]&&$scope.data._appointment_properties.days[e.getDay()].enabled?!0:!1},$scope.dayContent=function(e){var a=new Date;if(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a>e)return"";var t=computeDateKey(e);return $scope.data._appointments&&$scope.data._appointments[t]&&$scope.data._appointments[t].length>0?""+$scope.data._appointments[t].length:""},$scope.dayClick=function(e){$scope.selectedDate=e;var a=computeDateKey(e);$scope.data._appointments&&$scope.data._appointments[a]&&$scope.data._appointments[a].length>0?$scope.appointments=$scope.data._appointments[a].sort(function(e,a){return 60*e.start_time.hours+1*e.start_time.minutes-(60*a.start_time.hours+1*a.start_time.minutes)}):$scope.appointments=[]};var updateComponents=function(e,a,t){for(var s=$scope.form.fields,o=0;o<s.length;o++)"feed"==s[o].display?e.newvalues&&e.newvalues[s[o].id]&&e.newvalues[s[o].id].length>0&&($scope.localdata[s[o].id]||($scope.localdata[s[o].id]=[]),$scope.localdata[s[o].id].push({text:e.newvalues[s[o].id],from:$scope.sessionData.userData.name,user:$scope.sessionData.userData.user,date:Date.now()})):"list"!=s[o].display&&"item"!=s[o].display&&$scope.resolvePathUpdate(t,s[o].full_path,$scope.localdata[s[o].id]);a&&$scope.resolvePathUpdate(t,a.full_path,a.value)},updateErrorAlert=function(){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.new_document_version).textContent($scope.sessionData.appData.already_modified_document).ok($scope.sessionData.appData.ok))},errorAlert=function(e){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.error).textContent(e).ok($scope.sessionData.appData.ok))},notify=function(e,a,t,s){if(e){var o;if("current"==e)o=$scope.sessionData.userData._id;else if("owner"==e)o=$scope.data._user;else{if("item"!=e)return;o=s}if(o&&a&&t){for(var i=SessionService.translate(t),l=i.match(/@\w*@/g),r=0;r<l.length;r++)"@@"!=l[r]&&(i=i.replace(new RegExp(l[r],"g"),$scope.localdata[l[r].replace(/@/g,"")]));Notify.update({user_id:o},{email_title:SessionService.translate(a),email_html:i})}}};$scope.create=function(e,a,t,s,o,i,l){updateComponents($scope.form,t,$scope.data),$scope.data.$save(function(t){notify(o,i,l),gotoNextForm(e,a,s?t:null)},function(e){$scope.data=e.data})},$scope.modify=function(e,a,t,s,o,i,l){updateComponents($scope.form,t,$scope.data),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data,function(t){notify(o,i,l),gotoNextForm(e,a,s?t:null)},function(e){$scope.data=e.data,updateErrorAlert()})},$scope["delete"]=function(e,a,t,s,o){$mdDialog.show($mdDialog.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.confirmation).textContent($scope.sessionData.appData.removal_confirmation).ok($scope.sessionData.appData.ok).cancel($scope.sessionData.appData.cancel)).then(function(){Datas.remove({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},function(i){notify(t,s,o),gotoNextForm(e,a,null)},function(e){})})},$scope.link=function(e,a,t,s,o,i){notify(s,o,i),gotoNextForm(e,a,t?$scope.data:null)},$scope.subscribe=function(e,a,t,s,o,i,l,r){updateComponents($scope.form,t,$scope.data),$scope.resolvePath($scope.data,o).push($scope.sessionData.userData._id),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data,function(t){notify(i,l,r),gotoNextForm(e,a,s?$scope.data:null)},function(e){$scope.data=e.data,updateErrorAlert()})},$scope.unsubscribe=function(e,a,t,s,o,i,l,r){updateComponents($scope.form,t,$scope.data);for(var d=$scope.resolvePath($scope.data,o),n=d.length-1;n>=0;n--)(d[n]==$scope.sessionData.userData._id||d[n]._id==$scope.sessionData.userData._id)&&d.splice(n,1);Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data,function(t){notify(i,l,r),gotoNextForm(e,a,s?$scope.data:null)},function(e){$scope.data=e.data,updateErrorAlert()})},$scope.deleteItem=function(e,a,t,s,o,i,l,r){$mdDialog.show($mdDialog.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.confirmation).textContent($scope.sessionData.appData.removal_confirmation).ok($scope.sessionData.appData.ok).cancel($scope.sessionData.appData.cancel)).then(function(){updateComponents($scope.form,t,$scope.data);for(var d=$scope.resolvePath($scope.data,o),n=d.length-1;n>=0;n--)(d[n]==s||d[n]._id==s)&&d.splice(n,1);Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data,function(t){notify(i,l,r,s),gotoNextForm(e,a,$scope.data)},function(e){$scope.data=e.data,updateErrorAlert()})})},$scope.moveItem=function(e,a,t,s,o,i,l,r,d){updateComponents($scope.form,t,$scope.data);for(var n=$scope.resolvePath($scope.data,o),c=n.length-1;c>=0;c--)(n[c]==s||n[c]._id==s)&&n.splice(c,1);$scope.resolvePath($scope.data,i).push(s),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:$scope.data._id},$scope.data,function(t){notify(l,r,d,s),gotoNextForm(e,a,$scope.data)},function(e){$scope.data=e.data,updateErrorAlert()})},$scope.modifyList=function(e,a,t,s,o,i,l){updateComponents($scope.form,t,s),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:s._id},s,function(t){notify(o,i,l),gotoNextForm(e,a,t)},function(e){$scope.data=e.data,updateErrorAlert()})},$scope.deleteList=function(e,a,t,s,o,i){$mdDialog.show($mdDialog.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title($scope.sessionData.appData.confirmation).textContent($scope.sessionData.appData.removal_confirmation).ok($scope.sessionData.appData.ok).cancel($scope.sessionData.appData.cancel)).then(function(){Datas.remove({datamodel_id:$scope.form.datamodel._id,entry_id:t._id},function(t){notify(s,o,i),gotoNextForm(e,a,null)},function(e){})})},$scope.linkList=function(e,a,t,s,o,i){notify(s,o,i),gotoNextForm(e,a,t)},$scope.share=function(e,a,t,s,o,i,l,r,d){updateComponents($scope.form,t,d),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:d._id},d,function(t){Share.update({app_profile_id:l,datamodel_id:$scope.form.datamodel._id,data_id:d._id,email:$scope.resolvePath(d,i),message:r,key:s,value:o},function(t){gotoNextForm(e,a,d)})},function(e){$scope.data=e.data,updateErrorAlert()})},$scope.calendar=function(e,a,t,s,o,i,l,r,d){updateComponents($scope.form,t,d),Datas.update({datamodel_id:$scope.form.datamodel._id,entry_id:d._id},d,function(t){Calendar.get({project_name:$scope.resolvePath(d,o),start_date:$scope.resolvePath(d,i),end_date:$scope.resolvePath(d,l),user_id:$scope.resolvePath(d,r)},function(t){gotoNextForm(e,a,s?d:null)})},function(e){$scope.data=e.data,updateErrorAlert()})},$scope.addEvent=function(e,a,t,s,o){updateComponents($scope.form,t,$scope.data),Event.update({id:$scope.data._id},{datamodel_id:$scope.form.datamodel._id,object_name:$scope.resolvePath($scope.data,s),start_time:$scope.resolvePath($scope.data,o).start_time,end_time:$scope.resolvePath($scope.data,o).end_time,_user:$scope.data._user,_updated_at:$scope.data._updated_at},function(t){gotoNextForm(e,a,$scope.data)},function(e){e.data&&($scope.data=e.data,initComponents()),errorAlert($scope.sessionData.appData.error_creating_appointment)})},$scope.search=function(e){e||(e=""),$scope.search_text=e,$scope.skip=0,$scope.limit=10,$scope.stopScroll=!1,$scope.tempStopScroll=!1,$scope.datas=[],$scope.getNextData()}}]);
