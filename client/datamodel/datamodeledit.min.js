app1.controller("DatamodelEditCtrl",["$scope","SessionService","DesignDataModel","$location","$routeParams","$mdDialog",function(e,t,a,n,o,l){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,a){t!=a&&(e.sessionData=t)}),e.resolvePathObject=function(e,t){return""==t?e:void t.split(".").reduce(function(e,t,a,i){return a<i.length-1?(e||(e={}),void(e[t]||(e[t]={}))):e[t]},e)},e.field_type={text:{en:"Text",fr:"Texte"},number:{en:"Number",fr:"Nombre"},"boolean":{en:"Boolean",fr:"Boolean"},date:{en:"Date",fr:"Date"},currency:{en:"Amount",fr:"Montant"},item:{en:"Detail List",fr:"Liste de dÃ©tails"},feed:{en:"Discussion Feed",fr:"Fil de discussion"},file:{en:"File",fr:"Fichier"},address:{en:"Address",fr:"Adresse"}};var r=Object.keys(e.field_type);for(e.field_types=[],i=0;i<r.length;i++)e.field_types.push({translated_name:t.translate(e.field_type[r[i]]),type:r[i]});e.datamodel_keys=[],a.get({id:o.id},function(a,i){if(a)if(e.datamodel=a,e.datamodel.projection)for(var n=Object.keys(e.datamodel.projection),o=0;o<n.length;o++)e.datamodel_keys.push({translated_name:t.translate(e.datamodel.projection[n[o]]),id:n[o]});else e.datamodel.projection={};else e.datamodel={projection:{}};e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,a){e[t]||(e[t]={}),l.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[t]=a})},e.editForm=function(a){DesignWorkflow.update({id:e.workflow._id},e.workflow).$promise.then(function(i){t.init(),t.location("/form_edit/"+a+"?application_id="+o.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newField=function(){l.show({templateUrl:"datamodel/new.html",controller:"NewFieldCtrl",locals:{field_types:e.field_types},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){var i=Object.keys(e.datamodel.projection),n=i.length;do n+=1;while(e.datamodel.projection[n]);a.path="",e.datamodel.projection[n]=a;var o=e.resolvePathObject(e.datamodel.datamodel,a.path);"text"==a.type?o[a.technical_name]="String":"number"==a.type?o[a.technical_name]="Number":"boolean"==a.type?o[a.technical_name]="Boolean":"date"==a.type?o[a.technical_name]="Date":"currency"==a.type?o[a.technical_name]={value:"Number",currency:"String"}:"feed"==a.type?o[a.technical_name]=[{from:"String",date:"Date",text:"String"}]:"text"==a.type||"text"==a.type||"text"==a.type||"text"==a.type||"text"==a.type;for(var l=Object.keys(e.datamodel.projection),r=0;r<l.length;r++)e.datamodel_keys.push({translated_name:t.translate(e.datamodel.projection[l[r]]),id:l[r]})})},e.save=function(){a.update({id:e.datamodel._id},e.datamodel).$promise.then(function(e){t.location("/datamodel_edit/")})["catch"](function(t){e.datamodel=t.datamodel,updateErrorAlert()})}}]);
