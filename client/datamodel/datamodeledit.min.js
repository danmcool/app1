app1.controller("DatamodelEditCtrl",["$scope","SessionService","DesignDataModel","$location","$routeParams","$mdDialog",function(e,t,a,o,n,r){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,a){t!=a&&(e.sessionData=t)}),e.sessionData.applicationName=e.sessionData.appData.datamodel_designer,t.setSessionData(e.sessionData),e.field_type={text:{en:"Text",fr:"Texte"},number:{en:"Number",fr:"Nombre"},"boolean":{en:"Boolean",fr:"Boolean"},date:{en:"Date",fr:"Date"},currency:{en:"Amount",fr:"Montant"},reference:{en:"Detail",fr:"Détail"},item:{en:"Detail List",fr:"Liste de détails"},feed:{en:"Discussion Feed",fr:"Fil de discussion"},file:{en:"File",fr:"Fichier"},address:{en:"Address",fr:"Adresse"},node:{en:"Node",fr:"Noeud"}};var s=Object.keys(e.field_type);for(e.field_types=[],i=0;i<s.length;i++)e.field_type[s[i]].translated_name=t.translate(e.field_type[s[i]]),e.field_types.push({translated_name:e.field_type[s[i]].translated_name,type:s[i]});e.datamodel_keys=[],a.get({id:n.id},function(t,a){if(t)if(e.datamodel=t,e.datamodel.projection)for(var o=Object.keys(e.datamodel.projection),n=0;n<o.length;n++){var r=e.datamodel.projection[o[n]];e.datamodel_keys.push({path:r.path,technical_name:r.technical_name,full_path:""==r.path?r.technical_name:r.path+"."+r.technical_name,type:r.type,name:r.name,id:o[n]})}else e.datamodel.projection={};else e.datamodel={projection:{}};e.datamodel_keys.sort(function(e,t){return e.full_path.trim().localeCompare(t.full_path.trim())})}),e.editText=function(e,t,a,o){e[t]||(e[t]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[t]=a})},e.editTextCopy=function(t,a,o,n){t[a]||(t[a]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:t[a],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){t[a]=o,e.datamodel.projection[t.id][a]=o})},e.editForm=function(a){DesignWorkflow.update({id:e.workflow._id},e.workflow).$promise.then(function(o){t.init(),t.location("/form_edit/"+a+"?application_id="+n.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.addChild=function(t,a){r.show({templateUrl:"datamodel/new.html",controller:"NewFieldCtrl",locals:{field_types:e.field_types},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){var n=Object.keys(e.datamodel.projection),r=n.length;do r+=1;while(e.datamodel.projection[r]);o.path=""==t?a:t+"."+a,e.datamodel.projection[r]=o,e.datamodel_keys.push({path:o.path,technical_name:o.technical_name,full_path:""==o.path?o.technical_name:o.path+"."+o.technical_name,type:o.type,name:o.name,id:r}),e.datamodel_keys.sort(function(e,t){return 0==e.path.trim().localeCompare(t.path.trim())?e.technical_name.trim().localeCompare(t.technical_name.trim()):e.path.trim().localeCompare(t.path.trim())})})},e.newField=function(t){r.show({templateUrl:"datamodel/new.html",controller:"NewFieldCtrl",locals:{field_types:e.field_types},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){var o=Object.keys(e.datamodel.projection),n=o.length;do n+=1;while(e.datamodel.projection[n]);a.path=t,e.datamodel.projection[n]=a,e.datamodel_keys.push({path:a.path,technical_name:a.technical_name,full_path:""==a.path?a.technical_name:a.path+"."+a.technical_name,type:a.type,name:a.name,id:n}),e.datamodel_keys.sort(function(e,t){return 0==e.path.trim().localeCompare(t.path.trim())?e.technical_name.trim().localeCompare(t.technical_name.trim()):e.path.trim().localeCompare(t.path.trim())})})},e.save=function(){a.update({id:e.datamodel._id},e.datamodel).$promise.then(function(e){t.location("/datamodel/")})["catch"](function(t){e.datamodel=t.datamodel,updateErrorAlert()})}}]);
