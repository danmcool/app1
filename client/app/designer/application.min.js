app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(e,t,r,a,o,n,i,l){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,r){t!=r&&(e.sessionData=t)}),r.get({id:i.id},function(r,a){if(r.workflows)for(var o=0;o<r.workflows.length;o++)r.workflows[o].translated_name=t.translate(r.workflows[o].name),r.workflows[o].translated_description=t.translate(r.workflows[o].description);e.application=r,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,r){e[t]||(e[t]={}),l.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:r},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(r){e[t]=r})},e.editWorkflow=function(a){r.update({id:e.application._id},e.application,function(r){t.init(),t.location("/workflow_edit/"+a+"?application_id="+e.application._id)},function(t){e.application=t.application,updateErrorAlert()})},e.editAppSecurity=function(){r.update({id:e.application._id},e.application,function(r){t.init(),t.location("/application_security/"+e.application._id)},function(t){e.application=t.application,updateErrorAlert()})},e.newWorkflow=function(){var o={};o[e.sessionData.userData.properties.correctedLanguage]="";var n=new a({name:o,icon:"clear"});n.$save(function(){n.translated_name="",e.application.workflows.push(n),r.update({id:e.application._id},e.application,function(r){t.init(),t.location("/workflow_edit/"+n._id+"?application_id="+e.application._id)},function(t){e.application=t.application,updateErrorAlert()})})},e.deleteWorkflow=function(t){var o=e.application.workflows[t]._id;e.application.workflows.splice(t,1),r.update({id:e.application._id},e.application,function(e){a.remove({id:o},function(e){},function(e){})})},e.testApp=function(){r.update({id:e.application._id},e.application,function(r){t.init(),t.location("/workflows/"+e.application._id+"?test")},function(t){e.application=t.application,updateErrorAlert()})},e.save=function(){r.update({id:e.application._id},e.application,function(e){t.init(),t.location("/designer")},function(t){e.application=t.application,updateErrorAlert()})},e.uploadFile=function(t,r,a){const o=new XMLHttpRequest;o.open("PUT",r),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},o.send(t)},e.changeFile=function(t){if(1==t.length){for(k=t.length-1;k>=0;k--)t[k].size/1048576>35&&t.splice(k,1);document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var r=new o({name:t[0].name,type:t[0].type});r.$save(function(r){e.application.file={_id:r.file._id,name:r.file.name,type:r.file.type},e.uploadFile(t[0],r.signedRequest,r.url)})}},e.removeFile=function(t){o.remove({id:t},function(t){e.application.file=null},function(e){})}}]);
