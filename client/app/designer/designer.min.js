app1.factory("DesignApplication",["$resource",function(a){return a("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(a){return a("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(a){return a("/client/design/form/:id",null,{update:{method:"PUT"}})}]).factory("DesignValue",["$resource",function(a){return a("/client/design/value/:id",null,{update:{method:"PUT"}})}]).factory("DesignDataModel",["$resource",function(a){return a("/client/design/datamodel/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(a,e,t,s,i,o,n){ga("send","pageview","/app/designer"),a.sessionData=e.getSessionData(),a.applications=[],a.skip=0,a.limit=10,a.stopScroll=!1,a.tempStopScroll=!1,a.$watch(function(){return e.getSessionData()},function(t,s){t!=s&&(a.sessionData=t,a.sessionData.applicationName=a.sessionData.appData.app_designer,e.setSessionData(a.sessionData))}),a.sessionData.applicationName=a.sessionData.appData.app_designer,e.setSessionData(a.sessionData),a.getNextApps=function(){if(!a.stopScroll&&!a.tempStopScroll){var s=a.limit,i=a.skip;a.skip+=a.limit,a.tempStopScroll=!0,t.query({skip:i,limit:s},function(t){if(t.length<a.limit&&(a.stopScroll=!0),t&&t.length>0)for(var s=0;s<t.length;s++){for(var i=a.sessionData.userData.company.applications,o=0;o<i.length;o++)if(t[s]._id==i[o]){t[s].enabled=!0;break}t[s].translated_name=e.translate(t[s].name),t[s].translated_description=e.translate(t[s].description),a.applications.push(t[s])}a.tempStopScroll=!1})}},a.getNextApps(),a.newApplication=function(){var s={};s[a.sessionData.userData.properties.correctedLanguage]="";var i=new t({name:s,icon:"clear"});i.$save(function(){i.translated_name="",a.applications.push(i),e.location("/application_edit/"+i._id)})},a["delete"]=function(i){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.confirmation).textContent(a.sessionData.appData.removal_confirmation).ok(a.sessionData.appData.ok).cancel(a.sessionData.appData.cancel)).then(function(){t.remove({id:i._id},function(t){for(var o=0;o<a.applications.length;o++)if(a.applications[o]._id==i._id){a.applications.splice(o,1);break}if(i.enabled){for(var n=a.sessionData.userData.company.applications,o=0;o<n.length;o++)if(i._id==n[o]){n.splice(o,1);break}s.update({id:a.sessionData.userData.company._id},{_id:a.sessionData.userData.company._id,applications:n},function(a){e.init()})}})})},a.updateCompanyApps=function(t){if(t.active){var i=a.sessionData.userData.company.applications;if(t.enabled){for(var o=0;o<i.length;o++)if(t._id==i[o]){i.splice(o,1);break}}else i.push(t._id);a.sessionData.userData.company.applications=i,s.update({id:a.sessionData.userData.company._id},{_id:a.sessionData.userData.company._id,applications:i},function(a){e.init()})}},a.edit=function(a){e.location("/application_edit/"+a)},a.share=function(e){for(var t=!1,s=0;s<e.profiles.length;s++)if(e.profiles[s].properties&&"public"==e.profiles[s].properties.user){t=!0,i.update({app_profile_id:e.profiles[s]._id,app_name:e.name.en,profile_name:e.profiles[s].name.en},function(e){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.share_url).textContent(e.share_url).ok(a.sessionData.appData.ok))});break}t||o.show(o.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.error).textContent(a.sessionData.appData.no_public_profile).ok(a.sessionData.appData.ok))},a.users=function(a){e.location("/application_users/"+a)}}]);
