app1.controller("FormActionEditCtrl",["$scope","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignWorkflow",function(e,o,n,t,a,s,r){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(o,n){o!=n&&(e.sessionData=o)}),e.action_type={create:{en:"Create",fr:"Creer"},modify:{en:"Modify",fr:"Modifier"},"delete":{en:"Delete",fr:"Supprimer"},link:{en:"Link",fr:"Lien"},link_empty:{en:"Empty link",fr:"Lien vide"},associate:{en:"Add user to list",fr:"Ajouter l`utilisateur a une liste"},dissociate:{en:"Remove user from list",fr:"Supprimer l`utilisateur de la liste"},new_item:{en:"Add new element",fr:"Ajouter un nouvel element"},download:{en:"Download data",fr:"Telecharger les donnees"},share:{en:"Share",fr:"Partager"},calendar:{en:"Send calendar",fr:"Envoyer calendrier"}};var l=Object.keys(e.action_type);for(e.action_types=[],i=0;i<l.length;i++)e.action_types.push({translated_name:t.translate(e.action_type[l[i]]),type:l[i]});a.get({id:o.id},function(n,a){if(e.form=n,e.action=e.form.actions[o.action],e.datamodel_keys=[],e.form.datamodel)for(var s=Object.keys(e.form.datamodel.translation),i=0;i<s.length;i++)e.datamodel_keys.push({translated_name:t.translate(e.form.datamodel.translation[s[i]]),id:s[i]});if(e.form.actions)for(var i=0;i<e.form.actions.length;i++)e.form.actions[i].translated_name=t.translate(e.form.actions[i].name);if(e.form.values)for(var i=0;i<e.form.values.length;i++)e.form.values[i].translated_name=t.translate(e.form.values[i].name);e.action=e.form.actions[o.action],e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),r.get({id:o.workflow_id},function(o,n){for(var a=0;a<o.forms.length;a++)o.forms[a].translated_name=t.translate(o.forms[a].name),o.forms[a].translated_description=t.translate(o.forms[a].description);e.forms=o.forms;var s={_id:"home",name:{en:"Application Home",fr:"Accueil de l`application"}};s.translated_name=t.translate(s.name),e.forms.push(s)}),e.editText=function(e,o,t){e[o]||(e[o]={}),n.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[o],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(n){e[o]=n})},e.save=function(){a.update({id:e.form._id},e.form).$promise.then(function(n){t.init(),t.location("/form_edit/"+e.form._id+"?application_id="+o.application_id+"&workflow_id="+o.workflow_id)})["catch"](function(e){d()})},e.toggle=function(e,o){var n=o.indexOf(e);n>-1?o.splice(n,1):o.push(e)},e.exists=function(e,o){return o.indexOf(e)>-1};var d=function(){n.show(n.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
