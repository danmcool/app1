app1.controller("FormActionEditCtrl",["$scope","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignWorkflow",function(e,a,t,s,o,r,n){e.sessionData=s.getSessionData(),e.$watch(function(){return s.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),e.action_type={create:{en:"Create",fr:"Creer"},modify:{en:"Modify",fr:"Modifier"},"delete":{en:"Delete",fr:"Supprimer"},link:{en:"Link",fr:"Lien"},link_empty:{en:"Empty link",fr:"Lien vide"},associate:{en:"Add user to list",fr:"Ajouter l`utilisateur a une liste"},dissociate:{en:"Remove user from list",fr:"Supprimer l`utilisateur de la liste"},new_item:{en:"Add new element",fr:"Ajouter un nouvel element"},download:{en:"Download data",fr:"Telecharger les donnees"},share:{en:"Share",fr:"Partager"},calendar:{en:"Send calendar",fr:"Envoyer calendrier"}};var l=Object.keys(e.action_type);for(e.action_types=[],i=0;i<l.length;i++)e.action_types.push({translated_name:s.translate(e.action_type[l[i]]),type:l[i]});o.get({id:a.id},function(t,o){if(e.form=t,e.action=e.form.actions[a.action],e.action.formula||(e.action.formula=[]),e.datamodel_keys=[],e.form.datamodel)for(var i=Object.keys(e.form.datamodel.projection),r=0;r<i.length;r++)e.datamodel_keys.push({translated_name:s.translate(e.form.datamodel.projection[i[r]].name),id:i[r]});if(e.form.actions)for(var r=0;r<e.form.actions.length;r++)e.form.actions[r].translated_name=s.translate(e.form.actions[r].name);if(e.form.values)for(var r=0;r<e.form.values.length;r++)e.form.values[r].translated_name=s.translate(e.form.values[r].name);e.action=e.form.actions[a.action],e.sessionData.applicationName=e.sessionData.appData.app_designer,s.setSessionData(e.sessionData)}),n.get({id:a.workflow_id},function(a,t){for(var o=0;o<a.forms.length;o++)a.forms[o].translated_name=s.translate(a.forms[o].name),a.forms[o].translated_description=s.translate(a.forms[o].description);e.forms=a.forms;var i={_id:"home",name:{en:"Application Home",fr:"Accueil de l`application"}};i.translated_name=s.translate(i.name),e.forms.push(i)}),e.editText=function(e,a,s){e[a]||(e[a]={}),t.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:s},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[a]=t})},e.save=function(){o.update({id:e.form._id},e.form).$promise.then(function(t){s.init(),s.location("/form_edit/"+e.form._id+"?application_id="+a.application_id+"&workflow_id="+a.workflow_id)})["catch"](function(e){c()})},e.toggleInFormula=function(a){var t=e.action.formula.indexOf(a.id);t>-1?e.action.formula.splice(t,1):e.action.formula.push(a.id)},e.existsInFormula=function(a){return e.action.formula.indexOf(a.id)>-1};var c=function(){t.show(t.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
