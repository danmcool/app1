app1.controller("FormActionEditCtrl",["$scope","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignWorkflow","DesignApplication",function(e,t,a,o,l,s,n,r){e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(t,a){t!=a&&(e.sessionData=t)}),e.action_type={create:{en:"Create",fr:"Creer"},modify:{en:"Modify",fr:"Modifier"},"delete":{en:"Delete",fr:"Supprimer"},link:{en:"Link",fr:"Lien"},subscribe:{en:"Add user to list",fr:"Ajouter l`utilisateur a une liste"},unsubscribe:{en:"Remove user from list",fr:"Supprimer l`utilisateur de la liste"},new_item:{en:"Add new element",fr:"Ajouter un nouvel element"},download:{en:"Download data",fr:"Telecharger les donnees"},share:{en:"Share",fr:"Partager"},calendar:{en:"Send calendar",fr:"Envoyer calendrier"},add_event:{en:"Add Event",fr:"Ajouter événement"}};var d=Object.keys(e.action_type);for(e.action_types=[],i=0;i<d.length;i++)e.action_types.push({translated_name:o.translate(e.action_type[d[i]]),type:d[i]});l.get({id:t.id},function(a,i){if(e.form=a,e.action=e.form.actions[t.action],e.action.formula||(e.action.formula=[]),e.datamodel_keys=[],e.form.datamodel)for(var l=Object.keys(e.form.datamodel.projection),s=0;s<l.length;s++)e.datamodel_keys.push({full_path:e.form.datamodel.projection[l[s]].full_path,translated_name:o.translate(e.form.datamodel.projection[l[s]].name),id:l[s]});if(e.form.actions)for(var s=0;s<e.form.actions.length;s++)e.form.actions[s].translated_name=o.translate(e.form.actions[s].name);if(e.form.values)for(var s=0;s<e.form.values.length;s++)e.form.values[s].translated_name=o.translate(e.form.values[s].name);e.action=e.form.actions[t.action],e.sessionData.applicationName=e.sessionData.appData.app_designer,o.setSessionData(e.sessionData)}),n.get({id:t.workflow_id},function(t,a){for(var i=0;i<t.forms.length;i++)t.forms[i].translated_name=o.translate(t.forms[i].name),t.forms[i].translated_description=o.translate(t.forms[i].description);e.forms=t.forms;var l={_id:"home",name:{en:"Application Home",fr:"Accueil de l`application"}};l.translated_name=o.translate(l.name),e.forms.push(l)}),r.get({id:t.application_id},function(t,a){if(t.profiles)for(var i=0;i<t.profiles.length;i++)t.profiles[i].translated_name=o.translate(t.profiles[i].name),t.profiles[i].translated_description=o.translate(t.profiles[i].description);e.application=t}),e.editText=function(e,t,o){e[t]||(e[t]={}),a.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0},function(a){e[t]=a})},e.save=function(){l.update({id:e.form._id},e.form,function(a){o.init(),o.location("/form_edit/"+e.form._id+"?application_id="+t.application_id+"&workflow_id="+t.workflow_id)},function(e){f()})},e.toggleInFormula=function(t){var a=e.action.formula.indexOf(t.id);a>-1?e.action.formula.splice(a,1):e.action.formula.push(t.id)},e.existsInFormula=function(t){return e.action.formula.indexOf(t.id)>-1};var f=function(){a.show(a.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
