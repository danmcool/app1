app1.controller("WorkflowEditCtrl",["$scope","SessionService","DesignWorkflow","DesignForm","Files","$location","$routeParams","$mdDialog",function(e,a,t,o,i,s,n,r){e.sessionData=a.getSessionData(),e.$watch(function(){return a.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),t.get({id:n.id},function(t,o){for(var i=0;i<t.forms.length;i++)t.forms[i].translated_name=a.translate(t.forms[i].name),t.forms[i].translated_description=a.translate(t.forms[i].description);e.workflow=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,a.setSessionData(e.sessionData)}),e.editText=function(e,a,t){e[a]||(e[a]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[a]=t})},e.editForm=function(o){t.update({id:e.workflow._id},e.workflow).$promise.then(function(t){a.init(),a.location("/form_edit/"+o+"?application_id="+n.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(a){e.application=a.application,updateErrorAlert()})},e.newForm=function(){var i={};i[e.sessionData.userData.properties.language]="";var s=new o({name:i});s.$save(function(){s.translated_name=s.name.en,e.workflow.forms.push(s),t.update({id:e.workflow._id},e.workflow).$promise.then(function(t){a.init(),a.location("/form_edit/"+s._id+"?application_id="+n.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(a){e.workflow=a.workflow,updateErrorAlert()})})},e.save=function(){t.update({id:e.workflow._id},e.workflow).$promise.then(function(e){a.init(),a.location("/application_edit/"+n.application_id)})["catch"](function(a){e.application=a.application,updateErrorAlert()})},e.uploadFile=function(a,t,o){const i=new XMLHttpRequest;i.open("PUT",t),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},i.send(a)},e.changeFile=function(a){if(1==a.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var t=new i({name:a[0].name,type:a[0].type});t.$save().then(function(t){e.workflow.file={_id:t.file._id,name:t.file.name,type:t.file.type},e.uploadFile(a[0],t.signedRequest,t.url)})}},e.removeFile=function(a){i.remove({id:a}).$promise.then(function(a){e.workflow.file=null})["catch"](function(e){})}}]);
