app1.controller("WorkflowEditCtrl",["$scope","SessionService","DesignWorkflow","DesignForm","Files","$location","$routeParams","$mdDialog",function(e,n,a,t,o,i,r,s){e.sessionData=n.getSessionData(),e.$watch(function(){return n.getSessionData()},function(n,a){n!=a&&(e.sessionData=n)}),a.get({id:r.id},function(a,t){for(var o=0;o<a.forms.length;o++)a.forms[o].translated_name=n.translate(a.forms[o].name),a.forms[o].translated_description=n.translate(a.forms[o].description);e.workflow=a,e.sessionData.applicationName=e.sessionData.appData.app_designer,n.setSessionData(e.sessionData)}),e.editText=function(e,n,a){e[n]||(e[n]={}),s.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[n],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[n]=a})},e.editForm=function(t){a.update({id:e.workflow._id},e.workflow).$promise.then(function(a){n.init(),n.location("/form_edit/"+t+"?application_id="+r.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(n){e.application=n.application,updateErrorAlert()})},e.newForm=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(o){var i=new t({name:{en:o}});i.$save(function(){i.translated_name=i.name.en,e.workflow.forms.push(i),a.update({id:e.workflow._id},e.workflow).$promise.then(function(a){n.init(),n.location("/form_edit/"+i._id+"?application_id="+r.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(n){e.workflow=n.workflow,updateErrorAlert()})})})},e.save=function(){a.update({id:e.workflow._id},e.workflow).$promise.then(function(e){n.init(),n.location("/application_edit/"+r.application_id)})["catch"](function(n){e.application=n.application,updateErrorAlert()})},e.uploadFile=function(n,a,t){const o=new XMLHttpRequest;o.open("PUT",a),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},o.send(n)},e.changeFile=function(n){if(1==n.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var a=new o({name:n[0].name,type:n[0].type});a.$save().then(function(a){e.workflow.file={_id:a.file._id,name:a.file.name,type:a.file.type},e.uploadFile(n[0],a.signedRequest,a.url)})}},e.removeFile=function(n){o.remove({id:n}).$promise.then(function(n){e.workflow.file=null})["catch"](function(e){})}}]);
