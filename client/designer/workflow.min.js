app1.controller("WorkflowEditCtrl",["$scope","SessionService","DesignWorkflow","DesignForm","$location","$routeParams","$mdDialog",function(e,a,t,n,o,i,s){e.sessionData=a.getSessionData(),e.$watch(function(){return a.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),t.get({id:i.id},function(t,n){for(var o=0;o<t.forms.length;o++)t.forms[o].translated_name=a.translate(t.forms[o].name),t.forms[o].translated_description=a.translate(t.forms[o].description);e.workflow=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,a.setSessionData(e.sessionData)}),e.editText=function(e,a,t){s.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[a]=t})},e.editForm=function(n){t.update({id:e.workflow._id},e.workflow).$promise.then(function(t){a.init(),o.url("/form_edit/"+n+"?application_id="+i.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(a){e.application=a.application,updateErrorAlert()})},e.newForm=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var t=new n({name:{en:a}});t.$save(function(){t.translated_name=t.name.en,e.workflow.forms.push(t)})})},e.save=function(){t.update({id:e.workflow._id},e.workflow).$promise.then(function(e){a.init(),o.url("/application_edit/"+i.application_id)})["catch"](function(a){e.application=a.application,updateErrorAlert()})}}]);
