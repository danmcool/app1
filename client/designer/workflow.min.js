app1.controller("WorkflowEditCtrl",["$scope","SessionService","DesignWorkflow","DesignForm","Files","$location","$routeParams","$mdDialog",function(e,t,o,n,i,a,l,r){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,o){t!=o&&(e.sessionData=t)}),o.get({id:l.id},function(o,n){for(var i=0;i<o.forms.length;i++)o.forms[i].translated_name=t.translate(o.forms[i].name),o.forms[i].translated_description=t.translate(o.forms[i].description);e.workflow=o,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,o){e[t]||(e[t]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){e[t]=o})},e.editForm=function(n){o.update({id:e.workflow._id},e.workflow).$promise.then(function(o){t.init(),t.location("/form_edit/"+n+"?application_id="+l.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newForm=function(){var i={};i[e.sessionData.userData.properties.language]="";var a=new n({name:i});a.$save(function(){a.translated_name=a.name.en,e.workflow.forms.push(a),o.update({id:e.workflow._id},e.workflow).$promise.then(function(o){t.init(),t.location("/form_edit/"+a._id+"?application_id="+l.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(t){e.workflow=t.workflow,updateErrorAlert()})})},e.deleteForm=function(t){var i=e.workflow.forms[t]._id;e.workflow.forms.splice(t,1),o.update({id:e.workflow._id},e.workflow).$promise.then(function(e){n.remove({id:i}).$promise.then(function(e){})["catch"](function(e){})})},e.save=function(){o.update({id:e.workflow._id},e.workflow).$promise.then(function(e){t.init(),t.location("/application_edit/"+l.application_id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.uploadFile=function(t,o,n){const i=new XMLHttpRequest;i.open("PUT",o),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},i.send(t)},e.changeFile=function(t){if(1==t.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var o=new i({name:t[0].name,type:t[0].type});o.$save().then(function(o){e.workflow.file={_id:o.file._id,name:o.file.name,type:o.file.type},e.uploadFile(t[0],o.signedRequest,o.url)})}},e.removeFile=function(t){i.remove({id:t}).$promise.then(function(t){e.workflow.file=null})["catch"](function(e){})}}]);
