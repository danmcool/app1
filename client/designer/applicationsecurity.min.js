app1.controller("ApplicationSecurityCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","DesignForm","Files","$location","$routeParams","$mdDialog",function(e,t,o,a,s,i,n,r,l){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,o){t!=o&&(e.sessionData=t)}),o.get({id:r.id},function(o,a){if(o.profiles)for(var s=0;s<o.profiles.length;s++)o.profiles[s].translated_name=t.translate(o.profiles[s].name),o.profiles[s].translated_description=t.translate(o.profiles[s].description);e.application=o,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,o){e[t]||(e[t]={}),l.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){e[t]=o})},e.editProfile=function(a){o.update({id:e.application._id},e.application).$promise.then(function(o){t.init(),t.location("/profile_edit/"+a+"?application_id="+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newProfile=function(){var t={};t[e.sessionData.userData.properties.language]="";var a=new DesignProfile({name:t});a.$save(function(){a.translated_name=a.name.en,e.application.profiles.push(a),o.update({id:e.application._id},e.application).$promise.then(function(e){})["catch"](function(t){e.application=t.application,updateErrorAlert()})})},e.deleteForm=function(t){var o=e.workflow.forms[t]._id;e.workflow.forms.splice(t,1),a.update({id:e.workflow._id},e.workflow).$promise.then(function(e){s.remove({id:o}).$promise.then(function(e){})["catch"](function(e){})})},e.save=function(){o.update({id:e.application._id},e.application).$promise.then(function(e){t.init(),t.location("/application_edit/"+r.application_id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})}}]);
