app1.controller("ApplicationSecurityCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","DesignForm","Files","$location","$routeParams","$mdDialog",function(e,i,a,o,t,l,n,s,r){e.sessionData=i.getSessionData(),e.$watch(function(){return i.getSessionData()},function(i,a){i!=a&&(e.sessionData=i)}),a.get({id:s.id},function(a,o){if(a.profiles)for(var t=0;t<a.profiles.length;t++)a.profiles[t].translated_name=i.translate(a.profiles[t].name),a.profiles[t].translated_description=i.translate(a.profiles[t].description);e.application=a,e.sessionData.applicationName=e.sessionData.appData.app_designer,i.setSessionData(e.sessionData)}),e.editText=function(e,i,a){e[i]||(e[i]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[i],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[i]=a})},e.editProfile=function(o){a.update({id:e.application._id},e.application,function(a){i.init(),i.location("/profile_edit/"+o+"?application_id="+e.application._id)},function(i){e.application=i.application,updateErrorAlert()})},e.newProfile=function(){var i={};i[e.sessionData.userData.properties.language]="";var o=new DesignProfile({name:i});o.$save(function(){o.translated_name=o.name.en,e.application.profiles.push(o),a.update({id:e.application._id},e.application,function(e){},function(i){e.application=i.application,updateErrorAlert()})})},e.deleteForm=function(i){var a=e.workflow.forms[i]._id;e.workflow.forms.splice(i,1),o.update({id:e.workflow._id},e.workflow,function(e){t.remove({id:a},function(e){},function(e){})})},e.save=function(){a.update({id:e.application._id},e.application,function(e){i.init(),i.location("/application_edit/"+s.id)},function(i){e.application=i.application,updateErrorAlert()})}}]);
