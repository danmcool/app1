app1.controller("ApplicationSecurityCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","DesignForm","Files","$location","$routeParams","$mdDialog",function(e,o,t,n,i,r,a,s,l){e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(o,t){o!=t&&(e.sessionData=o)}),t.get({id:s.id},function(t,n){if(t.profiles)for(var i=0;i<t.profiles.length;i++)t.profiles[i].translated_name=o.translate(t.profiles[i].name),t.profiles[i].translated_description=o.translate(t.profiles[i].description);e.application=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,o.setSessionData(e.sessionData)}),e.editText=function(e,o,t){e[o]||(e[o]={}),l.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[o],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[o]=t})},e.editProfile=function(n){t.update({id:e.application._id},e.application).$promise.then(function(t){o.init(),o.location("/profile_edit/"+n+"?application_id="+e.application._id)})["catch"](function(o){e.application=o.application,updateErrorAlert()})},e.newProfile=function(){var t={};t[e.sessionData.userData.properties.language]="";var i=new DesignProfile({name:t});i.$save(function(){i.translated_name=i.name.en,e.workflow.forms.push(newForm),n.update({id:e.workflow._id},e.workflow).$promise.then(function(t){o.init(),o.location("/form_edit/"+newForm._id+"?application_id="+s.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(o){e.workflow=o.workflow,updateErrorAlert()})})},e.deleteForm=function(o){var t=e.workflow.forms[o]._id;e.workflow.forms.splice(o,1),n.update({id:e.workflow._id},e.workflow).$promise.then(function(e){i.remove({id:t}).$promise.then(function(e){})["catch"](function(e){})})},e.save=function(){n.update({id:e.workflow._id},e.workflow).$promise.then(function(e){o.init(),o.location("/application_edit/"+s.application_id)})["catch"](function(o){e.application=o.application,updateErrorAlert()})}}]);
