app1.controller("DatamodelCtrl",["$scope","SessionService","DesignDataModel","$location","$routeParams","$mdDialog",function(e,t,a,o,n,i){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,a){t!=a&&(e.sessionData=t)}),a.query(function(a){for(var o=0;o<a.length;o++)a[o].translated_name=t.translate(a[o].name);e.datamodels=a,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,a){e[t]||(e[t]={}),i.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[t]=a})},e.editForm=function(a){DesignWorkflow.update({id:e.workflow._id},e.workflow).$promise.then(function(o){t.init(),t.location("/form_edit/"+a+"?application_id="+n.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newForm=function(){i.show(i.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var o={};o[e.sessionData.userData.properties.language]=a;var i=new DesignForm({name:o});i.$save(function(){i.translated_name=i.name.en,e.workflow.forms.push(i),DesignWorkflow.update({id:e.workflow._id},e.workflow).$promise.then(function(a){t.init(),t.location("/form_edit/"+i._id+"?application_id="+n.application_id+"&workflow_id="+e.workflow._id)})["catch"](function(t){e.workflow=t.workflow,updateErrorAlert()})})})},e.save=function(){DesignWorkflow.update({id:e.workflow._id},e.workflow).$promise.then(function(e){t.init(),t.location("/application_edit/"+n.application_id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.uploadFile=function(t,a,o){const n=new XMLHttpRequest;n.open("PUT",a),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},n.send(t)},e.changeFile=function(t){if(1==t.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var a=new Files({name:t[0].name,type:t[0].type});a.$save().then(function(a){e.workflow.file={_id:a.file._id,name:a.file.name,type:a.file.type},e.uploadFile(t[0],a.signedRequest,a.url)})}},e.removeFile=function(t){Files.remove({id:t}).$promise.then(function(t){e.workflow.file=null})["catch"](function(e){})}}]);
