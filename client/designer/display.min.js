app1.controller("FormDisplayEditCtrl",["$scope","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignWorkflow",function(e,t,o,a,r,s,n){e.sessionData=a.getSessionData(),e.$watch(function(){return a.getSessionData()},function(t,o){t!=o&&(e.sessionData=t)}),e.section_index=t.section,e.block_index=t.block,e.field_index=t.field,e.datamodels=[],e.display_type={list:{en:"List",fr:"Liste"},item:{en:"Detail List",fr:"Liste de détails"},shorttext:{en:"Text",fr:"Texte"},number:{en:"Number",fr:"Nombre"},currency:{en:"Amount",fr:"Montant"},editor:{en:"Text Editor",fr:"Editeur texte"},feed:{en:"Discussion Feed",fr:"Fil de discussion"},file:{en:"File",fr:"Fichier"},image:{en:"Image",fr:"Image"},selection:{en:"Selection",fr:"Selection"},check:{en:"Check",fr:"Contrôle"},calendar:{en:"Calendar",fr:"Calendrier"},appointment:{en:"Appointment",fr:"Rendez-vous"},appointment_properties:{en:"Appointment Configuration",fr:"Configuration rendez-vous"},calculation:{en:"Formula",fr:"Formule"},email:{en:"Email",fr:"Courriel"},address:{en:"Address",fr:"Adresse"}},e.title_display_type={text:{en:"Text",fr:"Texte"},value:{en:"Value",fr:"Valeur"},currency:{en:"Amount",fr:"Montant"},calculation:{en:"Formula",fr:"Formule"}};var i=Object.keys(e.display_type);e.display_types=[];for(var d=0;d<i.length;d++)e.display_types.push({translated_name:a.translate(e.display_type[i[d]]),type:i[d]});var c=Object.keys(e.title_display_type);e.title_display_types=[];for(var l=0;l<c.length;l++)e.title_display_types.push({translated_name:a.translate(e.title_display_type[c[l]]),type:c[l]});e.list_action_type={modify_list:{en:"Modify",fr:"Modifier"},delete_list:{en:"Delete",fr:"Supprimer"},link_list:{en:"Link",fr:"Lien"}},e.item_action_type={modify_item:{en:"Modify",fr:"Modifier"},delete_item:{en:"Delete",fr:"Supprimer"},link_item:{en:"Link",fr:"Lien"},move_item:{en:"Move Item",fr:"Deplacer element"}};var u=Object.keys(e.list_action_type);for(e.list_action_types=[],d=0;d<u.length;d++)e.list_action_types.push({translated_name:a.translate(e.list_action_type[u[d]]),type:u[d]});var p=Object.keys(e.item_action_type);for(e.item_action_types=[],d=0;d<p.length;d++)e.item_action_types.push({translated_name:a.translate(e.item_action_type[p[d]]),type:p[d]});r.get({id:t.id},function(t,o){if(e.form=t,e.form.translated_name=a.translate(e.form.name),e.field=e.form.display[e.section_index].blocks[e.block_index].fields[e.field_index],e.datamodel_keys=[],"item"!=e.field.display&&"reference"!=e.field.display&&e.form.datamodel)for(var r=Object.keys(e.form.datamodel.projection),s=0;s<r.length;s++)e.datamodel_keys.push({translated_name:a.translate(e.form.datamodel.projection[r[s]].name),full_path:e.form.datamodel.projection[r[s]].full_path,id:r[s]});if(e.form.actions)for(var s=0;s<e.form.actions.length;s++)e.form.actions[s].translated_name=a.translate(e.form.actions[s].name);if(e.form.values)for(var s=0;s<e.form.values.length;s++)e.form.values[s].translated_name=a.translate(e.form.values[s].name);e.sessionData.applicationName=e.sessionData.appData.app_designer,a.setSessionData(e.sessionData)}),n.get({id:t.workflow_id},function(t,o){for(var r=0;r<t.forms.length;r++)t.forms[r].translated_name=a.translate(t.forms[r].name),t.forms[r].translated_description=a.translate(t.forms[r].description);e.forms=t.forms;var s={_id:"home",name:{en:"Application Home",fr:"Accueil de l`application"}};s.translated_name=a.translate(s.name),e.forms.push(s)}),s.query({skip:0,limit:500},function(t){if(e.ref_datamodel_keys=[],"item"==e.field.display||"reference"==e.field.display){var r=!1,s=!1;if(field.ref&&field.ref.startsWith("datas")){field.ref.substring(5)}else field.ref.startsWith("User")?r=!0:field.ref.startsWith("File")&&(s=!0);for(var n=0;n<t.length;n++)if(t[n].translated_name=a.translate(t[n].name),r)for(var i=Object.keys(e.form.datamodel.projection),n=0;n<i.length;n++)e.ref_datamodel_keys.push({translated_name:a.translate(e.form.datamodel.projection[i[n]].name),full_path:e.form.datamodel.projection[i[n]].full_path,id:i[n]})}e.datamodels=t}),e.editText=function(e,t,a){e[t]||(e[t]={}),o.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){e[t]=o})},e.addActionList=function(t){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_action).initialValue("My Action").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(o){t.item_actions||(t.item_actions=[]);var a={};a[e.sessionData.userData.properties.language]=o,t.item_actions.push({name:a,translated_name:o})})},e.save=function(){e.field.projectionid&&(e.field.full_path=""==e.form.datamodel.projection[e.field.projectionid].path?e.form.datamodel.projection[e.field.projectionid].technical_name:e.form.datamodel.projection[e.field.projectionid].path+"."+e.form.datamodel.projection[e.field.projectionid].technical_name),e.field.title&&(e.field.title_full_path=""==e.form.datamodel.projection[e.field.title].path?e.form.datamodel.projection[e.field.title].technical_name:e.form.datamodel.projection[e.field.title].path+"."+e.form.datamodel.projection[e.field.title].technical_name),e.field.subtitle&&(e.field.subtitle_full_path=""==e.form.datamodel.projection[e.field.subtitle].path?e.form.datamodel.projection[e.field.subtitle].technical_name:e.form.datamodel.projection[e.field.subtitle].path+"."+e.form.datamodel.projection[e.field.subtitle].technical_name),r.update({id:e.form._id},e.form).$promise.then(function(o){a.init(),a.location("/form_edit/"+e.form._id+"?application_id="+t.application_id+"&workflow_id="+t.workflow_id)})["catch"](function(e){f()})};var f=function(){o.show(o.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
