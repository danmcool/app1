app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel",function(e,a,n,t,o,i,r,s){e.sessionData=i.getSessionData(),e.$watch(function(){return i.getSessionData()},function(a,n){a!=n&&(e.sessionData=a)}),r.get({id:t.id},function(a,n){if(e.form=a,e.form.actions)for(var t=0;t<e.form.actions.length;t++)e.form.actions[t].translated_name=i.translate(e.form.actions[t].name);if(e.form.values)for(var t=0;t<e.form.values.length;t++)e.form.values[t].translated_name=i.translate(e.form.values[t].name);e.sessionData.applicationName=e.sessionData.appData.app_designer,i.setSessionData(e.sessionData)}),s.query(function(a){for(var n=0;n<a.length;n++)a[n].translated_name=i.translate(a[n].name);e.datamodels=a}),e.editText=function(e,a,n){e[a]||(e[a]={}),o.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:n},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(n){e[a]=n})},e.editField=function(a,n,o){r.update({id:e.form._id},e.form).$promise.then(function(r){i.init(),i.location("/form_display_edit/"+e.form._id+"?section="+a+"&block="+n+"&field="+o+"&application_id="+t.application_id+"&workflow_id="+t.workflow_id)})["catch"](function(e){updateErrorAlert()})},e.editAction=function(e){i.init(),i.location("/form_edit/"+e)},e.newAction=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var n=new DesignWorkflow({name:{en:a}});n.$save(function(){n.translated_name=n.name.en,e.application.workflows.push(n)})})},e.newSection=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.display||(e.form.display=[]),e.form.display.push({blocks:[{fields:[{name:a}]}]})})},e.newBlock=function(a){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){e.form.display||(e.form.display=[]),a.push({fields:[{name:n}]})})},e.newField=function(a){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){e.form.display||(e.form.display=[]),a.push({name:n})})},e.save=function(){r.update({id:e.form._id},e.form).$promise.then(function(e){i.init(),i.location("/workflow_edit/"+t.workflow_id+"?application_id="+t.application_id)})["catch"](function(e){updateErrorAlert()})},e.onDragEnter=function(e){element.classList.add("dash_line")}}]);
