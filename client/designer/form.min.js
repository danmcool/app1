app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel",function(e,n,a,t,o,i,r,s){e.sessionData=i.getSessionData(),e.$watch(function(){return i.getSessionData()},function(n,a){n!=a&&(e.sessionData=n)}),r.get({id:t.id},function(n,a){e.form=n;for(var t=0;t<e.form.actions.length;t++)e.form.actions[t].translated_name=i.translate(e.form.actions[t].name);for(var t=0;t<e.form.values.length;t++)e.form.values[t].translated_name=i.translate(e.form.values[t].name);e.sessionData.applicationName=e.sessionData.appData.app_designer,i.setSessionData(e.sessionData)}),s.query(function(n){for(var a=0;a<n.length;a++)n[a].translated_name=i.translate(n[a].name);e.datamodels=n}),e.editText=function(e,n,a){o.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[n],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[n]=a})},e.editField=function(n,a,t){r.update({id:e.form._id},e.form).$promise.then(function(o){i.init(),i.location("/form_display_edit/"+e.form._id+"?section="+n+"&block="+a+"&field="+t)})["catch"](function(n){e.application=n.application,updateErrorAlert()})},e.editAction=function(e){i.init(),i.location("/form_edit/"+e)},e.newAction=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){var a=new DesignWorkflow({name:{en:n}});a.$save(function(){a.translated_name=a.name.en,e.application.workflows.push(a)})})},e.newSection=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){e.form.display||(e.form.display=[]),e.form.display.push({blocks:[{fields:[{name:n}]}]})})},e.newBlock=function(n){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.display||(e.form.display=[]),n.push({fields:[{name:a}]})})},e.newField=function(n){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.display||(e.form.display=[]),n.push({name:a})})},e.save=function(){r.update({id:e.form._id},e.form).$promise.then(function(e){i.init(),i.location("/workflow_edit/"+t.workflow_id+"?application_id="+t.application_id)})["catch"](function(n){e.application=n.application,updateErrorAlert()})},e.onDragEnter=function(e){element.classList.add("dash_line")}}]);
