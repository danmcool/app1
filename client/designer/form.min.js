app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel",function(e,n,r,a,i,o,t,s){e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(n,r){n!=r&&(e.sessionData=n)}),t.get({id:a.id},function(n,r){if(e.form=n,e.form.actions)for(var a=0;a<e.form.actions.length;a++)e.form.actions[a].translated_name=o.translate(e.form.actions[a].name);if(e.form.values)for(var a=0;a<e.form.values.length;a++)e.form.values[a].translated_name=o.translate(e.form.values[a].name);if(e.form.display)for(var a=0;a<e.form.display.length;a++)for(var i=0;i<e.form.display[a].blocks.length;i++)for(var t=0;t<e.form.display[a].blocks[i].fields.length;t++)e.form.display[a].blocks[i].fields[t].text?e.form.display[a].blocks[i].fields[t].translated_name=o.translate(e.form.display[a].blocks[i].fields[t].text):e.form.display[a].blocks[i].fields[t].translated_name=o.translate(e.form.datamodel.translation[e.form.display[a].blocks[i].fields[t].name]);e.sessionData.applicationName=e.sessionData.appData.app_designer,o.setSessionData(e.sessionData)}),s.query(function(n){for(var r=0;r<n.length;r++)n[r].translated_name=o.translate(n[r].name);e.datamodels=n}),e.editText=function(e,n,r){e[n]||(e[n]={}),i.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[n],multipleLines:r},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(r){e[n]=r})},e.editField=function(n,r,i){t.update({id:e.form._id},e.form).$promise.then(function(t){o.init(),o.location("/form_display_edit/"+e.form._id+"?section="+n+"&block="+r+"&field="+i+"&application_id="+a.application_id+"&workflow_id="+a.workflow_id)})["catch"](function(e){updateErrorAlert()})},e.deleteField=function(n,r,a){e.form.display[n].blocks[r].fields.length>0&&e.form.display[n].blocks[r].fields.splice(a,1),0==e.form.display[n].blocks[r].fields.length&&e.form.display[n].blocks.splice(r,1),0==e.form.display[n].blocks.length&&e.form.display.splice(n,1)},e.editAction=function(e){o.init(),o.location("/form_edit/"+e)},e.newAction=function(){i.show(i.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){var r=new DesignWorkflow({name:{en:n}});r.$save(function(){r.translated_name=r.name.en,e.application.workflows.push(r)})})},e.newSection=function(){i.show(i.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){e.form.display||(e.form.display=[]);var r={};r[e.sessionData.userData.properties.language]=n,e.form.display.push({blocks:[{fields:[{text:r,translated_name:n}]}]})})},e.newBlock=function(n){i.show(i.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(r){e.form.display||(e.form.display=[]);var a={};a[e.sessionData.userData.properties.language]=r,n.push({fields:[{text:a,translated_name:r}]})})},e.newField=function(n){i.show(i.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(r){e.form.display||(e.form.display=[]);var a={};a[e.sessionData.userData.properties.language]=r,n.push({text:a,translated_name:r})})},e.save=function(){t.update({id:e.form._id},e.form).$promise.then(function(e){o.init(),o.location("/workflow_edit/"+a.workflow_id+"?application_id="+a.application_id)})["catch"](function(e){updateErrorAlert()})},e.onDragEnter=function(e){element.classList.add("dash_line")}}]);
