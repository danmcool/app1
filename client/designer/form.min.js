app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel",function(e,t,a,n,r,o,i,s){e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(t,a){t!=a&&(e.sessionData=t)}),i.get({id:n.id},function(t,a){e.form=t;for(var n=0;n<e.form.actions.length;n++)e.form.actions[n].translated_name=o.translate(e.form.actions[n].name);for(var n=0;n<e.form.values.length;n++)e.form.values[n].translated_name=o.translate(e.form.values[n].name);e.sessionData.applicationName=e.sessionData.appData.app_designer,o.setSessionData(e.sessionData)}),s.query(function(t){for(var a=0;a<t.length;a++)t[a].translated_name=o.translate(t[a].name);e.datamodels=t}),e.editText=function(e,t,a){r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:a},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[t]=a})},e.editAction=function(e){o.location("/form_edit/"+e)},e.newAction=function(){r.show(r.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Form").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){var a=new DesignWorkflow({name:{en:t}});a.$save(function(){a.translated_name=a.name.en,e.application.workflows.push(a)})})},e.newSection=function(){r.show(r.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){e.form.display||(e.form.display=[]),e.form.display.push({blocks:[{fields:[{name:t}]}]})})},e.newBlock=function(t){r.show(r.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.display||(e.form.display=[]),t.push({fields:[{name:a}]})})},e.newField=function(t){r.show(r.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.display||(e.form.display=[]),t.push({name:a})})},e.save=function(){i.update({id:e.form._id},e.form).$promise.then(function(e){o.init(),o.location("/workflow_edit/"+n.workflow_id+"?application_id="+n.application_id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.onDragEnter=function(e){element.classList.add("dash_line")}}]);
