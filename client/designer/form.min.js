app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignValue",function(e,a,i,o,t,l,s,n,d){e.sessionData=l.getSessionData(),e.$watch(function(){return l.getSessionData()},function(a,i){a!=i&&(e.sessionData=a)}),e.field_id_list={};var f=function(){var a=Object.keys(e.field_id_list),i=a.length;do i+=1;while(e.field_id_list[i]);return e.field_id_list[i]=!0,i};s.get({id:o.id},function(a,i){if(e.form=a,e.form.actions)for(var o=0;o<e.form.actions.length;o++)e.form.actions[o].translated_name=l.translate(e.form.actions[o].name);else e.form.actions=[];if(e.form.values)for(var o=0;o<e.form.values.length;o++)e.form.values[o].translated_name=l.translate(e.form.values[o].name);else e.form.values=[];if(e.form.display)for(var o=0;o<e.form.display.length;o++)for(var t=0;t<e.form.display[o].blocks.length;t++)for(var s=0;s<e.form.display[o].blocks[t].fields.length;s++)e.form.display[o].blocks[t].fields[s].id||(e.form.display[o].blocks[t].fields[s].id=f()),e.field_id_list[e.form.display[o].blocks[t].fields[s].id]=!0,e.form.display[o].blocks[t].fields[s].text?e.form.display[o].blocks[t].fields[s].translated_name=l.translate(e.form.display[o].blocks[t].fields[s].text):e.form.display[o].blocks[t].fields[s].translated_name=l.translate(e.form.datamodel.projection[e.form.display[o].blocks[t].fields[s].name]);else e.form.display=[];e.sessionData.applicationName=e.sessionData.appData.app_designer,l.setSessionData(e.sessionData)}),n.query({skip:0,limit:500},function(a){for(var i=0;i<a.length;i++)a[i].translated_name=l.translate(a[i].name);e.datamodels=a}),e.editText=function(e,a,i){e[a]||(e[a]={}),t.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:i},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(i){e[a]=i})};var m=function(a){s.update({id:e.form._id},e.form,function(e){l.location(a)},function(e){p()})};e.editField=function(a,i,t){m("/form_display_edit/"+e.form._id+"?section="+a+"&block="+i+"&field="+t+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id)},e.deleteField=function(a,i,o){e.form.display[a].blocks[i].fields.length>0&&e.form.display[a].blocks[i].fields.splice(o,1),0==e.form.display[a].blocks[i].fields.length&&e.form.display[a].blocks.splice(i,1),0==e.form.display[a].blocks.length&&e.form.display.splice(a,1);for(var t=0;t<e.form.display[a].blocks.length;t++)e.form.display[a].blocks[t].flex=100/e.form.display[a].blocks.length},e.editAction=function(a){m("/form_action_edit/"+e.form._id+"?action="+a+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id)},e.deleteAction=function(a){e.form.actions.splice(a,1)},e.editValue=function(a){m("/form_value_edit/"+a._id+"?datamodel_id="+e.form.datamodel._id+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id+"&form_id="+e.form._id)},e.deleteValue=function(a){e.form.values.splice(a,1)},e.newAction=function(){var a={};a[e.sessionData.userData.properties.language]="",e.form.actions.push({name:a,translated_name:""}),m("/form_action_edit/"+e.form._id+"?action="+(e.form.actions.length-1)+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id)},e.newValue=function(){t.show({templateUrl:"designer/newvalue.html",controller:"NewValueCtrl",parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){if(""==a){var i={};i[e.sessionData.userData.properties.language]="";var t=new d({name:i});t.$save(function(){e.form.values||(e.form.values=[]),e.form.values.push({name:i,_id:t._id}),m("/form_value_edit/"+t._id+"?datamodel_id="+e.form.datamodel._id+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id+"&form_id="+e.form._id)})}else e.form.values.push({name:"",_id:a}),m("/form_value_edit/"+a+"?datamodel_id="+e.form.datamodel._id+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id+"&form_id="+e.form._id)})},e.newSection=function(){e.form.display||(e.form.display=[]);var a={};a[e.sessionData.userData.properties.language]="",e.form.display.push({blocks:[{flex:100,fields:[{text:a,translated_name:"",disabled:!1,mandatory:!1,id:f()}]}]})},e.newBlock=function(a){e.form.display||(e.form.display=[]);var i={};i[e.sessionData.userData.properties.language]="",a.push({fields:[{text:i,translated_name:"",disabled:!1,mandatory:!1,id:f()}]});for(var o=0;o<a.length;o++)a[o].flex=100/a.length},e.newField=function(a){var i={};i[e.sessionData.userData.properties.language]="",a.push({text:i,translated_name:"",disabled:!1,mandatory:!1,id:f()})},e.save=function(){m("/workflow_edit/"+o.workflow_id+"?application_id="+o.application_id)},e.onDragEnter=function(e){element.classList.add("dash_line")};var p=function(){t.show(t.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
