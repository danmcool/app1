app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignValue",function(e,a,t,o,n,i,s,r,l){e.sessionData=i.getSessionData(),e.$watch(function(){return i.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),s.get({id:o.id},function(a,t){if(e.form=a,e.form.actions)for(var o=0;o<e.form.actions.length;o++)e.form.actions[o].translated_name=i.translate(e.form.actions[o].name);if(e.form.values)for(var o=0;o<e.form.values.length;o++)e.form.values[o].translated_name=i.translate(e.form.values[o].name);if(e.form.display)for(var o=0;o<e.form.display.length;o++)for(var n=0;n<e.form.display[o].blocks.length;n++)for(var s=0;s<e.form.display[o].blocks[n].fields.length;s++)e.form.display[o].blocks[n].fields[s].text?e.form.display[o].blocks[n].fields[s].translated_name=i.translate(e.form.display[o].blocks[n].fields[s].text):e.form.display[o].blocks[n].fields[s].translated_name=i.translate(e.form.datamodel.translation[e.form.display[o].blocks[n].fields[s].name]);e.sessionData.applicationName=e.sessionData.appData.app_designer,i.setSessionData(e.sessionData)}),r.query(function(a){for(var t=0;t<a.length;t++)a[t].translated_name=i.translate(a[t].name);e.datamodels=a}),e.editText=function(e,a,t){e[a]||(e[a]={}),n.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[a]=t})};var u=function(a){s.update({id:e.form._id},e.form).$promise.then(function(e){i.location(a)})["catch"](function(e){f()})};e.editField=function(a,t,n){u("/form_display_edit/"+e.form._id+"?section="+a+"&block="+t+"&field="+n+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id)},e.deleteField=function(a,t,o){e.form.display[a].blocks[t].fields.length>0&&e.form.display[a].blocks[t].fields.splice(o,1),0==e.form.display[a].blocks[t].fields.length&&e.form.display[a].blocks.splice(t,1),0==e.form.display[a].blocks.length&&e.form.display.splice(a,1)},e.editAction=function(a){u("/form_action_edit/"+e.form._id+"?action="+a+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id)},e.deleteAction=function(a){e.form.actions.splice(a,1)},e.editValue=function(a){u("/form_value_edit/"+a._id+"?datamodel_id="+e.form.datamodel._id+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id+"&form_id="+e.form._id)},e.deleteValue=function(a){e.form.values.splice(a,1)},e.newAction=function(){n.show(n.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_action).initialValue("My Action").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.actions||(e.form.actions=[]);var t={};t[e.sessionData.userData.properties.language]=a,e.form.actions.push({name:t,translated_name:a}),u("/form_action_edit/"+e.form._id+"?action="+(e.form.actions.length-1)+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id)})},e.newValue=function(){n.show(n.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_value).initialValue("My Value").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var t={};t[e.sessionData.userData.properties.language]=a;var n=new l({name:t});n.$save(function(){e.form.values||(e.form.values=[]),e.form.values.push({name:t,_id:n._id}),u("/form_value_edit/"+n._id+"?datamodel_id="+e.form.datamodel._id+"&application_id="+o.application_id+"&workflow_id="+o.workflow_id+"&form_id="+e.form._id)})})},e.newSection=function(){n.show(n.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){e.form.display||(e.form.display=[]);var t={};t[e.sessionData.userData.properties.language]=a,e.form.display.push({blocks:[{fields:[{text:t,translated_name:a}]}]})})},e.newBlock=function(a){n.show(n.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){e.form.display||(e.form.display=[]);var o={};o[e.sessionData.userData.properties.language]=t,a.push({fields:[{text:o,translated_name:t}]})})},e.newField=function(a){n.show(n.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){e.form.display||(e.form.display=[]);var o={};o[e.sessionData.userData.properties.language]=t,a.push({text:o,translated_name:t})})},e.save=function(){u("/workflow_edit/"+o.workflow_id+"?application_id="+o.application_id)},e.onDragEnter=function(e){element.classList.add("dash_line")};var f=function(){n.show(n.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
