app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel",function(e,o,n,t,a,s,i,r){e.sessionData=s.getSessionData(),e.$watch(function(){return s.getSessionData()},function(o,n){o!=n&&(e.sessionData=o)}),i.get({id:t.id},function(o,n){if(e.form=o,e.form.actions)for(var t=0;t<e.form.actions.length;t++)e.form.actions[t].translated_name=s.translate(e.form.actions[t].name);if(e.form.values)for(var t=0;t<e.form.values.length;t++)e.form.values[t].translated_name=s.translate(e.form.values[t].name);if(e.form.display)for(var t=0;t<e.form.display.length;t++)for(var a=0;a<e.form.display[t].blocks.length;a++)for(var i=0;i<e.form.display[t].blocks[a].fields.length;i++)e.form.display[t].blocks[a].fields[i].text?e.form.display[t].blocks[a].fields[i].translated_name=s.translate(e.form.display[t].blocks[a].fields[i].text):e.form.display[t].blocks[a].fields[i].translated_name=s.translate(e.form.datamodel.translation[e.form.display[t].blocks[a].fields[i].name]);e.sessionData.applicationName=e.sessionData.appData.app_designer,s.setSessionData(e.sessionData)}),r.query(function(o){for(var n=0;n<o.length;n++)o[n].translated_name=s.translate(o[n].name);e.datamodels=o}),e.editText=function(e,o,n){e[o]||(e[o]={}),a.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[o],multipleLines:n},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(n){e[o]=n})};var d=function(o){i.update({id:e.form._id},e.form).$promise.then(function(e){s.location(o)})["catch"](function(e){u()})};e.editField=function(o,n,a){d("/form_display_edit/"+e.form._id+"?section="+o+"&block="+n+"&field="+a+"&application_id="+t.application_id+"&workflow_id="+t.workflow_id)},e.deleteField=function(o,n,t){e.form.display[o].blocks[n].fields.length>0&&e.form.display[o].blocks[n].fields.splice(t,1),0==e.form.display[o].blocks[n].fields.length&&e.form.display[o].blocks.splice(n,1),0==e.form.display[o].blocks.length&&e.form.display.splice(o,1)},e.editAction=function(o){d("/form_action_edit/"+e.form._id+"?action="+o+"&application_id="+t.application_id+"&workflow_id="+t.workflow_id)},e.deleteAction=function(o){e.form.actions.splice(o,1)},e.newAction=function(){a.show(a.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_action_name).initialValue("My Action").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(o){e.form.actions||(e.form.actions=[]);var n={};n[e.sessionData.userData.properties.language]=o,e.form.actions.push({name:n,translated_name:o})})},e.newSection=function(){a.show(a.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(o){e.form.display||(e.form.display=[]);var n={};n[e.sessionData.userData.properties.language]=o,e.form.display.push({blocks:[{fields:[{text:n,translated_name:o}]}]})})},e.newBlock=function(o){a.show(a.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){e.form.display||(e.form.display=[]);var t={};t[e.sessionData.userData.properties.language]=n,o.push({fields:[{text:t,translated_name:n}]})})},e.newField=function(o){a.show(a.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(n){e.form.display||(e.form.display=[]);var t={};t[e.sessionData.userData.properties.language]=n,o.push({text:t,translated_name:n})})},e.save=function(){d("/workflow_edit/"+t.workflow_id+"?application_id="+t.application_id)},e.onDragEnter=function(e){element.classList.add("dash_line")};var u=function(){a.show(a.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
