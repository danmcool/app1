app1.controller("FormEditCtrl",["$scope","$resource","$location","$routeParams","$mdDialog","SessionService","DesignForm","DesignDataModel","DesignValue",function(e,t,o,a,s,r,i,n,l){e.sessionData=r.getSessionData(),e.$watch(function(){return r.getSessionData()},function(t,o){t!=o&&(e.sessionData=t)}),e.field_id_list={};var c=function(){var t=Object.keys(e.field_id_list),o=t.length;do o+=1;while(e.field_id_list[o]);return e.field_id_list[o]=!0,o};i.get({id:a.id},function(t,o){if(e.form=t,e.form.actions)for(var a=0;a<e.form.actions.length;a++)e.form.actions[a].translated_name=r.translate(e.form.actions[a].name);if(e.form.values)for(var a=0;a<e.form.values.length;a++)e.form.values[a].translated_name=r.translate(e.form.values[a].name);if(e.form.display)for(var a=0;a<e.form.display.length;a++)for(var s=0;s<e.form.display[a].blocks.length;s++)for(var i=0;i<e.form.display[a].blocks[s].fields.length;i++)e.form.display[a].blocks[s].fields[i].id||(e.form.display[a].blocks[s].fields[i].id=c()),e.field_id_list[e.form.display[a].blocks[s].fields[i].id]=!0,e.form.display[a].blocks[s].fields[i].text?e.form.display[a].blocks[s].fields[i].translated_name=r.translate(e.form.display[a].blocks[s].fields[i].text):e.form.display[a].blocks[s].fields[i].translated_name=r.translate(e.form.datamodel.projection[e.form.display[a].blocks[s].fields[i].name]);e.sessionData.applicationName=e.sessionData.appData.app_designer,r.setSessionData(e.sessionData)}),n.query(function(t){for(var o=0;o<t.length;o++)t[o].translated_name=r.translate(t[o].name);e.datamodels=t}),e.editText=function(e,t,o){e[t]||(e[t]={}),s.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){e[t]=o})};var u=function(t){i.update({id:e.form._id},e.form).$promise.then(function(e){r.location(t)})["catch"](function(e){f()})};e.editField=function(t,o,s){u("/form_display_edit/"+e.form._id+"?section="+t+"&block="+o+"&field="+s+"&application_id="+a.application_id+"&workflow_id="+a.workflow_id)},e.deleteField=function(t,o,a){e.form.display[t].blocks[o].fields.length>0&&e.form.display[t].blocks[o].fields.splice(a,1),0==e.form.display[t].blocks[o].fields.length&&e.form.display[t].blocks.splice(o,1),0==e.form.display[t].blocks.length&&e.form.display.splice(t,1)},e.editAction=function(t){u("/form_action_edit/"+e.form._id+"?action="+t+"&application_id="+a.application_id+"&workflow_id="+a.workflow_id)},e.deleteAction=function(t){e.form.actions.splice(t,1)},e.editValue=function(t){u("/form_value_edit/"+t._id+"?datamodel_id="+e.form.datamodel._id+"&application_id="+a.application_id+"&workflow_id="+a.workflow_id+"&form_id="+e.form._id)},e.deleteValue=function(t){e.form.values.splice(t,1)},e.newAction=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_action).initialValue("My Action").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){e.form.actions||(e.form.actions=[]);var o={};o[e.sessionData.userData.properties.language]=t,e.form.actions.push({name:o,translated_name:t}),u("/form_action_edit/"+e.form._id+"?action="+(e.form.actions.length-1)+"&application_id="+a.application_id+"&workflow_id="+a.workflow_id)})},e.newValue=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_value).initialValue("My Value").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){var o={};o[e.sessionData.userData.properties.language]=t;var s=new l({name:o});s.$save(function(){e.form.values||(e.form.values=[]),e.form.values.push({name:o,_id:s._id}),u("/form_value_edit/"+s._id+"?datamodel_id="+e.form.datamodel._id+"&application_id="+a.application_id+"&workflow_id="+a.workflow_id+"&form_id="+e.form._id)})})},e.newSection=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){e.form.display||(e.form.display=[]);var o={};o[e.sessionData.userData.properties.language]=t,e.form.display.push({blocks:[{fields:[{text:o,translated_name:t,disabled:!1,mandatory:!1,id:c()}]}]})})},e.newBlock=function(t){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(o){e.form.display||(e.form.display=[]);var a={};a[e.sessionData.userData.properties.language]=o,t.push({fields:[{text:a,translated_name:o,disabled:!1,mandatory:!1,id:c()}]})})},e.newField=function(t){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_field).textContent(e.sessionData.appData.new_field_name).initialValue("New Field").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(o){e.form.display||(e.form.display=[]);var a={};a[e.sessionData.userData.properties.language]=o,t.push({text:a,translated_name:o,disabled:!1,mandatory:!1,id:c()})})},e.save=function(){u("/workflow_edit/"+a.workflow_id+"?application_id="+a.application_id)},e.onDragEnter=function(e){element.classList.add("dash_line")};var f=function(){s.show(s.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
