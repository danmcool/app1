app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(e,n,r,o,t,i,a,s){e.sessionData=n.getSessionData(),e.$watch(function(){return n.getSessionData()},function(n,r){n!=r&&(e.sessionData=n)}),r.get({id:a.id},function(r,o){if(r.workflows)for(var t=0;t<r.workflows.length;t++)r.workflows[t].translated_name=n.translate(r.workflows[t].name),r.workflows[t].translated_description=n.translate(r.workflows[t].description);e.application=r,e.sessionData.applicationName=e.sessionData.appData.app_designer,n.setSessionData(e.sessionData)}),e.editText=function(e,n,r){e[n]||(e[n]={}),s.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[n],multipleLines:r},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(r){e[n]=r})},e.editWorkflow=function(o){r.update({id:e.application._id},e.application).$promise.then(function(r){n.init(),n.location("/workflow_edit/"+o+"?application_id="+e.application._id)})["catch"](function(n){e.application=n.application,updateErrorAlert()})},e.newWorkflow=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Workflow").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){var i={};i[e.sessionData.userData.properties.language]=t;var a=new o({name:i});a.$save(function(){a.translated_name=t,e.application.workflows.push(a),r.update({id:e.application._id},e.application).$promise.then(function(r){n.init(),n.location("/workflow_edit/"+a._id+"?application_id="+e.application._id)})["catch"](function(n){e.application=n.application,updateErrorAlert()})})})},e.save=function(){r.update({id:e.application._id},e.application).$promise.then(function(e){n.init(),n.location("/designer")})["catch"](function(n){e.application=n.application,updateErrorAlert()})},e.uploadFile=function(n,r,o){const t=new XMLHttpRequest;t.open("PUT",r),t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},t.send(n)},e.changeFile=function(n){if(1==n.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var r=new t({name:n[0].name,type:n[0].type});r.$save().then(function(r){e.application.file={_id:r.file._id,name:r.file.name,type:r.file.type},e.uploadFile(n[0],r.signedRequest,r.url)})}},e.removeFile=function(n){t.remove({id:n}).$promise.then(function(n){e.application.file=null})["catch"](function(e){})}}]);
