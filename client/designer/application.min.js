app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(e,t,o,a,s,i,r,n){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,o){t!=o&&(e.sessionData=t)}),o.get({id:r.id},function(o,a){if(o.workflows)for(var s=0;s<o.workflows.length;s++)o.workflows[s].translated_name=t.translate(o.workflows[s].name),o.workflows[s].translated_description=t.translate(o.workflows[s].description);e.application=o,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,o){e[t]||(e[t]={}),n.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){e[t]=o})},e.editWorkflow=function(a){o.update({id:e.application._id},e.application).$promise.then(function(o){t.init(),t.location("/workflow_edit/"+a+"?application_id="+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.editAppSecurity=function(){o.update({id:e.application._id},e.application).$promise.then(function(o){t.init(),t.location("/application_security/"+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newWorkflow=function(){var s={};s[e.sessionData.userData.properties.language]="";var i=new a({name:s,icon:"clear"});i.$save(function(){i.translated_name="",e.application.workflows.push(i),o.update({id:e.application._id},e.application).$promise.then(function(o){t.init(),t.location("/workflow_edit/"+i._id+"?application_id="+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})})},e.deleteWorkflow=function(t){var s=e.application.workflows[t]._id;e.application.workflows.splice(t,1),o.update({id:e.application._id},e.application).$promise.then(function(e){a.remove({id:s}).$promise.then(function(e){})["catch"](function(e){})})},e.testApp=function(){o.update({id:e.application._id},e.application).$promise.then(function(o){t.init(),t.location("/workflows/"+e.application._id+"?test")})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.save=function(){o.update({id:e.application._id},e.application).$promise.then(function(e){t.init(),t.location("/designer")})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.uploadFile=function(t,o,a){const s=new XMLHttpRequest;s.open("PUT",o),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},s.send(t)},e.changeFile=function(t){if(1==t.length){for(k=t.length-1;k>=0;k--)t[k].size/1048576>35&&t.splice(k,1);document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var o=new s({name:t[0].name,type:t[0].type});o.$save().then(function(o){e.application.file={_id:o.file._id,name:o.file.name,type:o.file.type},e.uploadFile(t[0],o.signedRequest,o.url)})}},e.removeFile=function(t){s.remove({id:t}).$promise.then(function(t){e.application.file=null})["catch"](function(e){})}}]);
