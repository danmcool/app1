app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(t,e,n,a,i,o,l,p){t.sessionData=e.getSessionData(),t.$watch(function(){return e.getSessionData()},function(e,n){e!=n&&(t.sessionData=e)}),n.get({id:l.id},function(n,a){if(n.workflows)for(var i=0;i<n.workflows.length;i++)n.workflows[i].translated_name=e.translate(n.workflows[i].name),n.workflows[i].translated_description=e.translate(n.workflows[i].description);t.application=n,t.sessionData.applicationName=t.sessionData.appData.app_designer,e.setSessionData(t.sessionData)}),t.editText=function(t,e,n){t[e]||(t[e]={}),p.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:t[e],multipleLines:n},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(n){t[e]=n})},t.editWorkflow=function(a){n.update({id:t.application._id},t.application).$promise.then(function(n){e.init(),e.location("/workflow_edit/"+a+"?application_id="+t.application._id)})["catch"](function(e){t.application=e.application,updateErrorAlert()})},t.newWorkflow=function(){p.show(p.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(t.sessionData.appData.new_workflow).textContent(t.sessionData.appData.new_workflow_name).initialValue("My Workflow").ok(t.sessionData.appData.ok).cancel(t.sessionData.appData.cancel)).then(function(i){var o={};o[t.sessionData.userData.properties.language]=i;var l=new a({name:o,icon:"clear"});l.$save(function(){l.translated_name=i,t.application.workflows.push(l),n.update({id:t.application._id},t.application).$promise.then(function(n){e.init(),e.location("/workflow_edit/"+l._id+"?application_id="+t.application._id)})["catch"](function(e){t.application=e.application,updateErrorAlert()})})})},t.save=function(){n.update({id:t.application._id},t.application).$promise.then(function(t){e.init(),e.location("/designer")})["catch"](function(e){t.application=e.application,updateErrorAlert()})},t.uploadFile=function(e,n,a){const i=new XMLHttpRequest;i.open("PUT",n),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?(document.getElementById("file_upload").textContent=t.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},i.send(e)},t.changeFile=function(e){if(1==e.length){document.getElementById("file_upload").textContent=t.sessionData.appData.uploading_in_progress+" 1/1";var n=new i({name:e[0].name,type:e[0].type});n.$save().then(function(n){t.application.file={_id:n.file._id,name:n.file.name,type:n.file.type},t.uploadFile(e[0],n.signedRequest,n.url)})}},t.removeFile=function(e){i.remove({id:e}).$promise.then(function(e){t.application.file=null})["catch"](function(t){})}}]);
