app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(e,t,n,o,a,r,i,s){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,n){t!=n&&(e.sessionData=t)}),n.get({id:i.id},function(n,o){if(n.workflows)for(var a=0;a<n.workflows.length;a++)n.workflows[a].translated_name=t.translate(n.workflows[a].name),n.workflows[a].translated_description=t.translate(n.workflows[a].description);e.application=n,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,n){e[t]||(e[t]={}),s.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:n},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(n){e[t]=n})},e.editWorkflow=function(o){n.update({id:e.application._id},e.application).$promise.then(function(n){t.init(),r.url("/workflow_edit/"+o+"?application_id="+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newWorkflow=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_workflow).textContent(e.sessionData.appData.new_workflow_name).initialValue("My Workflow").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){var n={};n[e.sessionData.userData.properties.language]=t;var a=new o({name:n});a.$save(function(){a.translated_name=t,e.application.workflows.push(a)})})},e.save=function(){n.update({id:e.application._id},e.application).$promise.then(function(e){t.init(),r.url("/designer")})["catch"](function(t){e.application=t.application,updateErrorAlert()})};var l=function(t,n,o){const a=new XMLHttpRequest;a.open("PUT",n),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},a.send(t)};e.changeFile=function(t){if(1==t.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var n=new a({name:t[0].name,type:t[0].type});n.$save().then(function(n){e.application.file={_id:n.file._id,name:n.file.name,type:n.file.type},l(t[0],n.signedRequest,n.url)})}},e.removeFile=function(t){a.remove({id:t}).$promise.then(function(t){e.application.file=null})["catch"](function(e){})}}]);
