app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(t,e,o,n,i,a,l,r){t.sessionData=e.getSessionData(),t.$watch(function(){return e.getSessionData()},function(e,o){e!=o&&(t.sessionData=e)}),o.get({id:l.id},function(o,n){if(o.workflows)for(var i=0;i<o.workflows.length;i++)o.workflows[i].translated_name=e.translate(o.workflows[i].name),o.workflows[i].translated_description=e.translate(o.workflows[i].description);t.application=o,t.sessionData.applicationName=t.sessionData.appData.app_designer,e.setSessionData(t.sessionData)}),t.editText=function(t,e,o){t[e]||(t[e]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:t[e],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(o){t[e]=o})},t.editWorkflow=function(n){o.update({id:t.application._id},t.application).$promise.then(function(o){e.init(),e.location("/workflow_edit/"+n+"?application_id="+t.application._id)})["catch"](function(e){t.application=e.application,updateErrorAlert()})},t.newWorkflow=function(){var i={};i[t.sessionData.userData.properties.language]="";var a=new n({name:i,icon:"clear"});a.$save(function(){a.translated_name="",t.application.workflows.push(a),o.update({id:t.application._id},t.application).$promise.then(function(o){e.init(),e.location("/workflow_edit/"+a._id+"?application_id="+t.application._id)})["catch"](function(e){t.application=e.application,updateErrorAlert()})})},t.deleteWorkflow=function(e){var i=t.application.workflows[e]._id;t.application.workflows.splice(e,1),o.update({id:t.application._id},t.application).$promise.then(function(t){n.remove({id:i}).$promise.then(function(t){})["catch"](function(t){})})},t.save=function(){o.update({id:t.application._id},t.application).$promise.then(function(t){e.init(),e.location("/designer")})["catch"](function(e){t.application=e.application,updateErrorAlert()})},t.uploadFile=function(e,o,n){const i=new XMLHttpRequest;i.open("PUT",o),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?(document.getElementById("file_upload").textContent=t.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},i.send(e)},t.changeFile=function(e){if(1==e.length){document.getElementById("file_upload").textContent=t.sessionData.appData.uploading_in_progress+" 1/1";var o=new i({name:e[0].name,type:e[0].type});o.$save().then(function(o){t.application.file={_id:o.file._id,name:o.file.name,type:o.file.type},t.uploadFile(e[0],o.signedRequest,o.url)})}},t.removeFile=function(e){i.remove({id:e}).$promise.then(function(e){t.application.file=null})["catch"](function(t){})}}]);
