app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(a,e,t,n,o,i,s,l){a.sessionData=e.getSessionData(),a.$watch(function(){return e.getSessionData()},function(e,t){e!=t&&(a.sessionData=e)}),t.get({id:s.id},function(t,n){if(t.workflows)for(var o=0;o<t.workflows.length;o++)t.workflows[o].translated_name=e.translate(t.workflows[o].name),t.workflows[o].translated_description=e.translate(t.workflows[o].description);a.application=t,a.sessionData.applicationName=a.sessionData.appData.app_designer,e.setSessionData(a.sessionData)}),a.editText=function(a,e,t){a[e]||(a[e]={}),l.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:a[e],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){a[e]=t})},a.editWorkflow=function(n){t.update({id:a.application._id},a.application).$promise.then(function(t){e.init(),e.location("/workflow_edit/"+n+"?application_id="+a.application._id)})["catch"](function(e){a.application=e.application,updateErrorAlert()})},a.newWorkflow=function(){l.show(l.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.new_workflow).textContent(a.sessionData.appData.new_workflow_name).initialValue("My Workflow").ok(a.sessionData.appData.ok).cancel(a.sessionData.appData.cancel)).then(function(o){var i={};i[a.sessionData.userData.properties.language]=o;var s=new n({name:i});s.$save(function(){s.translated_name=o,a.application.workflows.push(s),t.update({id:a.application._id},a.application).$promise.then(function(t){e.init(),e.location("/workflow_edit/"+s._id+"?application_id="+a.application._id)})["catch"](function(e){a.application=e.application,updateErrorAlert()})})})},a.save=function(){t.update({id:a.application._id},a.application).$promise.then(function(a){e.init(),e.location("/designer")})["catch"](function(e){a.application=e.application,updateErrorAlert()})},a.uploadFile=function(e,t,n){const o=new XMLHttpRequest;o.open("PUT",t),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?(document.getElementById("file_upload").textContent=a.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},o.send(e)},a.changeFile=function(e){if(1==e.length){document.getElementById("file_upload").textContent=a.sessionData.appData.uploading_in_progress+" 1/1";var t=new o({name:e[0].name,type:e[0].type});t.$save().then(function(t){a.application.file={_id:t.file._id,name:t.file.name,type:t.file.type},a.uploadFile(e[0],t.signedRequest,t.url)})}},a.removeFile=function(e){o.remove({id:e}).$promise.then(function(e){a.application.file=null})["catch"](function(a){})}}]);
