app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(e,t,n,a,i,o,r,l){e.sessionData=t.getSessionData(),e.$watch(function(){return t.getSessionData()},function(t,n){t!=n&&(e.sessionData=t)}),n.get({id:r.id},function(n,a){if(n.workflows)for(var i=0;i<n.workflows.length;i++)n.workflows[i].translated_name=t.translate(n.workflows[i].name),n.workflows[i].translated_description=t.translate(n.workflows[i].description);e.application=n,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData)}),e.editText=function(e,t,n){e[t]||(e[t]={}),l.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:n},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(n){e[t]=n})},e.editWorkflow=function(a){n.update({id:e.application._id},e.application).$promise.then(function(n){t.init(),t.location("/workflow_edit/"+a+"?application_id="+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.editAppSecurity=function(){n.update({id:e.application._id},e.application).$promise.then(function(n){t.init(),t.location("/application_security/"+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.newWorkflow=function(){var i={};i[e.sessionData.userData.properties.language]="";var o=new a({name:i,icon:"clear"});o.$save(function(){o.translated_name="",e.application.workflows.push(o),n.update({id:e.application._id},e.application).$promise.then(function(n){t.init(),t.location("/workflow_edit/"+o._id+"?application_id="+e.application._id)})["catch"](function(t){e.application=t.application,updateErrorAlert()})})},e.deleteWorkflow=function(t){var i=e.application.workflows[t]._id;e.application.workflows.splice(t,1),n.update({id:e.application._id},e.application).$promise.then(function(e){a.remove({id:i}).$promise.then(function(e){})["catch"](function(e){})})},e.save=function(){n.update({id:e.application._id},e.application).$promise.then(function(e){t.init(),t.location("/designer")})["catch"](function(t){e.application=t.application,updateErrorAlert()})},e.uploadFile=function(t,n,a){const i=new XMLHttpRequest;i.open("PUT",n),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},i.send(t)},e.changeFile=function(t){if(1==t.length){document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var n=new i({name:t[0].name,type:t[0].type});n.$save().then(function(n){e.application.file={_id:n.file._id,name:n.file.name,type:n.file.type},e.uploadFile(t[0],n.signedRequest,n.url)})}},e.removeFile=function(t){i.remove({id:t}).$promise.then(function(t){e.application.file=null})["catch"](function(e){})}}]);
