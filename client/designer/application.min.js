app1.controller("ApplicationEditCtrl",["$scope","SessionService","DesignApplication","DesignWorkflow","Files","$location","$routeParams","$mdDialog",function(e,a,t,o,s,i,l,r){e.sessionData=a.getSessionData(),e.$watch(function(){return a.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),t.get({id:l.id},function(t,o){if(t.workflows)for(var s=0;s<t.workflows.length;s++)t.workflows[s].translated_name=a.translate(t.workflows[s].name),t.workflows[s].translated_description=a.translate(t.workflows[s].description);e.application=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,a.setSessionData(e.sessionData)}),e.editText=function(e,a,t){e[a]||(e[a]={}),r.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:t},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[a]=t})},e.editWorkflow=function(o){t.update({id:e.application._id},e.application,function(t){a.init(),a.location("/workflow_edit/"+o+"?application_id="+e.application._id)},function(a){e.application=a.application,updateErrorAlert()})},e.editAppSecurity=function(){t.update({id:e.application._id},e.application,function(t){a.init(),a.location("/application_security/"+e.application._id)},function(a){e.application=a.application,updateErrorAlert()})},e.newWorkflow=function(){var s={};s[e.sessionData.userData.properties.language]="";var i=new o({name:s,icon:"clear"});i.$save(function(){i.translated_name="",e.application.workflows.push(i),t.update({id:e.application._id},e.application,function(t){a.init(),a.location("/workflow_edit/"+i._id+"?application_id="+e.application._id)},function(a){e.application=a.application,updateErrorAlert()})})},e.deleteWorkflow=function(a){var s=e.application.workflows[a]._id;e.application.workflows.splice(a,1),t.update({id:e.application._id},e.application,function(e){o.remove({id:s},function(e){},function(e){})})},e.testApp=function(){t.update({id:e.application._id},e.application,function(t){a.init(),a.location("/workflows/"+e.application._id+"?test")},function(a){e.application=a.application,updateErrorAlert()})},e.save=function(){t.update({id:e.application._id},e.application,function(e){a.init(),a.location("/designer")},function(a){e.application=a.application,updateErrorAlert()})},e.uploadFile=function(a,t,o){const s=new XMLHttpRequest;s.open("PUT",t),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?(document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_done,setTimeout(function(){document.getElementById("file_upload").textContent=""},4e3)):alert("Could not upload file."))},s.send(a)},e.changeFile=function(a){if(1==a.length){for(k=a.length-1;k>=0;k--)a[k].size/1048576>35&&a.splice(k,1);document.getElementById("file_upload").textContent=e.sessionData.appData.uploading_in_progress+" 1/1";var t=new s({name:a[0].name,type:a[0].type});t.$save(function(t){e.application.file={_id:t.file._id,name:t.file.name,type:t.file.type},e.uploadFile(a[0],t.signedRequest,t.url)})}},e.removeFile=function(a){s.remove({id:a},function(a){e.application.file=null},function(e){})}}]);
