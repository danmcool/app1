app1.factory("DesignApplication",["$resource",function(e){return e("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(e){return e("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(e){return e("/client/design/form/:id",null,{update:{method:"PUT"}})}]).factory("DesignValue",["$resource",function(e){return e("/client/design/value/:id",null,{update:{method:"PUT"}})}]).factory("DesignDataModel",["$resource",function(e){return e("/client/design/datamodel/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(e,t,a,o,s,i,r){e.sessionData=t.getSessionData(),e.applications=[],e.skip=0,e.limit=10,e.stopScroll=!1,e.tempStopScroll=!1,e.$watch(function(){return t.getSessionData()},function(a,o){a!=o&&(e.sessionData=a,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData))}),e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData),e.getNextApps=function(){if(!e.stopScroll&&!e.tempStopScroll){var o=e.limit,s=e.skip;e.skip+=e.limit,e.tempStopScroll=!0,a.query({skip:s,limit:o},function(a){if(a.length<e.limit&&(e.stopScroll=!0),a&&a.length>0)for(var o=0;o<a.length;o++){for(var s=e.sessionData.userData.company.applications,i=0;i<s.length;i++)if(a[o]._id==s[i]){a[o].enabled=!0;break}a[o].translated_name=t.translate(a[o].name),a[o].translated_description=t.translate(a[o].description),e.applications.push(a[o])}e.tempStopScroll=!1})}},e.getNextApps(),e.newApplication=function(){var o={};o[e.sessionData.userData.properties.language]="";var s=new a({name:o,icon:"clear"});s.$save(function(){s.translated_name="",e.applications.push(s),t.location("/application_edit/"+s._id)})},e["delete"]=function(s){i.show(i.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.confirmation).textContent(e.sessionData.appData.removal_confirmation).ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(){a.remove({id:s._id}).$promise.then(function(a){for(var i=0;i<e.applications.length;i++)if(e.applications[i]._id==s._id){e.applications.splice(i,1);break}if(s.enabled){for(var r=e.sessionData.userData.company.applications,i=0;i<r.length;i++)if(s._id==r[i]){r.splice(i,1);break}o.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:r}).$promise.then(function(e){t.init()})}})})},e.updateCompanyApps=function(a){if(a.active){var s=e.sessionData.userData.company.applications;if(a.enabled){for(var i=0;i<s.length;i++)if(a._id==s[i]){s.splice(i,1);break}}else s.push(a._id);e.sessionData.userData.company.applications=s,o.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:s}).$promise.then(function(e){t.init()})}},e.edit=function(e){t.location("/application_edit/"+e)},e.share=function(t){for(var a=!1,o=0;o<t.profiles.length;o++)if(t.profiles[o].properties&&"public"==t.profiles[o].properties.user){a=!0,s.update({app_profile_id:t.profiles[o]._id,app_name:t.name.en,profile_name:t.profiles[o].name.en}).$promise.then(function(t){i.show(i.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.share_url).textContent(t.share_url).ok(e.sessionData.appData.ok))})["catch"](function(e){});break}a||i.show(i.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.error).textContent(e.sessionData.appData.no_public_profile).ok(e.sessionData.appData.ok))},e.users=function(e){t.location("/application_users/"+e)}}]);
