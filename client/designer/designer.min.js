app1.factory("DesignApplication",["$resource",function(a){return a("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(a){return a("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(a){return a("/client/design/form/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(a,e,t,n,i,s,o){a.sessionData=e.getSessionData(),a.applications=[],a.$watch(function(){return e.getSessionData()},function(t,n){t!=n&&(a.sessionData=t,a.sessionData.applicationName=a.sessionData.appData.app_designer,a.sessionData.showShareForm=!1,e.setSessionData(a.sessionData))}),t.query(function(t){if(t&&t.length>0){for(var n=0;n<t.length;n++){for(var i=a.sessionData.userData.company.applications,s=0;s<i.length;s++)if(t[n]._id==i[s]){t[n].enabled=!0;break}t[n].translated_name=e.translate(t[n].name),t[n].translated_description=e.translate(t[n].description)}a.applications=t}a.sessionData.applicationName=a.sessionData.appData.app_designer,a.sessionData.showShareForm=!1,e.setSessionData(a.sessionData)}),a.newApplication=function(){s.show(s.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.new_app).textContent(a.sessionData.appData.new_app_name).initialValue("My App").ok(a.sessionData.appData.ok).cancel(a.sessionData.appData.cancel)).then(function(e){var n=new t({name:{en:e}});n.$save(function(){n.translated_name=n.name.en,a.applications.push(n)})})},a["delete"]=function(i){s.show(s.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.confirmation).textContent(a.sessionData.appData.removal_confirmation).ok(a.sessionData.appData.ok).cancel(a.sessionData.appData.cancel)).then(function(){t.remove({id:i}).$promise.then(function(t){for(var s=0;s<a.applications.length;s++)if(a.applications[s]._id==i){a.applications.splice(s,1);break}if(app.enabled){for(var o=a.sessionData.userData.company.applications,s=0;s<o.length;s++)if(i==o[s]){o.splice(s,1);break}n.update({id:a.sessionData.userData.company._id},{_id:a.sessionData.userData.company._id,applications:o}).$promise.then(function(a){e.init()})}})})},a.updateCompanyApps=function(t){if(t.active){var i=a.sessionData.userData.company.applications;if(t.enabled){for(var s=0;s<i.length;s++)if(t._id==i[s]){i.splice(s,1);break}}else i.push(t._id);a.sessionData.userData.company.applications=i,n.update({id:a.sessionData.userData.company._id},{_id:a.sessionData.userData.company._id,applications:i}).$promise.then(function(a){e.init()})}},a.edit=function(a){o.url("/application_edit/"+a)},a.share=function(e){for(var t=!1,n=0;n<e.profiles.length;n++)if(e.profiles[n].properties&&"public"==e.profiles[n].properties.user){t=!0,i.update({app_profile_id:e.profiles[n]._id,app_name:e.name.en,profile_name:e.profiles[n].name.en}).$promise.then(function(e){s.show(s.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.share_url).textContent(e.share_url).ok(a.sessionData.appData.ok))})["catch"](function(a){});break}t||s.show(s.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.error).textContent(a.sessionData.appData.no_public_profile).ok(a.sessionData.appData.ok))}}]);
