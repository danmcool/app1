app1.factory("DesignApplication",["$resource",function(e){return e("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(e){return e("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(e){return e("/client/design/form/:id",null,{update:{method:"PUT"}})}]).factory("DesignValue",["$resource",function(e){return e("/client/design/value/:id",null,{update:{method:"PUT"}})}]).factory("DesignDataModel",["$resource",function(e){return e("/client/design/datamodel/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(e,t,a,r,o,n,i){e.sessionData=t.getSessionData(),e.applications=[],e.skip=0,e.limit=10,e.stopScroll=!1,e.tempStopScroll=!1,e.$watch(function(){return t.getSessionData()},function(a,r){a!=r&&(e.sessionData=a,e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData))}),e.sessionData.applicationName=e.sessionData.appData.app_designer,t.setSessionData(e.sessionData),e.getNextApps=function(){if(!e.stopScroll&&!e.tempStopScroll){var r=e.limit,o=e.skip;e.skip+=e.limit,e.tempStopScroll=!0,a.query({skip:o,limit:r},function(a){if(a.length<e.limit&&(e.stopScroll=!0),a&&a.length>0)for(var r=0;r<a.length;r++){for(var o=e.sessionData.userData.company.applications,n=0;n<o.length;n++)if(a[r]._id==o[n]){a[r].enabled=!0;break}a[r].translated_name=t.translate(a[r].name),a[r].translated_description=t.translate(a[r].description),e.applications.push(a[r])}e.tempStopScroll=!1})}},e.getNextApps(),e.newApplication=function(){var r={};r[e.sessionData.userData.properties.correctedLanguage]="";var o=new a({name:r,icon:"clear"});o.$save(function(){o.translated_name="",e.applications.push(o),t.location("/application_edit/"+o._id)})},e["delete"]=function(o){n.show(n.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.confirmation).textContent(e.sessionData.appData.removal_confirmation).ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(){a.remove({id:o._id},function(a){for(var n=0;n<e.applications.length;n++)if(e.applications[n]._id==o._id){e.applications.splice(n,1);break}if(o.enabled){for(var i=e.sessionData.userData.company.applications,n=0;n<i.length;n++)if(o._id==i[n]){i.splice(n,1);break}r.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:i},function(e){t.init()})}})})},e.updateCompanyApps=function(a){if(a.active){var o=e.sessionData.userData.company.applications;if(a.enabled){for(var n=0;n<o.length;n++)if(a._id==o[n]){o.splice(n,1);break}}else o.push(a._id);e.sessionData.userData.company.applications=o,r.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:o},function(e){t.init()})}},e.edit=function(e){t.location("/application_edit/"+e)},e.share=function(t){for(var a=!1,r=0;r<t.profiles.length;r++)if(t.profiles[r].properties&&"public"==t.profiles[r].properties.user){a=!0,o.update({app_profile_id:t.profiles[r]._id,app_name:t.name.en,profile_name:t.profiles[r].name.en},function(t){n.show(n.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.share_url).textContent(t.share_url).ok(e.sessionData.appData.ok))});break}a||n.show(n.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.error).textContent(e.sessionData.appData.no_public_profile).ok(e.sessionData.appData.ok))},e.users=function(e){t.location("/application_users/"+e)}}]);
