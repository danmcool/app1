app1.factory("DesignApplication",["$resource",function(e){return e("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(e){return e("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(e){return e("/client/design/form/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","$mdDialog","$location",function(e,a,t,n,o,i){e.sessionData=a.getSessionData(),e.applications=[],e.$watch(function(){return a.getSessionData()},function(t,n){t!=n&&(e.sessionData=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,e.sessionData.showShareForm=!1,a.setSessionData(e.sessionData))}),t.query(function(t){if(t&&t.length>0){for(var n=0;n<t.length;n++){for(var o=e.sessionData.userData.company.applications,i=0;i<o.length;i++)if(t[n]._id==o[i]){t[n].enabled=!0;break}t[n].translated_name=a.translate(t[n].name),t[n].translated_description=a.translate(t[n].description)}e.applications=t}e.sessionData.applicationName=e.sessionData.appData.app_designer,e.sessionData.showShareForm=!1,a.setSessionData(e.sessionData)}),e.newApplication=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_app).textContent(e.sessionData.appData.new_app_name).initialValue("My App").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var n=new t({name:{en:a}});n.$save(function(){n.translated_name=n.name.en,e.applications.push(n)})})},e["delete"]=function(i){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.confirmation).textContent(e.sessionData.appData.removal_confirmation).ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(){t.remove({id:i._id}).$promise.then(function(t){if(i.enabled){for(var s=e.sessionData.userData.company.applications,o=0;o<s.length;o++)if(i._id==s[o]){s.splice(o,1);break}for(var o=0;o<e.applications.length;o++)if(i._id==e.applications[o]._id){e.applications.splice(o,1);break}n.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:s}).$promise.then(function(e){a.init()})}else for(var o=0;o<e.applications.length;o++)if(e.applications[o]._id==i._id){e.applications.splice(o,1);break}})})},e.updateCompanyApps=function(t){if(t.active){var o=e.sessionData.userData.company.applications;if(t.enabled){for(var i=0;i<o.length;i++)if(t._id==o[i]){o.splice(i,1);break}}else o.push(t._id);n.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:o}).$promise.then(function(e){a.init()})}},e.edit=function(e){i.url("/application_edit/"+e)}}]);
