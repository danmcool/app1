app1.factory("DesignApplication",["$resource",function(a){return a("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(a){return a("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(a){return a("/client/design/form/:id",null,{update:{method:"PUT"}})}]).factory("DesignValue",["$resource",function(a){return a("/client/design/value/:id",null,{update:{method:"PUT"}})}]).factory("DesignDataModel",["$resource",function(a){return a("/client/design/datamodel/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(a,t,e,n,i,o,s){a.sessionData=t.getSessionData(),a.applications=[],a.skip=0,a.limit=10,a.stopScroll=!1,a.tempStopScroll=!1,a.$watch(function(){return t.getSessionData()},function(e,n){e!=n&&(a.sessionData=e,a.sessionData.applicationName=a.sessionData.appData.app_designer,t.setSessionData(a.sessionData))}),a.sessionData.applicationName=a.sessionData.appData.app_designer,t.setSessionData(a.sessionData),a.getNextApps=function(){if(!a.stopScroll&&!a.tempStopScroll){var n=a.limit,i=a.skip;a.skip+=a.limit,a.tempStopScroll=!0,e.query({skip:i,limit:n},function(e){if(e.length<a.limit&&(a.stopScroll=!0),e&&e.length>0)for(var n=0;n<e.length;n++){for(var i=a.sessionData.userData.company.applications,o=0;o<i.length;o++)if(e[n]._id==i[o]){e[n].enabled=!0;break}e[n].translated_name=t.translate(e[n].name),e[n].translated_description=t.translate(e[n].description),a.applications.push(e[n])}a.tempStopScroll=!1})}},a.getNextApps(),a.newApplication=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.new_app).textContent(a.sessionData.appData.new_app_name).initialValue("My App").ok(a.sessionData.appData.ok).cancel(a.sessionData.appData.cancel)).then(function(n){var i={};i[a.sessionData.userData.properties.language]=n;var o=new e({name:i,icon:"clear"});o.$save(function(){o.translated_name=n,a.applications.push(o),t.location("/application_edit/"+o._id)})})},a["delete"]=function(i){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.confirmation).textContent(a.sessionData.appData.removal_confirmation).ok(a.sessionData.appData.ok).cancel(a.sessionData.appData.cancel)).then(function(){e.remove({id:i._id}).$promise.then(function(e){for(var o=0;o<a.applications.length;o++)if(a.applications[o]._id==i._id){a.applications.splice(o,1);break}if(i.enabled){for(var s=a.sessionData.userData.company.applications,o=0;o<s.length;o++)if(i._id==s[o]){s.splice(o,1);break}n.update({id:a.sessionData.userData.company._id},{_id:a.sessionData.userData.company._id,applications:s}).$promise.then(function(a){t.init()})}})})},a.updateCompanyApps=function(e){if(e.active){var i=a.sessionData.userData.company.applications;if(e.enabled){for(var o=0;o<i.length;o++)if(e._id==i[o]){i.splice(o,1);break}}else i.push(e._id);a.sessionData.userData.company.applications=i,n.update({id:a.sessionData.userData.company._id},{_id:a.sessionData.userData.company._id,applications:i}).$promise.then(function(a){t.init()})}},a.edit=function(a){t.location("/application_edit/"+a)},a.share=function(t){for(var e=!1,n=0;n<t.profiles.length;n++)if(t.profiles[n].properties&&"public"==t.profiles[n].properties.user){e=!0,i.update({app_profile_id:t.profiles[n]._id,app_name:t.name.en,profile_name:t.profiles[n].name.en}).$promise.then(function(t){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.share_url).textContent(t.share_url).ok(a.sessionData.appData.ok))})["catch"](function(a){});break}e||o.show(o.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a.sessionData.appData.error).textContent(a.sessionData.appData.no_public_profile).ok(a.sessionData.appData.ok))}}]);
