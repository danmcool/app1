app1.factory("DesignApplication",["$resource",function(e){return e("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(e){return e("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(e){return e("/client/design/form/:id",null,{update:{method:"PUT"}})}]).factory("DesignDataModel",["$resource",function(e){return e("/client/design/datamodel/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(e,n,r,t,o,i,a){e.sessionData=n.getSessionData(),e.applications=[],e.skip=0,e.limit=10,e.stopScroll=!1,e.tempStopScroll=!1,e.$watch(function(){return n.getSessionData()},function(r,t){r!=t&&(e.sessionData=r,e.sessionData.applicationName=e.sessionData.appData.app_designer,n.setSessionData(e.sessionData))}),e.sessionData.applicationName=e.sessionData.appData.app_designer,n.setSessionData(e.sessionData),e.getNextApps=function(){if(!e.stopScroll&&!e.tempStopScroll){var t=e.limit,o=e.skip;e.skip+=e.limit,e.tempStopScroll=!0,r.query({skip:o,limit:t},function(r){if(r.length<e.limit&&(e.stopScroll=!0),r&&r.length>0)for(var t=0;t<r.length;t++){for(var o=e.sessionData.userData.company.applications,i=0;i<o.length;i++)if(r[t]._id==o[i]){r[t].enabled=!0;break}r[t].translated_name=n.translate(r[t].name),r[t].translated_description=n.translate(r[t].description),e.applications.push(r[t])}e.tempStopScroll=!1})}},e.getNextApps(),e.newApplication=function(){i.show(i.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_app).textContent(e.sessionData.appData.new_app_name).initialValue("My App").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(t){var o={};o[e.sessionData.userData.properties.language]=t;var i=new r({name:o});i.$save(function(){i.translated_name=t,e.applications.push(i),n.location("/application_edit/"+i._id)})})},e["delete"]=function(o){i.show(i.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.confirmation).textContent(e.sessionData.appData.removal_confirmation).ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(){r.remove({id:o._id}).$promise.then(function(r){for(var i=0;i<e.applications.length;i++)if(e.applications[i]._id==o._id){e.applications.splice(i,1);break}if(o.enabled){for(var a=e.sessionData.userData.company.applications,i=0;i<a.length;i++)if(o._id==a[i]){a.splice(i,1);break}t.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:a}).$promise.then(function(e){n.init()})}})})},e.updateCompanyApps=function(r){if(r.active){var o=e.sessionData.userData.company.applications;if(r.enabled){for(var i=0;i<o.length;i++)if(r._id==o[i]){o.splice(i,1);break}}else o.push(r._id);e.sessionData.userData.company.applications=o,t.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:o}).$promise.then(function(e){n.init()})}},e.edit=function(e){n.location("/application_edit/"+e)},e.share=function(n){for(var r=!1,t=0;t<n.profiles.length;t++)if(n.profiles[t].properties&&"public"==n.profiles[t].properties.user){r=!0,o.update({app_profile_id:n.profiles[t]._id,app_name:n.name.en,profile_name:n.profiles[t].name.en}).$promise.then(function(n){i.show(i.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.share_url).textContent(n.share_url).ok(e.sessionData.appData.ok))})["catch"](function(e){});break}r||i.show(i.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.error).textContent(e.sessionData.appData.no_public_profile).ok(e.sessionData.appData.ok))}}]);
