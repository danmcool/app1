app1.factory("DesignApplication",["$resource",function(e){return e("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(e){return e("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(e){return e("/client/design/form/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(e,a,t,i,n,o,s){e.sessionData=a.getSessionData(),e.applications=[],e.skip=0,e.limit=10,e.stopScroll=!1,e.tempStopScroll=!1,e.$watch(function(){return a.getSessionData()},function(t,i){t!=i&&(e.sessionData=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,a.setSessionData(e.sessionData))}),e.sessionData.applicationName=e.sessionData.appData.app_designer,a.setSessionData(e.sessionData),e.getNextApps=function(){if(!e.stopScroll&&!e.tempStopScroll){var i=e.limit,n=e.skip;e.skip+=e.limit,e.tempStopScroll=!0,t.query({skip:n,limit:i},function(t){if(t.length<e.limit&&(e.stopScroll=!0),t&&t.length>0)for(var i=0;i<t.length;i++){for(var n=e.sessionData.userData.company.applications,o=0;o<n.length;o++)if(t[i]._id==n[o]){t[i].enabled=!0;break}t[i].translated_name=a.translate(t[i].name),t[i].translated_description=a.translate(t[i].description),e.applications.push(t[i])}e.tempStopScroll=!1})}},e.getNextApps(),e.newApplication=function(){o.show(o.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_app).textContent(e.sessionData.appData.new_app_name).initialValue("My App").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var i={};i[e.sessionData.userData.properties.language]=a;var n=new t({name:i});n.$save(function(){n.translated_name=a,e.applications.push(n),s.url("/application_edit/"+n._id)})})},e["delete"]=function(n){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.confirmation).textContent(e.sessionData.appData.removal_confirmation).ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(){t.remove({id:n._id}).$promise.then(function(t){for(var o=0;o<e.applications.length;o++)if(e.applications[o]._id==n._id){e.applications.splice(o,1);break}if(n.enabled){for(var s=e.sessionData.userData.company.applications,o=0;o<s.length;o++)if(n._id==s[o]){s.splice(o,1);break}i.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:s}).$promise.then(function(e){a.init()})}})})},e.updateCompanyApps=function(t){if(t.active){var n=e.sessionData.userData.company.applications;if(t.enabled){for(var o=0;o<n.length;o++)if(t._id==n[o]){n.splice(o,1);break}}else n.push(t._id);e.sessionData.userData.company.applications=n,i.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:n}).$promise.then(function(e){a.init()})}},e.edit=function(e){s.url("/application_edit/"+e)},e.share=function(a){for(var t=!1,i=0;i<a.profiles.length;i++)if(a.profiles[i].properties&&"public"==a.profiles[i].properties.user){t=!0,n.update({app_profile_id:a.profiles[i]._id,app_name:a.name.en,profile_name:a.profiles[i].name.en}).$promise.then(function(a){o.show(o.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.share_url).textContent(a.share_url).ok(e.sessionData.appData.ok))})["catch"](function(e){});break}t||o.show(o.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.error).textContent(e.sessionData.appData.no_public_profile).ok(e.sessionData.appData.ok))}}]);
