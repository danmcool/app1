app1.factory("DesignApplication",["$resource",function(e){return e("/client/design/application/:id",null,{update:{method:"PUT"}})}]).factory("DesignWorkflow",["$resource",function(e){return e("/client/design/workflow/:id",null,{update:{method:"PUT"}})}]).factory("DesignForm",["$resource",function(e){return e("/client/design/form/:id",null,{update:{method:"PUT"}})}]).controller("DesignerCtrl",["$scope","SessionService","DesignApplication","Company","Share","$mdDialog","$location",function(e,a,s,o,t,r,i){e.sessionData=a.getSessionData(),e.applications=[],e.$watch(function(){return a.getSessionData()},function(s,o){s!=o&&(e.sessionData=s,e.sessionData.applicationName=e.sessionData.appData.app_designer,e.sessionData.showShareForm=!1,a.setSessionData(e.sessionData))}),s.query(function(s){if(s&&s.length>0){for(var o=0;o<s.length;o++){for(var t=e.sessionData.userData.company.applications,r=0;r<t.length;r++)if(s[o]._id==t[r]){s[o].enabled=!0;break}s[o].translated_name=a.translate(s[o].name),s[o].translated_description=a.translate(s[o].description)}e.applications=s}e.sessionData.applicationName=e.sessionData.appData.app_designer,e.sessionData.showShareForm=!1,a.setSessionData(e.sessionData)}),e.newApplication=function(){r.show(r.prompt().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_app).textContent(e.sessionData.appData.new_app_name).initialValue("My App").ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(a){var o=new s({name:{en:a}});o.$save(function(){o.translated_name=o.name.en,e.applications.push(o)})})},e["delete"]=function(t){r.show(r.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.confirmation).textContent(e.sessionData.appData.removal_confirmation).ok(e.sessionData.appData.ok).cancel(e.sessionData.appData.cancel)).then(function(){s.remove({id:t}).$promise.then(function(s){for(var r=0;r<e.applications.length;r++)if(e.applications[r]._id==t){e.applications.splice(r,1);break}if(app.enabled){for(var i=e.sessionData.userData.company.applications,r=0;r<i.length;r++)if(t==i[r]){i.splice(r,1);break}o.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:i}).$promise.then(function(e){a.init()})}})})},e.updateCompanyApps=function(s){if(s.active){var t=e.sessionData.userData.company.applications;if(s.enabled){for(var r=0;r<t.length;r++)if(s._id==t[r]){t.splice(r,1);break}}else t.push(s._id);o.update({id:e.sessionData.userData.company._id},{_id:e.sessionData.userData.company._id,applications:t}).$promise.then(function(e){a.init()})}},e.edit=function(e){i.url("/application_edit/"+e)},e.share=function(a){for(var s=!1,o=0;o<a.profiles.length;o++)if(a.profiles[o].properties&&"public"==a.profiles[o].properties.user){s=!0,t.update({app_profile_id:a.profiles[o]._id}).$promise.then(function(a){r.show(r.confirm().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.share_url).textContent(a.data.share_url).ok(e.sessionData.appData.ok))})["catch"](function(e){});break}s||r.show(r.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.error).textContent(e.sessionData.appData.no_public_profile).ok(e.sessionData.appData.ok))}}]);
