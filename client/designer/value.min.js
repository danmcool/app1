app1.controller("FormValueEditCtrl",["$scope","$routeParams","$mdDialog","SessionService","DesignValue","DesignDataModel",function(e,a,t,o,s,n){e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(a,t){a!=t&&(e.sessionData=a)}),e.value_type={list:{en:"List",fr:"Liste"},user:{en:"User",fr:"Utilisateur"},query:{en:"Query",fr:"Requette"}},e.value_relation_user_type={user_manager:{en:"Manager",fr:"Manager"},user_reports:{en:"Colleague",fr:"Collaborateur"},user_list:{en:"User list",fr:"Liste utilisateurs"}};var r=Object.keys(e.value_type);for(e.value_types=[],i=0;i<r.length;i++)e.value_types.push({translated_name:o.translate(e.value_type[r[i]]),type:r[i]});var l=Object.keys(e.value_relation_user_type);for(e.value_relation_user_types=[],i=0;i<l.length;i++)e.value_relation_user_types.push({translated_name:o.translate(e.value_relation_user_type[l[i]]),type:l[i]});s.get({id:a.id},function(a,t){e.value=a,e.sessionData.applicationName=e.sessionData.appData.app_designer,o.setSessionData(e.sessionData)}),n.get({id:a.datamodel_id},function(a,t){e.datamodel=a,e.datamodel_keys=[];for(var i=Object.keys(a.projection),s=0;s<i.length;s++)e.datamodel_keys.push({translated_name:o.translate(a.projection[i[s]]),id:i[s]})}),e.editText=function(e,a,o){e[a]||(e[a]={}),t.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[a],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(t){e[a]=t})},e.addValue=function(){e.value.values||(e.value.values=[]);var t,o,a=e.value.values.length;do for(t=!1,o=0;o<e.value.values.length;o++)if(e.value.values[o]._id==a){t=!0,a+=1;break}while(t);e.value.values.push({_id:a})},e.deleteValue=function(a){e.value.values.splice(a,1)},e.save=function(){s.update({id:a.id},e.value).$promise.then(function(e){o.location("/form_edit/"+a.form_id+"?application_id="+a.application_id+"&workflow_id="+a.workflow_id)})["catch"](function(e){d()})},e.toggleInFormula=function(a){var t=e.action.formula.indexOf(a.id);t>-1?e.action.formula.splice(t,1):e.action.formula.push(a.id)},e.existsInFormula=function(a){return e.action.formula.indexOf(a.id)>-1};var d=function(){t.show(t.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
