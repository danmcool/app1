app1.controller("FormValueEditCtrl",["$scope","$routeParams","$mdDialog","SessionService","DesignValue","DesignDataModel",function(e,t,a,o,n,s){e.sessionData=o.getSessionData(),e.$watch(function(){return o.getSessionData()},function(t,a){t!=a&&(e.sessionData=t)}),e.value_type={list:{en:"List",fr:"Liste"},user:{en:"User",fr:"Utilisateur"},query:{en:"Query",fr:"Requette"}},e.value_relation_user_type={user_manager:{en:"Manager",fr:"Manager"},user_reports:{en:"Colleague",fr:"Collaborateur"},user_list:{en:"User list",fr:"Liste utilisateurs"}};var r=Object.keys(e.value_type);for(e.value_types=[],i=0;i<r.length;i++)e.value_types.push({translated_name:o.translate(e.value_type[r[i]]),type:r[i]});var l=Object.keys(e.value_relation_user_type);for(e.value_relation_user_types=[],i=0;i<l.length;i++)e.value_relation_user_types.push({translated_name:o.translate(e.value_relation_user_type[l[i]]),type:l[i]});n.get({id:t.id},function(t,a){e.value=t,e.sessionData.applicationName=e.sessionData.appData.app_designer,o.setSessionData(e.sessionData)}),s.get({id:t.datamodel_id},function(t,a){e.datamodel=t,e.datamodel_keys=[];for(var i=Object.keys(t.translation),n=0;n<i.length;n++)e.datamodel_keys.push({translated_name:o.translate(t.translation[i[n]]),id:i[n]})}),e.editText=function(e,t,o){e[t]||(e[t]={}),a.show({templateUrl:"designer/text.html",controller:"TextCtrl",locals:{text:e[t],multipleLines:o},parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e[t]=a})},e.addValue=function(){e.value.values||(e.value.values=[]);var a,o,t=e.value.values.length;do for(a=!1,o=0;o<e.value.values.length;o++)if(e.value.values[o]._id==t){a=!0,t+=1;break}while(a);e.value.values.push({_id:t})},e.deleteValue=function(t){e.value.values.splice(t,1)},e.save=function(){n.update({id:t.id},e.value).$promise.then(function(e){o.location("/form_edit/"+t.form_id+"?application_id="+t.application_id+"&workflow_id="+t.workflow_id)})["catch"](function(e){d()})},e.toggleInFormula=function(t){var a=e.action.formula.indexOf(t.id);a>-1?e.action.formula.splice(a,1):e.action.formula.push(t.id)},e.existsInFormula=function(t){return e.action.formula.indexOf(t.id)>-1};var d=function(){a.show(a.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e.sessionData.appData.new_document_version).textContent(e.sessionData.appData.already_modified_document).ok(e.sessionData.appData.ok))}}]);
